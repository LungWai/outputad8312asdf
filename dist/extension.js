(()=>{"use strict";var e={18:(e,t,n)=>{var s=n(484),r=n(9714),a=n(1755),o=n(6010),i=n(7434),c=n(483),l=n(2291);function u(e,t,n,s,r,a){const o="block-map"===n.type?i.resolveBlockMap(e,t,n,s,a):"block-seq"===n.type?c.resolveBlockSeq(e,t,n,s,a):l.resolveFlowCollection(e,t,n,s,a),u=o.constructor;return"!"===r||r===u.tagName?(o.tag=u.tagName,o):(r&&(o.tag=r),o)}t.composeCollection=function(e,t,n,i,c){const l=i.tag,d=l?t.directives.tagName(l.source,(e=>c(l,"TAG_RESOLVE_FAILED",e))):null;if("block-seq"===n.type){const{anchor:e,newlineAfterProp:t}=i,n=e&&l?e.offset>l.offset?e:l:e??l;n&&(!t||t.offset<n.offset)&&c(n,"MISSING_CHAR","Missing newline after block sequence props")}const h="block-map"===n.type?"map":"block-seq"===n.type?"seq":"{"===n.start.source?"map":"seq";if(!l||!d||"!"===d||d===a.YAMLMap.tagName&&"map"===h||d===o.YAMLSeq.tagName&&"seq"===h)return u(e,t,n,c,d);let p=t.schema.tags.find((e=>e.tag===d&&e.collection===h));if(!p){const s=t.schema.knownTags[d];if(!s||s.collection!==h)return s?c(l,"BAD_COLLECTION_TYPE",`${s.tag} used for ${h} collection, but expects ${s.collection??"scalar"}`,!0):c(l,"TAG_RESOLVE_FAILED",`Unresolved tag: ${d}`,!0),u(e,t,n,c,d);t.schema.tags.push(Object.assign({},s,{default:!1})),p=s}const f=u(e,t,n,c,d,p),m=p.resolve?.(f,(e=>c(l,"TAG_RESOLVE_FAILED",e)),t.options)??f,g=s.isNode(m)?m:new r.Scalar(m);return g.range=f.range,g.tag=d,p?.format&&(g.format=p.format),g}},81:(e,t,n)=>{var s=n(484),r=n(3793),a=n(248);function o({comment:e,items:t},n,{blockItemPrefix:o,flowChars:i,itemIndent:l,onChompKeep:u,onComment:d}){const{indent:h,options:{commentString:p}}=n,f=Object.assign({},n,{indent:l,type:null});let m=!1;const g=[];for(let e=0;e<t.length;++e){const i=t[e];let u=null;if(s.isNode(i))!m&&i.spaceBefore&&g.push(""),c(n,g,i.commentBefore,m),i.comment&&(u=i.comment);else if(s.isPair(i)){const e=s.isNode(i.key)?i.key:null;e&&(!m&&e.spaceBefore&&g.push(""),c(n,g,e.commentBefore,m))}m=!1;let d=r.stringify(i,f,(()=>u=null),(()=>m=!0));u&&(d+=a.lineComment(d,l,p(u))),m&&u&&(m=!1),g.push(o+d)}let y;if(0===g.length)y=i.start+i.end;else{y=g[0];for(let e=1;e<g.length;++e){const t=g[e];y+=t?`\n${h}${t}`:"\n"}}return e?(y+="\n"+a.indentComment(p(e),h),d&&d()):m&&u&&u(),y}function i({items:e},t,{flowChars:n,itemIndent:o}){const{indent:i,indentStep:l,flowCollectionPadding:u,options:{commentString:d}}=t;o+=l;const h=Object.assign({},t,{indent:o,inFlow:!0,type:null});let p=!1,f=0;const m=[];for(let n=0;n<e.length;++n){const i=e[n];let l=null;if(s.isNode(i))i.spaceBefore&&m.push(""),c(t,m,i.commentBefore,!1),i.comment&&(l=i.comment);else if(s.isPair(i)){const e=s.isNode(i.key)?i.key:null;e&&(e.spaceBefore&&m.push(""),c(t,m,e.commentBefore,!1),e.comment&&(p=!0));const n=s.isNode(i.value)?i.value:null;n?(n.comment&&(l=n.comment),n.commentBefore&&(p=!0)):null==i.value&&e?.comment&&(l=e.comment)}l&&(p=!0);let u=r.stringify(i,h,(()=>l=null));n<e.length-1&&(u+=","),l&&(u+=a.lineComment(u,o,d(l))),!p&&(m.length>f||u.includes("\n"))&&(p=!0),m.push(u),f=m.length}const{start:g,end:y}=n;if(0===m.length)return g+y;if(!p){const e=m.reduce(((e,t)=>e+t.length+2),2);p=t.options.lineWidth>0&&e>t.options.lineWidth}if(p){let e=g;for(const t of m)e+=t?`\n${l}${i}${t}`:"\n";return`${e}\n${i}${y}`}return`${g}${u}${m.join(" ")}${u}${y}`}function c({indent:e,options:{commentString:t}},n,s,r){if(s&&r&&(s=s.replace(/^\n+/,"")),s){const r=a.indentComment(t(s),e);n.push(r.trimStart())}}t.stringifyCollection=function(e,t,n){return(t.inFlow??e.flow?i:o)(e,t,n)}},181:e=>{e.exports=require("buffer")},248:(e,t)=>{function n(e,t){return/^\n+$/.test(e)?e.substring(1):t?e.replace(/^(?! *$)/gm,t):e}t.indentComment=n,t.lineComment=(e,t,s)=>e.endsWith("\n")?n(s,t):s.includes("\n")?"\n"+n(s,t):(e.endsWith(" ")?"":" ")+s,t.stringifyComment=e=>e.replace(/^(?!$)(?: $)?/gm,"#")},365:function(e,t,n){var s,r=this&&this.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},s(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=s(e),o=0;o<n.length;o++)"default"!==n[o]&&r(t,e,n[o]);return a(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.ProjectView=t.ProjectTreeItem=void 0;const i=o(n(1398)),c=n(8191),l=n(3823);class u extends i.TreeItem{constructor(e,t,n,s,r,a,o,i){super(e,t),this.label=e,this.collapsibleState=t,this.contextValue=n,this.id=s,this.iconPath=r,this.command=a,this.project=o,this.chat=i,this.id=s,this.contextValue=n,this.iconPath=r,this.command=a,this.tooltip=e}}t.ProjectTreeItem=u,t.ProjectView=class{constructor(e){this.context=e,this._onDidChangeTreeData=new i.EventEmitter,this.onDidChangeTreeData=this._onDidChangeTreeData.event,this.projectOrganizer=c.ProjectOrganizer.getInstance(),this.chatProcessor=l.ChatProcessor.getInstance()}refresh(){this._onDidChangeTreeData.fire()}getTreeItem(e){return e}async getChildren(e){if(!e)return[new u("Original Projects",i.TreeItemCollapsibleState.Expanded,"category","original-projects",new i.ThemeIcon("folder")),new u("Custom Projects",i.TreeItemCollapsibleState.Expanded,"category","custom-projects",new i.ThemeIcon("folder"))];if("category"===e.contextValue){if("original-projects"===e.id){const e=this.projectOrganizer.getOriginalProjects();return this.createProjectTreeItems(e,!1)}if("custom-projects"===e.id){const e=this.projectOrganizer.getCustomProjects(),t=this.createProjectTreeItems(e,!0);return t.push(new u("+ New Custom Project",i.TreeItemCollapsibleState.None,"new-project","new-custom-project",new i.ThemeIcon("add"),{command:"cursor-chat-manager.createCustomProject",title:"Create Custom Project",arguments:[]})),t}}return"project"===e.contextValue&&e.project?this.createChatTreeItems(e.project.chats,e.project.id):("chat"===e.contextValue&&e.chat,[])}createProjectTreeItems(e,t){return e.map((e=>{const n=e.chats.length,s=`${e.name} (${n} chat${1!==n?"s":""})`;return new u(s,i.TreeItemCollapsibleState.Collapsed,"project",e.id,new i.ThemeIcon(t?"folder-library":"folder"),{command:"cursor-chat-manager.openProject",title:"Open Project",arguments:[e.id]},e)})).sort(((e,t)=>e.label.localeCompare(t.label)))}createChatTreeItems(e,t){return e.map((e=>{const n=e.dialogues.length,s=`${e.title} (${n} message${1!==n?"s":""})`;return new u(s,i.TreeItemCollapsibleState.None,"chat",e.id,new i.ThemeIcon("comment"),{command:"cursor-chat-manager.openChat",title:"Open Chat",arguments:[e.id,t]},void 0,e)})).sort(((e,t)=>{const n=e.chat?.timestamp,s=t.chat?.timestamp;return n&&s?s.getTime()-n.getTime():e.label.localeCompare(t.label)}))}async loadProjects(){try{const{projects:e,chats:t}=await this.chatProcessor.loadProcessedData();if(0===e.length){const e=await this.chatProcessor.processChats();await this.projectOrganizer.initialize(e.projects),await this.chatProcessor.saveProcessedData(e.projects,e.chats)}else await this.projectOrganizer.initialize(e);this.refresh()}catch(e){console.error(`Error loading projects: ${e}`),i.window.showErrorMessage("Failed to load Cursor chat data. Please try again.")}}}},483:(e,t,n)=>{var s=n(6010),r=n(1386),a=n(8644);t.resolveBlockSeq=function({composeNode:e,composeEmptyNode:t},n,o,i,c){const l=new(c?.nodeClass??s.YAMLSeq)(n.schema);n.atRoot&&(n.atRoot=!1),n.atKey&&(n.atKey=!1);let u=o.offset,d=null;for(const{start:s,value:c}of o.items){const h=r.resolveProps(s,{indicator:"seq-item-ind",next:c,offset:u,onError:i,parentIndent:o.indent,startOnNewline:!0});if(!h.found){if(!(h.anchor||h.tag||c)){d=h.end,h.comment&&(l.comment=h.comment);continue}c&&"block-seq"===c.type?i(h.end,"BAD_INDENT","All sequence items must start at the same column"):i(u,"MISSING_CHAR","Sequence item without - indicator")}const p=c?e(n,c,h,i):t(n,h.end,s,null,h,i);n.schema.compat&&a.flowIndentCheck(o.indent,c,i),u=p.range[2],l.items.push(p)}return l.range=[o.offset,u,d??u],l}},484:(e,t)=>{const n=Symbol.for("yaml.alias"),s=Symbol.for("yaml.document"),r=Symbol.for("yaml.map"),a=Symbol.for("yaml.pair"),o=Symbol.for("yaml.scalar"),i=Symbol.for("yaml.seq"),c=Symbol.for("yaml.node.type"),l=e=>!!e&&"object"==typeof e&&e[c]===o;function u(e){if(e&&"object"==typeof e)switch(e[c]){case r:case i:return!0}return!1}t.ALIAS=n,t.DOC=s,t.MAP=r,t.NODE_TYPE=c,t.PAIR=a,t.SCALAR=o,t.SEQ=i,t.hasAnchor=e=>(l(e)||u(e))&&!!e.anchor,t.isAlias=e=>!!e&&"object"==typeof e&&e[c]===n,t.isCollection=u,t.isDocument=e=>!!e&&"object"==typeof e&&e[c]===s,t.isMap=e=>!!e&&"object"==typeof e&&e[c]===r,t.isNode=function(e){if(e&&"object"==typeof e)switch(e[c]){case n:case r:case o:case i:return!0}return!1},t.isPair=e=>!!e&&"object"==typeof e&&e[c]===a,t.isScalar=l,t.isSeq=e=>!!e&&"object"==typeof e&&e[c]===i},625:(e,t,n)=>{var s=n(484),r=n(3334),a=n(1919),o=n(8531),i=n(975);const c=(e,t)=>e.key<t.key?-1:e.key>t.key?1:0;class l{constructor({compat:e,customTags:t,merge:n,resolveKnownTags:l,schema:u,sortMapEntries:d,toStringDefaults:h}){this.compat=Array.isArray(e)?i.getTags(e,"compat"):e?i.getTags(null,e):null,this.name="string"==typeof u&&u||"core",this.knownTags=l?i.coreKnownTags:{},this.tags=i.getTags(t,this.name,n),this.toStringOptions=h??null,Object.defineProperty(this,s.MAP,{value:r.map}),Object.defineProperty(this,s.SCALAR,{value:o.string}),Object.defineProperty(this,s.SEQ,{value:a.seq}),this.sortMapEntries="function"==typeof d?d:!0===d?c:null}clone(){const e=Object.create(l.prototype,Object.getOwnPropertyDescriptors(this));return e.tags=this.tags.slice(),e}}t.Schema=l},692:(e,t,n)=>{var s=n(484),r=n(3732),a=n(1755),o=n(6010),i=n(8416);class c extends o.YAMLSeq{constructor(){super(),this.add=a.YAMLMap.prototype.add.bind(this),this.delete=a.YAMLMap.prototype.delete.bind(this),this.get=a.YAMLMap.prototype.get.bind(this),this.has=a.YAMLMap.prototype.has.bind(this),this.set=a.YAMLMap.prototype.set.bind(this),this.tag=c.tag}toJSON(e,t){if(!t)return super.toJSON(e);const n=new Map;t?.onCreate&&t.onCreate(n);for(const e of this.items){let a,o;if(s.isPair(e)?(a=r.toJS(e.key,"",t),o=r.toJS(e.value,a,t)):a=r.toJS(e,"",t),n.has(a))throw new Error("Ordered maps must not include duplicate keys");n.set(a,o)}return n}static from(e,t,n){const s=i.createPairs(e,t,n),r=new this;return r.items=s.items,r}}c.tag="tag:yaml.org,2002:omap";const l={collection:"seq",identify:e=>e instanceof Map,nodeClass:c,default:!1,tag:"tag:yaml.org,2002:omap",resolve(e,t){const n=i.resolvePairs(e,t),r=[];for(const{key:e}of n.items)s.isScalar(e)&&(r.includes(e.value)?t(`Ordered maps must not include duplicate keys: ${e.value}`):r.push(e.value));return Object.assign(new c,n)},createNode:(e,t,n)=>c.from(e,t,n)};t.YAMLOMap=c,t.omap=l},857:e=>{e.exports=require("os")},932:e=>{e.exports=require("process")},975:(e,t,n)=>{var s=n(3334),r=n(6055),a=n(1919),o=n(8531),i=n(5132),c=n(988),l=n(2891),u=n(8523),d=n(4988),h=n(8080),p=n(9637),f=n(692),m=n(8416),g=n(5822),y=n(2557),w=n(5437);const v=new Map([["core",u.schema],["failsafe",[s.map,a.seq,o.string]],["json",d.schema],["yaml11",g.schema],["yaml-1.1",g.schema]]),b={binary:h.binary,bool:i.boolTag,float:c.float,floatExp:c.floatExp,floatNaN:c.floatNaN,floatTime:w.floatTime,int:l.int,intHex:l.intHex,intOct:l.intOct,intTime:w.intTime,map:s.map,merge:p.merge,null:r.nullTag,omap:f.omap,pairs:m.pairs,seq:a.seq,set:y.set,timestamp:w.timestamp},S={"tag:yaml.org,2002:binary":h.binary,"tag:yaml.org,2002:merge":p.merge,"tag:yaml.org,2002:omap":f.omap,"tag:yaml.org,2002:pairs":m.pairs,"tag:yaml.org,2002:set":y.set,"tag:yaml.org,2002:timestamp":w.timestamp};t.coreKnownTags=S,t.getTags=function(e,t,n){const s=v.get(t);if(s&&!e)return n&&!s.includes(p.merge)?s.concat(p.merge):s.slice();let r=s;if(!r){if(!Array.isArray(e)){const e=Array.from(v.keys()).filter((e=>"yaml11"!==e)).map((e=>JSON.stringify(e))).join(", ");throw new Error(`Unknown schema "${t}"; use one of ${e} or define customTags array`)}r=[]}if(Array.isArray(e))for(const t of e)r=r.concat(t);else"function"==typeof e&&(r=e(r.slice()));return n&&(r=r.concat(p.merge)),r.reduce(((e,t)=>{const n="string"==typeof t?b[t]:t;if(!n){const e=JSON.stringify(t),n=Object.keys(b).map((e=>JSON.stringify(e))).join(", ");throw new Error(`Unknown custom tag ${e}; use one of ${n}`)}return e.includes(n)||e.push(n),e}),[])}},988:(e,t,n)=>{var s=n(9714),r=n(3144);const a={identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF)|\.nan|\.NaN|\.NAN)$/,resolve:e=>"nan"===e.slice(-3).toLowerCase()?NaN:"-"===e[0]?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:r.stringifyNumber},o={identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:\.[0-9]+|[0-9]+(?:\.[0-9]*)?)[eE][-+]?[0-9]+$/,resolve:e=>parseFloat(e),stringify(e){const t=Number(e.value);return isFinite(t)?t.toExponential():r.stringifyNumber(e)}},i={identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:\.[0-9]+|[0-9]+\.[0-9]*)$/,resolve(e){const t=new s.Scalar(parseFloat(e)),n=e.indexOf(".");return-1!==n&&"0"===e[e.length-1]&&(t.minFractionDigits=e.length-n-1),t},stringify:r.stringifyNumber};t.float=i,t.floatExp=o,t.floatNaN=a},1040:(e,t)=>{t.emptyScalarPosition=function(e,t,n){if(t){n??(n=t.length);for(let s=n-1;s>=0;--s){let n=t[s];switch(n.type){case"space":case"comment":case"newline":e-=n.source.length;continue}for(n=t[++s];"space"===n?.type;)e+=n.source.length,n=t[++s];break}}return e}},1198:(e,t,n)=>{var s=n(4927),r=n(9046),a=n(625),o=n(4355),i=n(1736),c=n(484),l=n(7902),u=n(9714),d=n(1755),h=n(6010),p=n(9112),f=n(5752),m=n(2864),g=n(6247),y=n(1332),w=n(9125);t.Composer=s.Composer,t.Document=r.Document,t.Schema=a.Schema,t.YAMLError=o.YAMLError,t.YAMLParseError=o.YAMLParseError,t.YAMLWarning=o.YAMLWarning,t.Alias=i.Alias,t.isAlias=c.isAlias,t.isCollection=c.isCollection,t.isDocument=c.isDocument,t.isMap=c.isMap,t.isNode=c.isNode,t.isPair=c.isPair,t.isScalar=c.isScalar,t.isSeq=c.isSeq,t.Pair=l.Pair,t.Scalar=u.Scalar,t.YAMLMap=d.YAMLMap,t.YAMLSeq=h.YAMLSeq,t.CST=p,t.Lexer=f.Lexer,t.LineCounter=m.LineCounter,t.Parser=g.Parser,t.parse=y.parse,t.parseAllDocuments=y.parseAllDocuments,t.parseDocument=y.parseDocument,t.stringify=y.stringify,t.visit=w.visit,t.visitAsync=w.visitAsync},1332:(e,t,n)=>{var s=n(4927),r=n(9046),a=n(4355),o=n(7444),i=n(484),c=n(2864),l=n(6247);function u(e){const t=!1!==e.prettyErrors;return{lineCounter:e.lineCounter||t&&new c.LineCounter||null,prettyErrors:t}}function d(e,t={}){const{lineCounter:n,prettyErrors:r}=u(t),o=new l.Parser(n?.addNewLine),i=new s.Composer(t);let c=null;for(const t of i.compose(o.parse(e),!0,e.length))if(c){if("silent"!==c.options.logLevel){c.errors.push(new a.YAMLParseError(t.range.slice(0,2),"MULTIPLE_DOCS","Source contains multiple documents; please use YAML.parseAllDocuments()"));break}}else c=t;return r&&n&&(c.errors.forEach(a.prettifyError(e,n)),c.warnings.forEach(a.prettifyError(e,n))),c}t.parse=function(e,t,n){let s;"function"==typeof t?s=t:void 0===n&&t&&"object"==typeof t&&(n=t);const r=d(e,n);if(!r)return null;if(r.warnings.forEach((e=>o.warn(r.options.logLevel,e))),r.errors.length>0){if("silent"!==r.options.logLevel)throw r.errors[0];r.errors=[]}return r.toJS(Object.assign({reviver:s},n))},t.parseAllDocuments=function(e,t={}){const{lineCounter:n,prettyErrors:r}=u(t),o=new l.Parser(n?.addNewLine),i=new s.Composer(t),c=Array.from(i.compose(o.parse(e)));if(r&&n)for(const t of c)t.errors.forEach(a.prettifyError(e,n)),t.warnings.forEach(a.prettifyError(e,n));return c.length>0?c:Object.assign([],{empty:!0},i.streamInfo())},t.parseDocument=d,t.stringify=function(e,t,n){let s=null;if("function"==typeof t||Array.isArray(t)?s=t:void 0===n&&t&&(n=t),"string"==typeof n&&(n=n.length),"number"==typeof n){const e=Math.round(n);n=e<1?void 0:e>8?{indent:8}:{indent:e}}if(void 0===e){const{keepUndefined:e}=n??t??{};if(!e)return}return i.isDocument(e)&&!s?e.toString(n):new r.Document(e,s,n).toString(n)}},1386:(e,t)=>{t.resolveProps=function(e,{flow:t,indicator:n,next:s,offset:r,onError:a,parentIndent:o,startOnNewline:i}){let c=!1,l=i,u=i,d="",h="",p=!1,f=!1,m=null,g=null,y=null,w=null,v=null,b=null,S=null;for(const r of e)switch(f&&("space"!==r.type&&"newline"!==r.type&&"comma"!==r.type&&a(r.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),f=!1),m&&(l&&"comment"!==r.type&&"newline"!==r.type&&a(m,"TAB_AS_INDENT","Tabs are not allowed as indentation"),m=null),r.type){case"space":t||"doc-start"===n&&"flow-collection"===s?.type||!r.source.includes("\t")||(m=r),u=!0;break;case"comment":{u||a(r,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");const e=r.source.substring(1)||" ";d?d+=h+e:d=e,h="",l=!1;break}case"newline":l?d?d+=r.source:b&&"seq-item-ind"===n||(c=!0):h+=r.source,l=!0,p=!0,(g||y)&&(w=r),u=!0;break;case"anchor":g&&a(r,"MULTIPLE_ANCHORS","A node can have at most one anchor"),r.source.endsWith(":")&&a(r.offset+r.source.length-1,"BAD_ALIAS","Anchor ending in : is ambiguous",!0),g=r,S??(S=r.offset),l=!1,u=!1,f=!0;break;case"tag":y&&a(r,"MULTIPLE_TAGS","A node can have at most one tag"),y=r,S??(S=r.offset),l=!1,u=!1,f=!0;break;case n:(g||y)&&a(r,"BAD_PROP_ORDER",`Anchors and tags must be after the ${r.source} indicator`),b&&a(r,"UNEXPECTED_TOKEN",`Unexpected ${r.source} in ${t??"collection"}`),b=r,l="seq-item-ind"===n||"explicit-key-ind"===n,u=!1;break;case"comma":if(t){v&&a(r,"UNEXPECTED_TOKEN",`Unexpected , in ${t}`),v=r,l=!1,u=!1;break}default:a(r,"UNEXPECTED_TOKEN",`Unexpected ${r.type} token`),l=!1,u=!1}const E=e[e.length-1],k=E?E.offset+E.source.length:r;return f&&s&&"space"!==s.type&&"newline"!==s.type&&"comma"!==s.type&&("scalar"!==s.type||""!==s.source)&&a(s.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),m&&(l&&m.indent<=o||"block-map"===s?.type||"block-seq"===s?.type)&&a(m,"TAB_AS_INDENT","Tabs are not allowed as indentation"),{comma:v,found:b,spaceBefore:c,comment:d,hasNewline:p,anchor:g,tag:y,newlineAfterProp:w,end:k,start:S??k}}},1398:e=>{e.exports=require("vscode")},1509:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DialogueImpl=void 0;const s=n(9561),r=n(6899);class a{constructor(e,t,n,s,r,a=[],o){this.id=e,this.chatId=t,this.content=n,this.isUser=s,this.timestamp=r,this.tags=a,this.metadata=o}addTag(e){this.tags.includes(e)||this.tags.push(e)}removeTag(e){const t=this.tags.length;return this.tags=this.tags.filter((t=>t!==e)),this.tags.length!==t}extractToNewChat(e){return new s.ChatImpl((0,r.v4)(),e||`Extracted from ${this.chatId} - ${(new Date).toLocaleString()}`,new Date,"",[this],[],{extractedFrom:this.chatId,extractedDialogue:this.id})}serialize(){return{id:this.id,chatId:this.chatId,content:this.content,isUser:this.isUser,timestamp:this.timestamp.toISOString(),tags:this.tags,metadata:this.metadata}}static deserialize(e){return new a(e.id,e.chatId,e.content,e.isUser,new Date(e.timestamp),Array.isArray(e.tags)?e.tags:[],e.metadata)}}t.DialogueImpl=a},1614:(e,t,n)=>{var s=n(5219),r=n(484),a=n(8898);function o(e,t,n){let r=n;for(let e=t.length-1;e>=0;--e){const n=t[e];if("number"==typeof n&&Number.isInteger(n)&&n>=0){const e=[];e[n]=r,r=e}else r=new Map([[n,r]])}return s.createNode(r,void 0,{aliasDuplicateObjects:!1,keepUndefined:!1,onAnchor:()=>{throw new Error("This should not happen, please report a bug.")},schema:e,sourceObjects:new Map})}const i=e=>null==e||"object"==typeof e&&!!e[Symbol.iterator]().next().done;class c extends a.NodeBase{constructor(e,t){super(e),Object.defineProperty(this,"schema",{value:t,configurable:!0,enumerable:!1,writable:!0})}clone(e){const t=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return e&&(t.schema=e),t.items=t.items.map((t=>r.isNode(t)||r.isPair(t)?t.clone(e):t)),this.range&&(t.range=this.range.slice()),t}addIn(e,t){if(i(e))this.add(t);else{const[n,...s]=e,a=this.get(n,!0);if(r.isCollection(a))a.addIn(s,t);else{if(void 0!==a||!this.schema)throw new Error(`Expected YAML collection at ${n}. Remaining path: ${s}`);this.set(n,o(this.schema,s,t))}}}deleteIn(e){const[t,...n]=e;if(0===n.length)return this.delete(t);const s=this.get(t,!0);if(r.isCollection(s))return s.deleteIn(n);throw new Error(`Expected YAML collection at ${t}. Remaining path: ${n}`)}getIn(e,t){const[n,...s]=e,a=this.get(n,!0);return 0===s.length?!t&&r.isScalar(a)?a.value:a:r.isCollection(a)?a.getIn(s,t):void 0}hasAllNullValues(e){return this.items.every((t=>{if(!r.isPair(t))return!1;const n=t.value;return null==n||e&&r.isScalar(n)&&null==n.value&&!n.commentBefore&&!n.comment&&!n.tag}))}hasIn(e){const[t,...n]=e;if(0===n.length)return this.has(t);const s=this.get(t,!0);return!!r.isCollection(s)&&s.hasIn(n)}setIn(e,t){const[n,...s]=e;if(0===s.length)this.set(n,t);else{const e=this.get(n,!0);if(r.isCollection(e))e.setIn(s,t);else{if(void 0!==e||!this.schema)throw new Error(`Expected YAML collection at ${n}. Remaining path: ${s}`);this.set(n,o(this.schema,s,t))}}}}t.Collection=c,t.collectionFromPath=o,t.isEmptyPath=i},1736:(e,t,n)=>{var s=n(6261),r=n(9125),a=n(484),o=n(8898),i=n(3732);class c extends o.NodeBase{constructor(e){super(a.ALIAS),this.source=e,Object.defineProperty(this,"tag",{set(){throw new Error("Alias nodes cannot have tags")}})}resolve(e,t){let n,s;t?.aliasResolveCache?n=t.aliasResolveCache:(n=[],r.visit(e,{Node:(e,t)=>{(a.isAlias(t)||a.hasAnchor(t))&&n.push(t)}}),t&&(t.aliasResolveCache=n));for(const e of n){if(e===this)break;e.anchor===this.source&&(s=e)}return s}toJSON(e,t){if(!t)return{source:this.source};const{anchors:n,doc:s,maxAliasCount:r}=t,a=this.resolve(s,t);if(!a){const e=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new ReferenceError(e)}let o=n.get(a);if(o||(i.toJS(a,null,t),o=n.get(a)),!o||void 0===o.res)throw new ReferenceError("This should not happen: Alias anchor was not resolved?");if(r>=0&&(o.count+=1,0===o.aliasCount&&(o.aliasCount=l(s,a,n)),o.count*o.aliasCount>r))throw new ReferenceError("Excessive alias count indicates a resource exhaustion attack");return o.res}toString(e,t,n){const r=`*${this.source}`;if(e){if(s.anchorIsValid(this.source),e.options.verifyAliasOrder&&!e.anchors.has(this.source)){const e=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new Error(e)}if(e.implicitKey)return`${r} `}return r}}function l(e,t,n){if(a.isAlias(t)){const s=t.resolve(e),r=n&&s&&n.get(s);return r?r.count*r.aliasCount:0}if(a.isCollection(t)){let s=0;for(const r of t.items){const t=l(e,r,n);t>s&&(s=t)}return s}if(a.isPair(t)){const s=l(e,t.key,n),r=l(e,t.value,n);return Math.max(s,r)}return 1}t.Alias=c},1755:(e,t,n)=>{var s=n(81),r=n(5139),a=n(1614),o=n(484),i=n(7902),c=n(9714);function l(e,t){const n=o.isScalar(t)?t.value:t;for(const s of e)if(o.isPair(s)){if(s.key===t||s.key===n)return s;if(o.isScalar(s.key)&&s.key.value===n)return s}}class u extends a.Collection{static get tagName(){return"tag:yaml.org,2002:map"}constructor(e){super(o.MAP,e),this.items=[]}static from(e,t,n){const{keepUndefined:s,replacer:r}=n,a=new this(e),o=(e,o)=>{if("function"==typeof r)o=r.call(t,e,o);else if(Array.isArray(r)&&!r.includes(e))return;(void 0!==o||s)&&a.items.push(i.createPair(e,o,n))};if(t instanceof Map)for(const[e,n]of t)o(e,n);else if(t&&"object"==typeof t)for(const e of Object.keys(t))o(e,t[e]);return"function"==typeof e.sortMapEntries&&a.items.sort(e.sortMapEntries),a}add(e,t){let n;n=o.isPair(e)?e:e&&"object"==typeof e&&"key"in e?new i.Pair(e.key,e.value):new i.Pair(e,e?.value);const s=l(this.items,n.key),r=this.schema?.sortMapEntries;if(s){if(!t)throw new Error(`Key ${n.key} already set`);o.isScalar(s.value)&&c.isScalarValue(n.value)?s.value.value=n.value:s.value=n.value}else if(r){const e=this.items.findIndex((e=>r(n,e)<0));-1===e?this.items.push(n):this.items.splice(e,0,n)}else this.items.push(n)}delete(e){const t=l(this.items,e);return!!t&&this.items.splice(this.items.indexOf(t),1).length>0}get(e,t){const n=l(this.items,e),s=n?.value;return(!t&&o.isScalar(s)?s.value:s)??void 0}has(e){return!!l(this.items,e)}set(e,t){this.add(new i.Pair(e,t),!0)}toJSON(e,t,n){const s=n?new n:t?.mapAsMap?new Map:{};t?.onCreate&&t.onCreate(s);for(const e of this.items)r.addPairToJSMap(t,s,e);return s}toString(e,t,n){if(!e)return JSON.stringify(this);for(const e of this.items)if(!o.isPair(e))throw new Error(`Map items must all be pairs; found ${JSON.stringify(e)} instead`);return!e.allNullValues&&this.hasAllNullValues(!1)&&(e=Object.assign({},e,{allNullValues:!0})),s.stringifyCollection(this,e,{blockItemPrefix:"",flowChars:{start:"{",end:"}"},itemIndent:e.indent||"",onChompKeep:n,onComment:t})}}t.YAMLMap=u,t.findPair=l},1768:(e,t,n)=>{var s=n(484),r=n(3793),a=n(248);t.stringifyDocument=function(e,t){const n=[];let o=!0===t.directives;if(!1!==t.directives&&e.directives){const t=e.directives.toString(e);t?(n.push(t),o=!0):e.directives.docStart&&(o=!0)}o&&n.push("---");const i=r.createStringifyContext(e,t),{commentString:c}=i.options;if(e.commentBefore){1!==n.length&&n.unshift("");const t=c(e.commentBefore);n.unshift(a.indentComment(t,""))}let l=!1,u=null;if(e.contents){if(s.isNode(e.contents)){if(e.contents.spaceBefore&&o&&n.push(""),e.contents.commentBefore){const t=c(e.contents.commentBefore);n.push(a.indentComment(t,""))}i.forceBlockIndent=!!e.comment,u=e.contents.comment}const t=u?void 0:()=>l=!0;let d=r.stringify(e.contents,i,(()=>u=null),t);u&&(d+=a.lineComment(d,"",c(u))),"|"!==d[0]&&">"!==d[0]||"---"!==n[n.length-1]?n.push(d):n[n.length-1]=`--- ${d}`}else n.push(r.stringify(e.contents,i));if(e.directives?.docEnd)if(e.comment){const t=c(e.comment);t.includes("\n")?(n.push("..."),n.push(a.indentComment(t,""))):n.push(`... ${t}`)}else n.push("...");else{let t=e.comment;t&&l&&(t=t.replace(/^\n+/,"")),t&&(l&&!u||""===n[n.length-1]||n.push(""),n.push(a.indentComment(c(t),"")))}return n.join("\n")+"\n"}},1919:(e,t,n)=>{var s=n(484),r=n(6010);const a={collection:"seq",default:!0,nodeClass:r.YAMLSeq,tag:"tag:yaml.org,2002:seq",resolve:(e,t)=>(s.isSeq(e)||t("Expected a sequence for this tag"),e),createNode:(e,t,n)=>r.YAMLSeq.from(e,t,n)};t.seq=a},1943:e=>{e.exports=require("fs/promises")},2206:(e,t,n)=>{var s=n(9046),r=n(2782),a=n(6845),o=n(1386);t.composeDoc=function(e,t,{offset:n,start:i,value:c,end:l},u){const d=Object.assign({_directives:t},e),h=new s.Document(void 0,d),p={atKey:!1,atRoot:!0,directives:h.directives,options:h.options,schema:h.schema},f=o.resolveProps(i,{indicator:"doc-start",next:c??l?.[0],offset:n,onError:u,parentIndent:0,startOnNewline:!0});f.found&&(h.directives.docStart=!0,!c||"block-map"!==c.type&&"block-seq"!==c.type||f.hasNewline||u(f.end,"MISSING_CHAR","Block collection cannot start on same line with directives-end marker")),h.contents=c?r.composeNode(p,c,f,u):r.composeEmptyNode(p,f.end,i,null,f,u);const m=h.contents.range[2],g=a.resolveEnd(l,m,!1,u);return g.comment&&(h.comment=g.comment),h.range=[n,m,g.offset],h}},2291:(e,t,n)=>{var s=n(484),r=n(7902),a=n(1755),o=n(6010),i=n(6845),c=n(1386),l=n(9378),u=n(8334);const d="Block collections are not allowed within flow collections",h=e=>e&&("block-map"===e.type||"block-seq"===e.type);t.resolveFlowCollection=function({composeNode:e,composeEmptyNode:t},n,p,f,m){const g="{"===p.start.source,y=g?"flow map":"flow sequence",w=new(m?.nodeClass??(g?a.YAMLMap:o.YAMLSeq))(n.schema);w.flow=!0;const v=n.atRoot;v&&(n.atRoot=!1),n.atKey&&(n.atKey=!1);let b=p.offset+p.start.source.length;for(let o=0;o<p.items.length;++o){const i=p.items[o],{start:m,key:v,sep:S,value:E}=i,k=c.resolveProps(m,{flow:y,indicator:"explicit-key-ind",next:v??S?.[0],offset:b,onError:f,parentIndent:p.indent,startOnNewline:!1});if(!k.found){if(!(k.anchor||k.tag||S||E)){0===o&&k.comma?f(k.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${y}`):o<p.items.length-1&&f(k.start,"UNEXPECTED_TOKEN",`Unexpected empty item in ${y}`),k.comment&&(w.comment?w.comment+="\n"+k.comment:w.comment=k.comment),b=k.end;continue}!g&&n.options.strict&&l.containsNewline(v)&&f(v,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line")}if(0===o)k.comma&&f(k.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${y}`);else if(k.comma||f(k.start,"MISSING_CHAR",`Missing , between ${y} items`),k.comment){let e="";e:for(const t of m)switch(t.type){case"comma":case"space":break;case"comment":e=t.source.substring(1);break e;default:break e}if(e){let t=w.items[w.items.length-1];s.isPair(t)&&(t=t.value??t.key),t.comment?t.comment+="\n"+e:t.comment=e,k.comment=k.comment.substring(e.length+1)}}if(g||S||k.found){n.atKey=!0;const s=k.end,o=v?e(n,v,k,f):t(n,s,m,null,k,f);h(v)&&f(o.range,"BLOCK_IN_FLOW",d),n.atKey=!1;const l=c.resolveProps(S??[],{flow:y,indicator:"map-value-ind",next:E,offset:o.range[2],onError:f,parentIndent:p.indent,startOnNewline:!1});if(l.found){if(!g&&!k.found&&n.options.strict){if(S)for(const e of S){if(e===l.found)break;if("newline"===e.type){f(e,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line");break}}k.start<l.found.offset-1024&&f(l.found,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit flow sequence key")}}else E&&("source"in E&&E.source&&":"===E.source[0]?f(E,"MISSING_CHAR",`Missing space after : in ${y}`):f(l.start,"MISSING_CHAR",`Missing , or : between ${y} items`));const P=E?e(n,E,l,f):l.found?t(n,l.end,S,null,l,f):null;P?h(E)&&f(P.range,"BLOCK_IN_FLOW",d):l.comment&&(o.comment?o.comment+="\n"+l.comment:o.comment=l.comment);const I=new r.Pair(o,P);if(n.options.keepSourceTokens&&(I.srcToken=i),g){const e=w;u.mapIncludes(n,e.items,o)&&f(s,"DUPLICATE_KEY","Map keys must be unique"),e.items.push(I)}else{const e=new a.YAMLMap(n.schema);e.flow=!0,e.items.push(I);const t=(P??o).range;e.range=[o.range[0],t[1],t[2]],w.items.push(e)}b=P?P.range[2]:l.end}else{const s=E?e(n,E,k,f):t(n,k.end,S,null,k,f);w.items.push(s),b=s.range[2],h(E)&&f(s.range,"BLOCK_IN_FLOW",d)}}const S=g?"}":"]",[E,...k]=p.end;let P=b;if(E&&E.source===S)P=E.offset+E.source.length;else{const e=y[0].toUpperCase()+y.substring(1);f(b,v?"MISSING_CHAR":"BAD_INDENT",v?`${e} must end with a ${S}`:`${e} in block collection must be sufficiently indented and end with a ${S}`),E&&1!==E.source.length&&k.unshift(E)}if(k.length>0){const e=i.resolveEnd(k,P,n.options.strict,f);e.comment&&(w.comment?w.comment+="\n"+e.comment:w.comment=e.comment),w.range=[p.offset,P,e.offset]}else w.range=[p.offset,P,P];return w}},2557:(e,t,n)=>{var s=n(484),r=n(7902),a=n(1755);class o extends a.YAMLMap{constructor(e){super(e),this.tag=o.tag}add(e){let t;t=s.isPair(e)?e:e&&"object"==typeof e&&"key"in e&&"value"in e&&null===e.value?new r.Pair(e.key,null):new r.Pair(e,null),a.findPair(this.items,t.key)||this.items.push(t)}get(e,t){const n=a.findPair(this.items,e);return!t&&s.isPair(n)?s.isScalar(n.key)?n.key.value:n.key:n}set(e,t){if("boolean"!=typeof t)throw new Error("Expected boolean value for set(key, value) in a YAML set, not "+typeof t);const n=a.findPair(this.items,e);n&&!t?this.items.splice(this.items.indexOf(n),1):!n&&t&&this.items.push(new r.Pair(e))}toJSON(e,t){return super.toJSON(e,t,Set)}toString(e,t,n){if(!e)return JSON.stringify(this);if(this.hasAllNullValues(!0))return super.toString(Object.assign({},e,{allNullValues:!0}),t,n);throw new Error("Set items must all have null values")}static from(e,t,n){const{replacer:s}=n,a=new this(e);if(t&&Symbol.iterator in Object(t))for(let e of t)"function"==typeof s&&(e=s.call(t,e,e)),a.items.push(r.createPair(e,null,n));return a}}o.tag="tag:yaml.org,2002:set";const i={collection:"map",identify:e=>e instanceof Set,nodeClass:o,default:!1,tag:"tag:yaml.org,2002:set",createNode:(e,t,n)=>o.from(e,t,n),resolve(e,t){if(s.isMap(e)){if(e.hasAllNullValues(!0))return Object.assign(new o,e);t("Set items must all have null values")}else t("Expected a mapping for this tag");return e}};t.YAMLSet=o,t.set=i},2715:function(e,t,n){var s,r=this&&this.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},s(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=s(e),o=0;o<n.length;o++)"default"!==n[o]&&r(t,e,n[o]);return a(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.registerPromptCommands=function(e,t){const n=l.PromptManager.getInstance(),s=i.commands.registerCommand("cursor-chat-manager.createPrompt",(async()=>{try{const e=await i.window.showInputBox({prompt:"Enter a title for the prompt template",placeHolder:"Prompt Title",validateInput:e=>e?null:"Title is required"});if(!e)return;const s=await i.window.showInputBox({prompt:"Enter the prompt template (use {{variable}} for variables)",placeHolder:"Generate a {{language}} class named {{className}} that implements {{interface}}",validateInput:e=>e?null:"Template is required"});if(!s)return;const r=s.match(/{{(\s*[\w\d]+\s*)}}/g)||[],a=new Set;r.forEach((e=>{const t=e.replace(/{{|}}/g,"").trim();a.add(t)}));const o=[];for(const e of a){const t=await i.window.showInputBox({prompt:`Enter description for variable "${e}"`,placeHolder:`Description for ${e}`,validateInput:e=>e?null:"Description is required"});if(!t)return;const n=await i.window.showInputBox({prompt:`Enter default value for variable "${e}" (optional)`,placeHolder:`Default value for ${e}`});o.push(new u.VariableImpl(`var-${Date.now()}-${o.length}`,e,t,n||""))}const c=await n.getCategories();let l;if(c.length>0){const e=[{label:"+ Create New Category",value:"new"},...c.map((e=>({label:e,value:e})))],t=await i.window.showQuickPick(e,{placeHolder:"Select or create a category"});if(!t)return;if("new"===t.value){const e=await i.window.showInputBox({prompt:"Enter a name for the new category",placeHolder:"Category Name",validateInput:e=>e?null:"Category name is required"});if(!e)return;l=e}else l=t.value}else{const e=await i.window.showInputBox({prompt:"Enter a name for the category",placeHolder:"Category Name",validateInput:e=>e?null:"Category name is required"});if(!e)return;l=e}const d=await i.window.showInputBox({prompt:"Enter tags for the prompt (comma-separated)",placeHolder:"tag1, tag2, tag3"}),h=d?d.split(",").map((e=>e.trim())).filter(Boolean):[],p=await n.createPrompt(e,s,l,h);t.refresh(),i.window.showInformationMessage(`Prompt template "${p.title}" created`)}catch(e){i.window.showErrorMessage(`Failed to create prompt: ${e instanceof Error?e.message:String(e)}`)}})),r=i.commands.registerCommand("cursor-chat-manager.usePrompt",(async e=>{try{const t=await n.getPromptById(e);if(!t)return void i.window.showErrorMessage("Prompt not found");const s={};for(const e of t.variables){const t=await i.window.showInputBox({prompt:e.description||`Enter value for ${e.name}`,placeHolder:e.name,value:e.defaultValue||""});if(void 0===t)return;s[e.name]=t}const r=await n.fillPromptTemplate(e,s);if(!r)return void i.window.showErrorMessage("Failed to fill prompt template");const a=await i.window.showQuickPick([{label:"Copy to Clipboard",value:"copy"},{label:"Insert at Cursor",value:"insert"}],{placeHolder:"What would you like to do with the prompt?"});if(!a)return;if("copy"===a.value)await i.env.clipboard.writeText(r),i.window.showInformationMessage("Prompt copied to clipboard");else if("insert"===a.value){const e=i.window.activeTextEditor;e?(await e.edit((t=>{t.insert(e.selection.active,r)})),i.window.showInformationMessage("Prompt inserted at cursor")):i.window.showErrorMessage("No active text editor")}}catch(e){i.window.showErrorMessage(`Error: ${e instanceof Error?e.message:String(e)}`)}})),a=i.commands.registerCommand("cursor-chat-manager.editPrompt",(async e=>{try{const s=await n.getPromptById(e);if(!s)return void i.window.showErrorMessage("Prompt not found");const r=await i.window.showInputBox({prompt:"Enter a title for the prompt template",placeHolder:"Prompt Title",value:s.title,validateInput:e=>e?null:"Title is required"});if(!r)return;const a=await i.window.showInputBox({prompt:"Enter the prompt template (use {{variable}} for variables)",placeHolder:"Generate a {{language}} class named {{className}} that implements {{interface}}",value:s.template,validateInput:e=>e?null:"Template is required"});if(!a)return;const o=await n.getCategories();let c;if(o.length>0){const e=[{label:"+ Create New Category",value:"new"},...o.map((e=>({label:e,value:e})))],t=await i.window.showQuickPick(e,{placeHolder:"Select or create a category"});if(!t)return;if("new"===t.value){const e=await i.window.showInputBox({prompt:"Enter a name for the new category",placeHolder:"Category Name",validateInput:e=>e?null:"Category name is required"});if(!e)return;c=e}else c=t.value}else{const e=await i.window.showInputBox({prompt:"Enter a name for the category",placeHolder:"Category Name",value:s.category,validateInput:e=>e?null:"Category name is required"});if(!e)return;c=e}const l=await i.window.showInputBox({prompt:"Enter tags for the prompt (comma-separated)",placeHolder:"tag1, tag2, tag3",value:s.tags.join(", ")}),u=l?l.split(",").map((e=>e.trim())).filter(Boolean):[];await n.updatePrompt(e,{title:r,template:a,category:c,tags:u})?(t.refresh(),i.window.showInformationMessage(`Prompt template "${r}" updated`)):i.window.showErrorMessage("Failed to update prompt template")}catch(e){i.window.showErrorMessage(`Error: ${e instanceof Error?e.message:String(e)}`)}})),o=i.commands.registerCommand("cursor-chat-manager.deletePrompt",(async e=>{try{const s=await n.getPromptById(e);if(!s)return void i.window.showErrorMessage("Prompt not found");if("Delete"!==await i.window.showWarningMessage(`Are you sure you want to delete the prompt template "${s.title}"?`,{modal:!0},"Delete","Cancel"))return;await n.deletePrompt(e)?(t.refresh(),i.window.showInformationMessage(`Prompt template "${s.title}" deleted`)):i.window.showErrorMessage(`Failed to delete prompt template "${s.title}"`)}catch(e){i.window.showErrorMessage(`Error: ${e instanceof Error?e.message:String(e)}`)}})),d=i.commands.registerCommand("cursor-chat-manager.importPrompts",(async()=>{try{const e=await i.window.showOpenDialog({canSelectMany:!1,filters:{"JSON Files":["json"]},title:"Select Prompts File to Import"});if(!e||0===e.length)return;const s=await n.importPrompts(e[0].fsPath);t.refresh(),i.window.showInformationMessage(`${s} prompt templates imported`)}catch(e){i.window.showErrorMessage(`Failed to import prompts: ${e instanceof Error?e.message:String(e)}`)}})),h=i.commands.registerCommand("cursor-chat-manager.exportPrompts",(async e=>{try{let t=e||[];if(!t.length){const e=(await n.getPrompts()).map((e=>({label:e.title,description:e.category,id:e.id,picked:!1}))),s=await i.window.showQuickPick(e,{placeHolder:"Select prompts to export",canPickMany:!0});if(!s||0===s.length)return;t=s.map((e=>e.id))}const s=i.Uri.file(c.join(await i.env.appRoot||"","cursor_prompts.json")),r=await i.window.showSaveDialog({defaultUri:s,filters:{"JSON Files":["json"]},saveLabel:"Export Prompts",title:"Export Prompt Templates"});if(!r)return;await n.exportPrompts(t,r.fsPath)?i.window.showInformationMessage(`${t.length} prompt templates exported successfully`):i.window.showErrorMessage("Failed to export prompt templates")}catch(e){i.window.showErrorMessage(`Error: ${e instanceof Error?e.message:String(e)}`)}}));e.subscriptions.push(s,r,a,o,d,h)};const i=o(n(1398)),c=o(n(6928)),l=n(8272),u=n(7917)},2782:(e,t,n)=>{var s=n(1736),r=n(484),a=n(18),o=n(9094),i=n(6845),c=n(1040);const l={composeNode:u,composeEmptyNode:d};function u(e,t,n,c){const u=e.atKey,{spaceBefore:h,comment:p,anchor:f,tag:m}=n;let g,y=!0;switch(t.type){case"alias":g=function({options:e},{offset:t,source:n,end:r},a){const o=new s.Alias(n.substring(1));""===o.source&&a(t,"BAD_ALIAS","Alias cannot be an empty string"),o.source.endsWith(":")&&a(t+n.length-1,"BAD_ALIAS","Alias ending in : is ambiguous",!0);const c=t+n.length,l=i.resolveEnd(r,c,e.strict,a);return o.range=[t,c,l.offset],l.comment&&(o.comment=l.comment),o}(e,t,c),(f||m)&&c(t,"ALIAS_PROPS","An alias node must not specify any properties");break;case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"block-scalar":g=o.composeScalar(e,t,m,c),f&&(g.anchor=f.source.substring(1));break;case"block-map":case"block-seq":case"flow-collection":g=a.composeCollection(l,e,t,n,c),f&&(g.anchor=f.source.substring(1));break;default:c(t,"UNEXPECTED_TOKEN","error"===t.type?t.message:`Unsupported token (type: ${t.type})`),g=d(e,t.offset,void 0,null,n,c),y=!1}return f&&""===g.anchor&&c(f,"BAD_ALIAS","Anchor cannot be an empty string"),u&&e.options.stringKeys&&(!r.isScalar(g)||"string"!=typeof g.value||g.tag&&"tag:yaml.org,2002:str"!==g.tag)&&c(m??t,"NON_STRING_KEY","With stringKeys, all keys must be strings"),h&&(g.spaceBefore=!0),p&&("scalar"===t.type&&""===t.source?g.comment=p:g.commentBefore=p),e.options.keepSourceTokens&&y&&(g.srcToken=t),g}function d(e,t,n,s,{spaceBefore:r,comment:a,anchor:i,tag:l,end:u},d){const h={type:"scalar",offset:c.emptyScalarPosition(t,n,s),indent:-1,source:""},p=o.composeScalar(e,h,l,d);return i&&(p.anchor=i.source.substring(1),""===p.anchor&&d(i,"BAD_ALIAS","Anchor cannot be an empty string")),r&&(p.spaceBefore=!0),a&&(p.comment=a,p.range[2]=u),p}t.composeEmptyNode=d,t.composeNode=u},2864:(e,t)=>{t.LineCounter=class{constructor(){this.lineStarts=[],this.addNewLine=e=>this.lineStarts.push(e),this.linePos=e=>{let t=0,n=this.lineStarts.length;for(;t<n;){const s=t+n>>1;this.lineStarts[s]<e?t=s+1:n=s}return this.lineStarts[t]===e?{line:t+1,col:1}:0===t?{line:0,col:e}:{line:t,col:e-this.lineStarts[t-1]+1}}}}},2891:(e,t,n)=>{var s=n(3144);const r=e=>"bigint"==typeof e||Number.isInteger(e),a=(e,t,n,{intAsBigInt:s})=>s?BigInt(e):parseInt(e.substring(t),n);function o(e,t,n){const{value:a}=e;return r(a)&&a>=0?n+a.toString(t):s.stringifyNumber(e)}const i={identify:e=>r(e)&&e>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^0o[0-7]+$/,resolve:(e,t,n)=>a(e,2,8,n),stringify:e=>o(e,8,"0o")},c={identify:r,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9]+$/,resolve:(e,t,n)=>a(e,0,10,n),stringify:s.stringifyNumber},l={identify:e=>r(e)&&e>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^0x[0-9a-fA-F]+$/,resolve:(e,t,n)=>a(e,2,16,n),stringify:e=>o(e,16,"0x")};t.int=c,t.intHex=l,t.intOct=i},3058:function(e,t,n){var s,r=this&&this.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},s(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=s(e),o=0;o<n.length;o++)"default"!==n[o]&&r(t,e,n[o]);return a(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.RuleView=t.RuleTreeItem=void 0;const i=o(n(1398)),c=n(9240),l=n(8191);class u extends i.TreeItem{constructor(e,t,n,s,r,a,o,i){super(e,t),this.label=e,this.collapsibleState=t,this.contextValue=n,this.id=s,this.iconPath=r,this.command=a,this.rule=o,this.projectId=i,this.id=s,this.contextValue=n,this.iconPath=r,this.command=a,this.tooltip=e}}t.RuleTreeItem=u,t.RuleView=class{constructor(e){this.context=e,this._onDidChangeTreeData=new i.EventEmitter,this.onDidChangeTreeData=this._onDidChangeTreeData.event,this.ruleManager=c.RuleManager.getInstance(),this.projectOrganizer=l.ProjectOrganizer.getInstance()}refresh(){this._onDidChangeTreeData.fire()}getTreeItem(e){return e}async getChildren(e){if(!e)return[new u("Global Rules",i.TreeItemCollapsibleState.Expanded,"category","global-rules",new i.ThemeIcon("globe")),new u("Project Rules",i.TreeItemCollapsibleState.Expanded,"category","project-rules",new i.ThemeIcon("folder"))];if("category"===e.contextValue){if("global-rules"===e.id){const e=await this.ruleManager.getGlobalRules();if(0===e.length)return[new u("No global rules found",i.TreeItemCollapsibleState.None,"empty","no-global-rules",new i.ThemeIcon("info"))];const t=new Map;t.set("Uncategorized",[]);for(const n of e)if(n.tags&&n.tags.length>0)for(const e of n.tags)t.has(e)||t.set(e,[]),t.get(e).push(n);else t.get("Uncategorized").push(n);const n=[];for(const[e,s]of t.entries())0!==s.length&&n.push(new u(e,i.TreeItemCollapsibleState.Expanded,"tag-group",`tag-${e}`,new i.ThemeIcon("tag"),void 0,void 0,void 0));return n.sort(((e,t)=>e.label.localeCompare(t.label)))}if("project-rules"===e.id){const e=await this.projectOrganizer.getAllProjects();return 0===e.length?[new u("No projects found",i.TreeItemCollapsibleState.None,"empty","no-projects",new i.ThemeIcon("info"))]:e.map((e=>new u(e.name,i.TreeItemCollapsibleState.Collapsed,"project",`project-${e.id}`,new i.ThemeIcon("folder"),void 0,void 0,e.id)))}}if("tag-group"===e.contextValue){const t=e.label,n=await this.ruleManager.getGlobalRules();let s;return s="Uncategorized"===t?n.filter((e=>!e.tags||0===e.tags.length)):n.filter((e=>e.tags&&e.tags.includes(t))),s.map((e=>new u(e.name,i.TreeItemCollapsibleState.None,"rule",e.id,new i.ThemeIcon("file-code"),{command:"cursor-chat-manager.viewRule",title:"View Rule",arguments:[e.id]},e)))}if("project"===e.contextValue&&e.projectId){const t=await this.ruleManager.getProjectRules(e.projectId);return 0===t.length?[new u("No rules for this project",i.TreeItemCollapsibleState.None,"empty",`no-rules-${e.projectId}`,new i.ThemeIcon("info"))]:t.map((e=>new u(e.name,i.TreeItemCollapsibleState.None,"rule",e.id,new i.ThemeIcon("file-code"),{command:"cursor-chat-manager.viewRule",title:"View Rule",arguments:[e.id]},e)))}return[]}async viewRule(e){const t=await this.ruleManager.getRuleById(e);t?i.window.createWebviewPanel("cursor-chat-manager.ruleView",`Rule: ${t.name}`,i.ViewColumn.One,{enableScripts:!0}).webview.html=this.getRuleHtml(t):i.window.showErrorMessage("Rule not found")}getRuleHtml(e){const t=e.tags&&e.tags.length>0?e.tags.map((e=>`<span class="tag">${this.escapeHtml(e)}</span>`)).join(" "):'<span class="tag-empty">No tags</span>',n=e.appliedProjects&&e.appliedProjects.length>0?`<p><strong>Applied to: </strong> ${e.appliedProjects.length} project(s)</p>`:"<p><strong>Applied to: </strong> None</p>";return`<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>Rule: ${this.escapeHtml(e.name)}</title>\n    <style>\n        body {\n            font-family: var(--vscode-font-family);\n            color: var(--vscode-foreground);\n            background-color: var(--vscode-editor-background);\n            padding: 20px;\n            line-height: 1.5;\n        }\n        h1, h2 {\n            color: var(--vscode-editor-foreground);\n            border-bottom: 1px solid var(--vscode-panel-border);\n            padding-bottom: 10px;\n        }\n        .info {\n            background-color: var(--vscode-input-background);\n            border-left: 4px solid var(--vscode-focusBorder);\n            padding: 15px;\n            margin-bottom: 20px;\n        }\n        .tag {\n            background-color: var(--vscode-badge-background);\n            color: var(--vscode-badge-foreground);\n            padding: 3px 8px;\n            border-radius: 3px;\n            margin-right: 5px;\n            font-size: 12px;\n        }\n        .tag-empty {\n            color: var(--vscode-disabledForeground);\n            font-style: italic;\n        }\n        .content {\n            background-color: var(--vscode-textBlockQuote-background);\n            padding: 15px;\n            border-radius: 4px;\n            overflow-x: auto;\n            white-space: pre-wrap;\n            font-family: var(--vscode-editor-font-family);\n            font-size: 14px;\n        }\n        .description {\n            margin: 10px 0 20px 0;\n            color: var(--vscode-descriptionForeground);\n        }\n    </style>\n</head>\n<body>\n    <h1>${this.escapeHtml(e.name)}</h1>\n    \n    <div class="info">\n        <p><strong>Status: </strong> ${e.isGlobal?"Global":"Project-specific"}</p>\n        <p><strong>Tags: </strong> ${t}</p>\n        ${n}\n    </div>\n    \n    ${e.description?`<div class="description">${this.escapeHtml(e.description)}</div>`:""}\n    \n    <h2>Rule Content</h2>\n    <div class="content">${this.escapeHtml(e.content)}</div>\n</body>\n</html>`}escapeHtml(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}}},3144:(e,t)=>{t.stringifyNumber=function({format:e,minFractionDigits:t,tag:n,value:s}){if("bigint"==typeof s)return String(s);const r="number"==typeof s?s:Number(s);if(!isFinite(r))return isNaN(r)?".nan":r<0?"-.inf":".inf";let a=JSON.stringify(s);if(!e&&t&&(!n||"tag:yaml.org,2002:float"===n)&&/^\d/.test(a)){let e=a.indexOf(".");e<0&&(e=a.length,a+=".");let n=t-(a.length-e-1);for(;n-- >0;)a+="0"}return a}},3334:(e,t,n)=>{var s=n(484),r=n(1755);const a={collection:"map",default:!0,nodeClass:r.YAMLMap,tag:"tag:yaml.org,2002:map",resolve:(e,t)=>(s.isMap(e)||t("Expected a mapping for this tag"),e),createNode:(e,t,n)=>r.YAMLMap.from(e,t,n)};t.map=a},3732:(e,t,n)=>{var s=n(484);t.toJS=function e(t,n,r){if(Array.isArray(t))return t.map(((t,n)=>e(t,String(n),r)));if(t&&"function"==typeof t.toJSON){if(!r||!s.hasAnchor(t))return t.toJSON(n,r);const e={aliasCount:0,count:1,res:void 0};r.anchors.set(t,e),r.onCreate=t=>{e.res=t,delete r.onCreate};const a=t.toJSON(n,r);return r.onCreate&&r.onCreate(a),a}return"bigint"!=typeof t||r?.keep?t:Number(t)}},3793:(e,t,n)=>{var s=n(6261),r=n(484),a=n(248),o=n(7180);t.createStringifyContext=function(e,t){const n=Object.assign({blockQuote:!0,commentString:a.stringifyComment,defaultKeyType:null,defaultStringType:"PLAIN",directives:null,doubleQuotedAsJSON:!1,doubleQuotedMinMultiLineLength:40,falseStr:"false",flowCollectionPadding:!0,indentSeq:!0,lineWidth:80,minContentWidth:20,nullStr:"null",simpleKeys:!1,singleQuote:null,trueStr:"true",verifyAliasOrder:!0},e.schema.toStringOptions,t);let s;switch(n.collectionStyle){case"block":s=!1;break;case"flow":s=!0;break;default:s=null}return{anchors:new Set,doc:e,flowCollectionPadding:n.flowCollectionPadding?" ":"",indent:"",indentStep:"number"==typeof n.indent?" ".repeat(n.indent):"  ",inFlow:s,options:n}},t.stringify=function(e,t,n,a){if(r.isPair(e))return e.toString(t,n,a);if(r.isAlias(e)){if(t.doc.directives)return e.toString(t);if(t.resolvedAliases?.has(e))throw new TypeError("Cannot stringify circular structure without alias nodes");t.resolvedAliases?t.resolvedAliases.add(e):t.resolvedAliases=new Set([e]),e=e.resolve(t.doc)}let i;const c=r.isNode(e)?e:t.doc.createNode(e,{onTagObj:e=>i=e});i??(i=function(e,t){if(t.tag){const n=e.filter((e=>e.tag===t.tag));if(n.length>0)return n.find((e=>e.format===t.format))??n[0]}let n,s;if(r.isScalar(t)){s=t.value;let r=e.filter((e=>e.identify?.(s)));if(r.length>1){const e=r.filter((e=>e.test));e.length>0&&(r=e)}n=r.find((e=>e.format===t.format))??r.find((e=>!e.format))}else s=t,n=e.find((e=>e.nodeClass&&s instanceof e.nodeClass));if(!n)throw new Error(`Tag not resolved for ${s?.constructor?.name??(null===s?"null":typeof s)} value`);return n}(t.doc.schema.tags,c));const l=function(e,t,{anchors:n,doc:a}){if(!a.directives)return"";const o=[],i=(r.isScalar(e)||r.isCollection(e))&&e.anchor;i&&s.anchorIsValid(i)&&(n.add(i),o.push(`&${i}`));const c=e.tag??(t.default?null:t.tag);return c&&o.push(a.directives.tagString(c)),o.join(" ")}(c,i,t);l.length>0&&(t.indentAtStart=(t.indentAtStart??0)+l.length+1);const u="function"==typeof i.stringify?i.stringify(c,t,n,a):r.isScalar(c)?o.stringifyString(c,t,n,a):c.toString(t,n,a);return l?r.isScalar(c)||"{"===u[0]||"["===u[0]?`${l} ${u}`:`${l}\n${t.indent}${u}`:u}},3823:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChatProcessor=void 0;const s=n(6899),r=n(9561),a=n(1509),o=n(3870),i=n(9838),c=n(4009);class l{constructor(){this.cursorDataProvider=i.CursorDataProvider.getInstance(),this.storageManager=c.StorageManager.getInstance()}static getInstance(){return l.instance||(l.instance=new l),l.instance}async processChats(){const e=await this.cursorDataProvider.getChatData(),t=new Map,n=[];for(const s of e)try{s.source.includes("aiService.prompts")?await this.processAiServicePrompts(s,t,n):s.source.includes("workbench.panel.aichat")&&await this.processWorkbenchChatData(s,t,n)}catch(e){console.error(`Error processing chat data: ${e}`)}return{projects:Array.from(t.values()),chats:n}}async processAiServicePrompts(e,t,n){const i=e.data;if(Array.isArray(i))for(const c of i)try{const i=c.workspaceName||e.workspace||"Unknown Project",l=`original-${i.replace(/\s+/g,"-").toLowerCase()}`;t.has(l)||t.set(l,new o.ProjectImpl(l,i,`Original project from Cursor: ${i}`,new Date,!1,[],[]));const u=c.id||(0,s.v4)(),d=c.title||`Chat from ${new Date(c.createdAt||Date.now()).toLocaleString()}`,h=new Date(c.createdAt||Date.now()),p=new r.ChatImpl(u,d,h,l,[],[]);if(Array.isArray(c.messages))for(const e of c.messages){const t=e.id||(0,s.v4)(),n="user"===e.role,r=new Date(e.createdAt||p.timestamp),o=new a.DialogueImpl(t,p.id,e.content||"",n,r,[]);p.addDialogue(o)}n.push(p);const f=t.get(l);f&&f.addChat(p)}catch(e){console.error(`Error processing prompt data: ${e}`)}}async processWorkbenchChatData(e,t,n){const i=e.data;if(!i||!i.entries||!Array.isArray(i.entries))return;const c=e.workspace||"Unknown Project",l=`original-${c.replace(/\s+/g,"-").toLowerCase()}`;t.has(l)||t.set(l,new o.ProjectImpl(l,c,`Original project from Cursor: ${c}`,new Date,!1,[],[]));for(const e of i.entries)try{const o=e.id||(0,s.v4)(),i=e.title||`Chat from ${new Date(e.timestamp||Date.now()).toLocaleString()}`,c=new Date(e.timestamp||Date.now()),u=new r.ChatImpl(o,i,c,l,[],[]);if(Array.isArray(e.conversation))for(const t of e.conversation){const e=t.id||(0,s.v4)(),n="user"===t.sender,r=new Date(t.timestamp||u.timestamp),o=new a.DialogueImpl(e,u.id,t.message||"",n,r,[]);u.addDialogue(o)}n.push(u);const d=t.get(l);d&&d.addChat(u)}catch(e){console.error(`Error processing workbench chat entry: ${e}`)}}async saveProcessedData(e,t){try{return await this.storageManager.saveData("projects",e.map((e=>e instanceof o.ProjectImpl?e.serialize():e))),await this.storageManager.saveData("chats",t.map((e=>e instanceof r.ChatImpl?e.serialize():e))),!0}catch(e){return console.error(`Error saving processed data: ${e}`),!1}}async loadProcessedData(){try{const e=(await this.storageManager.getData("projects",[])||[]).map((e=>o.ProjectImpl.deserialize(e)));return{projects:e,chats:(await this.storageManager.getData("chats",[])||[]).map((e=>r.ChatImpl.deserialize(e)))}}catch(e){return console.error(`Error loading processed data: ${e}`),{projects:[],chats:[]}}}}t.ChatProcessor=l},3870:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ProjectImpl=void 0;const s=n(9561);class r{constructor(e,t,n,s,r,a=[],o=[],i){this.id=e,this.name=t,this.description=n,this.created=s,this.isCustom=r,this.chats=a,this.tags=o,this.metadata=i}addChat(e){e.projectId=this.id,this.chats.some((t=>t.id===e.id))||this.chats.push(e)}removeChat(e){const t=this.chats.length;return this.chats=this.chats.filter((t=>t.id!==e)),this.chats.length!==t}updateMetadata(e){this.metadata={...this.metadata,...e}}serialize(){return{id:this.id,name:this.name,description:this.description,created:this.created.toISOString(),isCustom:this.isCustom,chats:this.chats.map((e=>e instanceof s.ChatImpl?e.serialize():e)),tags:this.tags,metadata:this.metadata}}static deserialize(e){return new r(e.id,e.name,e.description,new Date(e.created),e.isCustom,Array.isArray(e.chats)?e.chats:[],Array.isArray(e.tags)?e.tags:[],e.metadata)}}t.ProjectImpl=r},3952:function(e,t,n){var s,r=this&&this.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},s(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=s(e),o=0;o<n.length;o++)"default"!==n[o]&&r(t,e,n[o]);return a(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.ExportService=t.ExportFormat=void 0;const i=o(n(1398)),c=o(n(9896)),l=o(n(6928));var u;!function(e){e.JSON="json",e.HTML="html",e.TEXT="text"}(u||(t.ExportFormat=u={}));class d{constructor(){this.templatePath=l.join(__dirname,"..","..","resources","templates")}static getInstance(){return d.instance||(d.instance=new d),d.instance}async exportChat(e,t){try{const n=this.formatChat(e,t),s=this.generateFilePath(t.targetPath,e.title,t.format);return await this.writeToFile(s,n),s}catch(e){throw i.window.showErrorMessage(`Failed to export chat: ${e instanceof Error?e.message:String(e)}`),e}}async exportChats(e,t){const n=[];try{for(const s of e){const e=await this.exportChat(s,t);n.push(e)}return n}catch(e){throw i.window.showErrorMessage(`Failed to export chats: ${e instanceof Error?e.message:String(e)}`),e}}async exportProject(e,t){try{const n=l.join(t.targetPath,this.sanitizeFileName(e.name));await c.promises.mkdir(n,{recursive:!0});const s={...t,targetPath:n},r=[];for(const t of e.chats){const e=await this.exportChat(t,s);r.push(e)}if(t.format===u.HTML){const s=l.join(n,"index.html"),a=await this.generateProjectIndex(e,r,t);await this.writeToFile(s,a)}return n}catch(e){throw i.window.showErrorMessage(`Failed to export project: ${e instanceof Error?e.message:String(e)}`),e}}formatChat(e,t){const n="object"==typeof t?t.format:t;switch(n){case u.JSON:return this.formatChatAsJSON(e,"object"==typeof t?t:void 0);case u.HTML:return this.formatChatAsHTML(e,"object"==typeof t?t:void 0);case u.TEXT:return this.formatChatAsText(e,"object"==typeof t?t:void 0);default:throw new Error(`Unsupported export format: ${n}`)}}formatChatAsJSON(e,t){if(!t)return JSON.stringify(e,null,2);const n=JSON.parse(JSON.stringify(e));return t.includeMetadata||(delete n.id,delete n.createdAt,delete n.updatedAt),t.includeTimestamps||(delete n.createdAt,delete n.updatedAt,n.dialogues.forEach((e=>{delete e.timestamp}))),t.includeTags||(delete n.tags,n.dialogues.forEach((e=>{delete e.tags}))),JSON.stringify(n,null,2)}formatChatAsHTML(e,t){let n=this.loadTemplate("chat.html");n=n.replace("{{CHAT_TITLE}}",this.sanitizeHtml(e.title));let s="";t?.includeMetadata&&(s=`\n        <div class="metadata">\n          <div class="metadata-item">ID: ${this.sanitizeHtml(e.id)}</div>\n          ${t?.includeTimestamps?`\n            <div class="metadata-item">Created: ${new Date(e.timestamp).toLocaleString()}</div>\n          `:""}\n          ${t?.includeTags&&e.tags&&e.tags.length>0?`\n            <div class="metadata-item">Tags: ${e.tags.map((e=>`<span class="tag">${this.sanitizeHtml(e)}</span>`)).join(" ")}</div>\n          `:""}\n        </div>\n      `),n=n.replace("{{METADATA}}",s);const r=e.dialogues.map((e=>`\n        <div class="dialogue ${e.isUser?"user":"assistant"}">\n          <div class="dialogue-header">\n            <span class="role">${this.sanitizeHtml(e.isUser?"User":"Assistant")}</span>\n            ${t?.includeTimestamps?`<span class="timestamp">${new Date(e.timestamp).toLocaleString()}</span>`:""}\n            ${t?.includeTags&&e.tags&&e.tags.length>0?`<span class="tags">${e.tags.map((e=>`<span class="tag">${this.sanitizeHtml(e)}</span>`)).join(" ")}</span>`:""}\n          </div>\n          <div class="dialogue-content">${this.formatDialogueContent(e)}</div>\n        </div>\n      `)).join("\n");return n=n.replace("{{DIALOGUES}}",r),n}formatDialogueContent(e){return this.sanitizeHtml(e.content).replace(/```(\w*)\n([\s\S]*?)```/g,((e,t,n)=>`<pre class="code-block ${t}"><code>${this.sanitizeHtml(n)}</code></pre>`))}formatChatAsText(e,t){let n=`# ${e.title}\n\n`;return t?.includeMetadata&&(n+=`ID: ${e.id}\n`,t?.includeTimestamps&&(n+=`Created: ${new Date(e.timestamp).toLocaleString()}\n`),t?.includeTags&&e.tags&&e.tags.length>0&&(n+=`Tags: ${e.tags.join(", ")}\n`),n+="\n"),e.dialogues.forEach((e=>{n+=`## ${e.isUser?"USER":"ASSISTANT"}\n`,t?.includeTimestamps&&(n+=`Time: ${new Date(e.timestamp).toLocaleString()}\n`),t?.includeTags&&e.tags&&e.tags.length>0&&(n+=`Tags: ${e.tags.join(", ")}\n`),n+=`\n${e.content}\n\n`})),n}async generateProjectIndex(e,t,n){let s=this.loadTemplate("project-index.html");s=s.replace("{{PROJECT_NAME}}",this.sanitizeHtml(e.name));const r=e.chats.map(((e,n)=>`<li><a href="./${l.basename(t[n])}">${this.sanitizeHtml(e.title)}</a></li>`)).join("\n");s=s.replace("{{CHAT_LIST}}",r);let a="";return n.includeMetadata&&(a=`\n        <div class="metadata">\n          <div class="metadata-item">ID: ${this.sanitizeHtml(e.id)}</div>\n          ${n.includeTimestamps?`\n            <div class="metadata-item">Created: ${new Date(e.created).toLocaleString()}</div>\n          `:""}\n          <div class="metadata-item">Total Chats: ${e.chats.length}</div>\n        </div>\n      `),s=s.replace("{{METADATA}}",a),s}loadTemplate(e){try{const t=l.join(this.templatePath,e);return c.readFileSync(t,"utf-8")}catch(t){if(console.error(`Failed to load template ${e}: ${t}`),"chat.html"===e)return this.getFallbackChatTemplate();if("project-index.html"===e)return this.getFallbackProjectTemplate();throw new Error(`Template not found and no fallback available: ${e}`)}}getFallbackChatTemplate(){return'<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>{{CHAT_TITLE}}</title>\n  <style>\n    body { font-family: Arial, sans-serif; line-height: 1.6; max-width: 800px; margin: 0 auto; padding: 20px; }\n    h1 { color: #333; }\n    .metadata { background: #f8f8f8; padding: 10px; margin-bottom: 20px; border-radius: 4px; }\n    .metadata-item { margin-bottom: 5px; }\n    .tag { background: #e0e0e0; padding: 2px 6px; border-radius: 3px; font-size: 12px; margin-right: 5px; }\n    .dialogue { margin-bottom: 20px; padding: 10px; border-radius: 4px; }\n    .user { background: #e6f7ff; border-left: 4px solid #1890ff; }\n    .assistant { background: #f6ffed; border-left: 4px solid #52c41a; }\n    .dialogue-header { display: flex; margin-bottom: 10px; font-size: 14px; color: #666; }\n    .role { font-weight: bold; margin-right: 10px; }\n    .timestamp { margin-right: 10px; }\n    .dialogue-content { white-space: pre-wrap; }\n    .code-block { background: #f5f5f5; padding: 10px; border-radius: 4px; overflow-x: auto; }\n  </style>\n</head>\n<body>\n  <h1>{{CHAT_TITLE}}</h1>\n  {{METADATA}}\n  <div class="dialogues">\n    {{DIALOGUES}}\n  </div>\n</body>\n</html>'}getFallbackProjectTemplate(){return'<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>{{PROJECT_NAME}}</title>\n  <style>\n    body { font-family: Arial, sans-serif; line-height: 1.6; max-width: 800px; margin: 0 auto; padding: 20px; }\n    h1 { color: #333; }\n    .metadata { background: #f8f8f8; padding: 10px; margin-bottom: 20px; border-radius: 4px; }\n    .metadata-item { margin-bottom: 5px; }\n    ul { list-style-type: none; padding: 0; }\n    li { margin-bottom: 10px; }\n    a { color: #1890ff; text-decoration: none; }\n    a:hover { text-decoration: underline; }\n  </style>\n</head>\n<body>\n  <h1>{{PROJECT_NAME}}</h1>\n  {{METADATA}}\n  <h2>Chats</h2>\n  <ul>\n    {{CHAT_LIST}}\n  </ul>\n</body>\n</html>'}generateFilePath(e,t,n){const s=`${this.sanitizeFileName(t)}.${n}`;return l.join(e,s)}async writeToFile(e,t){try{await c.promises.mkdir(l.dirname(e),{recursive:!0}),await c.promises.writeFile(e,t,"utf-8")}catch(t){throw console.error(`Error writing to file ${e}:`,t),t}}sanitizeFileName(e){return e.replace(/[<>:"/\\|?*]/g,"_").replace(/\s+/g,"_").replace(/_+/g,"_").substring(0,255)}sanitizeHtml(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}}t.ExportService=d},4009:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StorageManager=void 0;class n{constructor(){this.context=null}static getInstance(){return n.instance||(n.instance=new n),n.instance}initialize(e){this.context=e}async saveData(e,t){if(!this.context)throw new Error("Storage manager not initialized");try{const s={version:n.CURRENT_VERSION,data:t,timestamp:(new Date).toISOString()};return await this.context.globalState.update(e,s),!0}catch(e){return console.error(`Error saving data: ${e}`),!1}}async getData(e,t){if(!this.context)throw new Error("Storage manager not initialized");try{const n=this.context.globalState.get(e);return n?this.migrateDataIfNeeded(n).data:t}catch(e){return console.error(`Error retrieving data: ${e}`),t}}async removeData(e){if(!this.context)throw new Error("Storage manager not initialized");try{return await this.context.globalState.update(e,void 0),!0}catch(e){return console.error(`Error removing data: ${e}`),!1}}async getAllKeys(){if(!this.context)throw new Error("Storage manager not initialized");try{const e=[];return this.context.globalState.keys().forEach((t=>{const n=this.context?.globalState.get(t);n&&"object"==typeof n&&"version"in n&&e.push(t)})),e}catch(e){return console.error(`Error getting keys: ${e}`),[]}}migrateDataIfNeeded(e){return e.version===n.CURRENT_VERSION?e:(console.log(`Migrating data from version ${e.version} to ${n.CURRENT_VERSION}`),{...e,version:n.CURRENT_VERSION})}}t.StorageManager=n,n.CURRENT_VERSION="1.0.0"},4070:(e,t,n)=>{var s=n(9714);t.resolveBlockScalar=function(e,t,n){const r=t.offset,a=function({offset:e,props:t},n,s){if("block-scalar-header"!==t[0].type)return s(t[0],"IMPOSSIBLE","Block scalar header not found"),null;const{source:r}=t[0],a=r[0];let o=0,i="",c=-1;for(let t=1;t<r.length;++t){const n=r[t];if(i||"-"!==n&&"+"!==n){const s=Number(n);!o&&s?o=s:-1===c&&(c=e+t)}else i=n}-1!==c&&s(c,"UNEXPECTED_TOKEN",`Block scalar header includes extra characters: ${r}`);let l=!1,u="",d=r.length;for(let e=1;e<t.length;++e){const r=t[e];switch(r.type){case"space":l=!0;case"newline":d+=r.source.length;break;case"comment":n&&!l&&s(r,"MISSING_CHAR","Comments must be separated from other tokens by white space characters"),d+=r.source.length,u=r.source.substring(1);break;case"error":s(r,"UNEXPECTED_TOKEN",r.message),d+=r.source.length;break;default:{s(r,"UNEXPECTED_TOKEN",`Unexpected token in block scalar header: ${r.type}`);const e=r.source;e&&"string"==typeof e&&(d+=e.length)}}}return{mode:a,indent:o,chomp:i,comment:u,length:d}}(t,e.options.strict,n);if(!a)return{value:"",type:null,comment:"",range:[r,r,r]};const o=">"===a.mode?s.Scalar.BLOCK_FOLDED:s.Scalar.BLOCK_LITERAL,i=t.source?function(e){const t=e.split(/\n( *)/),n=t[0],s=n.match(/^( *)/),r=[s?.[1]?[s[1],n.slice(s[1].length)]:["",n]];for(let e=1;e<t.length;e+=2)r.push([t[e],t[e+1]]);return r}(t.source):[];let c=i.length;for(let e=i.length-1;e>=0;--e){const t=i[e][1];if(""!==t&&"\r"!==t)break;c=e}if(0===c){const e="+"===a.chomp&&i.length>0?"\n".repeat(Math.max(1,i.length-1)):"";let n=r+a.length;return t.source&&(n+=t.source.length),{value:e,type:o,comment:a.comment,range:[r,n,n]}}let l=t.indent+a.indent,u=t.offset+a.length,d=0;for(let t=0;t<c;++t){const[s,r]=i[t];if(""!==r&&"\r"!==r){if(s.length<l){const e="Block scalars with more-indented leading empty lines must use an explicit indentation indicator";n(u+s.length,"MISSING_CHAR",e)}0===a.indent&&(l=s.length),d=t,0!==l||e.atRoot||n(u,"BAD_INDENT","Block scalar values in collections must be indented");break}0===a.indent&&s.length>l&&(l=s.length),u+=s.length+r.length+1}for(let e=i.length-1;e>=c;--e)i[e][0].length>l&&(c=e+1);let h="",p="",f=!1;for(let e=0;e<d;++e)h+=i[e][0].slice(l)+"\n";for(let e=d;e<c;++e){let[t,r]=i[e];u+=t.length+r.length+1;const c="\r"===r[r.length-1];if(c&&(r=r.slice(0,-1)),r&&t.length<l){const e="Block scalar lines must not be less indented than their "+(a.indent?"explicit indentation indicator":"first line");n(u-r.length-(c?2:1),"BAD_INDENT",e),t=""}o===s.Scalar.BLOCK_LITERAL?(h+=p+t.slice(l)+r,p="\n"):t.length>l||"\t"===r[0]?(" "===p?p="\n":f||"\n"!==p||(p="\n\n"),h+=p+t.slice(l)+r,p="\n",f=!0):""===r?"\n"===p?h+="\n":p="\n":(h+=p+r,p=" ",f=!1)}switch(a.chomp){case"-":break;case"+":for(let e=c;e<i.length;++e)h+="\n"+i[e][0].slice(l);"\n"!==h[h.length-1]&&(h+="\n");break;default:h+="\n"}const m=r+a.length+t.source.length;return{value:h,type:o,comment:a.comment,range:[r,m,m]}}},4074:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TagManager=void 0;const s=n(9561),r=n(1509),a=n(4009);class o{constructor(){this.chatTags=new Map,this.dialogueTags=new Map,this.tagStats=new Map,this.tagCategories=[],this.storageManager=a.StorageManager.getInstance()}static getInstance(){return o.instance||(o.instance=new o),o.instance}async initialize(){try{const e=await this.storageManager.getData("chatTags",{}),t=await this.storageManager.getData("dialogueTags",{}),n=await this.storageManager.getData("tagStats",{}),s=await this.storageManager.getData("tagCategories",[]);this.chatTags=new Map(Object.entries(e||{})),this.dialogueTags=new Map(Object.entries(t||{})),this.tagStats=new Map(Object.entries(n||{})),this.tagCategories=s||[],this.tagStats.forEach(((e,t)=>{"string"==typeof e.lastUsed&&(e.lastUsed=new Date(e.lastUsed))}))}catch(e){console.error(`Error initializing tag manager: ${e}`)}}async saveState(){try{const e=Object.fromEntries(this.chatTags),t=Object.fromEntries(this.dialogueTags),n=Object.fromEntries(this.tagStats);await this.storageManager.saveData("chatTags",e),await this.storageManager.saveData("dialogueTags",t),await this.storageManager.saveData("tagStats",n),await this.storageManager.saveData("tagCategories",this.tagCategories)}catch(e){console.error(`Error saving tag manager state: ${e}`)}}async addTagToChat(e,t){const n=this.normalizeTag(t);if(!this.validateTag(n))return!1;e instanceof s.ChatImpl&&e.addTag(n);const r=this.chatTags.get(e.id)||[];return r.includes(n)||(r.push(n),this.chatTags.set(e.id,r)),this.updateTagStats(n),await this.saveState(),!0}async removeTagFromChat(e,t){const n=this.normalizeTag(t);let r=!1;e instanceof s.ChatImpl&&(r=e.removeTag(n));const a=this.chatTags.get(e.id)||[],o=a.filter((e=>e!==n));return this.chatTags.set(e.id,o),await this.saveState(),r||a.length!==o.length}getChatTags(e){return this.chatTags.get(e)||[]}async addTagToDialogue(e,t){const n=this.normalizeTag(t);if(!this.validateTag(n))return!1;e instanceof r.DialogueImpl&&e.addTag(n);const s=this.dialogueTags.get(e.id)||[];return s.includes(n)||(s.push(n),this.dialogueTags.set(e.id,s)),this.updateTagStats(n),await this.saveState(),!0}async removeTagFromDialogue(e,t){const n=this.normalizeTag(t);let s=!1;e instanceof r.DialogueImpl&&(s=e.removeTag(n));const a=this.dialogueTags.get(e.id)||[],o=a.filter((e=>e!==n));return this.dialogueTags.set(e.id,o),await this.saveState(),s||a.length!==o.length}getDialogueTags(e){return this.dialogueTags.get(e)||[]}async createTagCategory(e){return!(!e||this.tagCategories.some((t=>t.name===e))||(this.tagCategories.push({name:e,tags:[]}),await this.saveState(),0))}async addTagToCategory(e,t){const n=this.normalizeTag(e),s=this.tagCategories.find((e=>e.name===t));return!!s&&(s.tags.includes(n)||(s.tags.push(n),await this.saveState()),!0)}async removeTagFromCategory(e,t){const n=this.normalizeTag(e),s=this.tagCategories.find((e=>e.name===t));if(!s)return!1;const r=s.tags.length;return s.tags=s.tags.filter((e=>e!==n)),s.tags.length!==r&&(await this.saveState(),!0)}getTagsInCategory(e){const t=this.tagCategories.find((t=>t.name===e));return t?.tags||[]}getCategories(){return[...this.tagCategories]}getSuggestedTags(e=5){const t=Array.from(this.tagStats.entries()).sort(((e,t)=>t[1].count-e[1].count)).map((([e])=>e)),n=Array.from(this.tagStats.entries()).sort(((e,t)=>t[1].lastUsed.getTime()-e[1].lastUsed.getTime())).map((([e])=>e)),s=new Set;for(let r=0;r<2*e&&s.size<e;r++){const e=Math.floor(r/2),a=Math.floor(r/2);r%2==0&&e<t.length?s.add(t[e]):a<n.length&&s.add(n[a])}return Array.from(s).slice(0,e)}async findChatsByTags(e){if(!e.length)return[];const t=e.map((e=>this.normalizeTag(e))),n=[];return this.chatTags.forEach(((e,s)=>{t.every((t=>e.includes(t)))&&n.push(s)})),n}async findDialoguesByTags(e){if(!e.length)return[];const t=e.map((e=>this.normalizeTag(e))),n=[];return this.dialogueTags.forEach(((e,s)=>{t.every((t=>e.includes(t)))&&n.push(s)})),n}normalizeTag(e){let t=e.trim();return t.startsWith("#")&&(t=t.substring(1)),t=t.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,""),t}validateTag(e){return!!e&&/^[a-z0-9-]+$/.test(e)}updateTagStats(e){const t=this.tagStats.get(e)||{name:e,count:0,lastUsed:new Date};t.count+=1,t.lastUsed=new Date,this.tagStats.set(e,t)}getAllTags(){return Array.from(this.tagStats.keys())}getTagUsageCount(e){return this.tagStats.get(this.normalizeTag(e))?.count||0}}t.TagManager=o},4265:function(e,t,n){var s,r=this&&this.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},s(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=s(e),o=0;o<n.length;o++)"default"!==n[o]&&r(t,e,n[o]);return a(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.activate=async function(e){g.StorageManager.getInstance().initialize(e);const t=y.TagManager.getInstance();await t.initialize();const n=w.RuleManager.getInstance();await n.initialize();const s=v.PromptManager.getInstance();await s.initialize();const r=new h.ProjectView(e),a=new p.RuleView(e),o=new f.TagView(e),b=new m.PromptView(e);i.window.registerTreeDataProvider("cursor-chat-manager.projectView",r),i.window.registerTreeDataProvider("cursor-chat-manager.ruleView",a),i.window.registerTreeDataProvider("cursor-chat-manager.tagView",o),i.window.registerTreeDataProvider("cursor-chat-manager.promptView",b),i.commands.registerCommand("cursor-chat-manager.viewRule",(e=>{a.viewRule(e)})),i.commands.registerCommand("cursor-chat-manager.previewPrompt",(e=>{b.previewPrompt(e)})),(0,c.registerProjectCommands)(e,r),(0,l.registerExportCommands)(e),(0,u.registerRuleCommands)(e,a),(0,d.registerPromptCommands)(e,b),i.window.showInformationMessage("Cursor Chat Manager has been activated!")},t.deactivate=function(){};const i=o(n(1398)),c=n(9948),l=n(8763),u=n(4327),d=n(2715),h=n(365),p=n(3058),f=n(5444),m=n(7946),g=n(4009),y=n(4074),w=n(9240),v=n(8272)},4327:function(e,t,n){var s,r=this&&this.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},s(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=s(e),o=0;o<n.length;o++)"default"!==n[o]&&r(t,e,n[o]);return a(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.registerRuleCommands=function(e,t){const n=l.RuleManager.getInstance(),s=i.commands.registerCommand("cursor-chat-manager.importRule",(async()=>{try{const e=await i.window.showOpenDialog({canSelectMany:!1,filters:{"Markdown with Code (MDC)":["mdc","md"]},title:"Select Rule File to Import"});if(!e||0===e.length)return;const s=await i.window.showQuickPick([{label:"Global Rule",description:"Rule will be available for all projects",value:!0},{label:"Project Rule",description:"Rule will be associated with a specific project",value:!1}],{placeHolder:"Select rule scope"});if(!s)return;const r=await n.importRuleFromFile(e[0].fsPath);if(!s.value){const e=u.ProjectOrganizer.getInstance(),t=(await e.getAllProjects()).map((e=>({label:e.name,description:`${e.chats.length} chats`,project:e}))),s=await i.window.showQuickPick(t,{placeHolder:"Select a project to apply the rule to"});s&&await n.applyRuleToProject(r.id,s.project.id)}t.refresh(),i.window.showInformationMessage(`Rule "${r.name}" imported successfully`)}catch(e){i.window.showErrorMessage(`Failed to import rule: ${e instanceof Error?e.message:String(e)}`)}})),r=i.commands.registerCommand("cursor-chat-manager.makeRuleGlobal",(async e=>{try{await n.makeRuleGlobal(e)?(t.refresh(),i.window.showInformationMessage("Rule is now available globally")):i.window.showErrorMessage("Failed to make rule global")}catch(e){i.window.showErrorMessage(`Error: ${e instanceof Error?e.message:String(e)}`)}})),a=i.commands.registerCommand("cursor-chat-manager.applyRule",(async e=>{try{const s=await n.getRuleById(e);if(!s)return void i.window.showErrorMessage("Rule not found");const r=u.ProjectOrganizer.getInstance(),a=(await r.getAllProjects()).filter((e=>!s.appliedProjects?.includes(e.id)));if(0===a.length)return void i.window.showInformationMessage("Rule is already applied to all projects");const o=a.map((e=>({label:e.name,description:`${e.chats.length} chats`,project:e}))),c=await i.window.showQuickPick(o,{placeHolder:"Select a project to apply the rule to"});if(!c)return;await n.applyRuleToProject(e,c.project.id)?(t.refresh(),i.window.showInformationMessage(`Rule "${s.name}" applied to project "${c.project.name}"`)):i.window.showInformationMessage("Rule is already applied to this project")}catch(e){i.window.showErrorMessage(`Error: ${e instanceof Error?e.message:String(e)}`)}})),o=i.commands.registerCommand("cursor-chat-manager.exportRule",(async e=>{try{const t=await n.getRuleById(e);if(!t)return void i.window.showErrorMessage("Rule not found");const s=i.Uri.file(c.join(await i.env.appRoot||"",`${t.name.replace(/[\\/:*?"<>|]/g,"_")}.mdc`)),r=await i.window.showSaveDialog({defaultUri:s,filters:{"Markdown with Code (MDC)":["mdc"]},saveLabel:"Export Rule",title:`Export Rule: ${t.name}`});if(!r)return;await n.exportRuleToFile(e,r.fsPath)?i.window.showInformationMessage(`Rule "${t.name}" exported successfully`):i.window.showErrorMessage(`Failed to export rule "${t.name}"`)}catch(e){i.window.showErrorMessage(`Error: ${e instanceof Error?e.message:String(e)}`)}})),d=i.commands.registerCommand("cursor-chat-manager.deleteRule",(async e=>{try{const s=await n.getRuleById(e);if(!s)return void i.window.showErrorMessage("Rule not found");if("Delete"!==await i.window.showWarningMessage(`Are you sure you want to delete the rule "${s.name}"?`,{modal:!0},"Delete","Cancel"))return;await n.deleteRule(e)?(t.refresh(),i.window.showInformationMessage(`Rule "${s.name}" deleted`)):i.window.showErrorMessage(`Failed to delete rule "${s.name}"`)}catch(e){i.window.showErrorMessage(`Error: ${e instanceof Error?e.message:String(e)}`)}})),h=i.commands.registerCommand("cursor-chat-manager.createRuleFromSelection",(async()=>{try{const e=i.window.activeTextEditor;if(!e)return void i.window.showErrorMessage("No active text editor");const s=e.selection;if(s.isEmpty)return void i.window.showErrorMessage("No text selected");const r=e.document.getText(s),a=await i.window.showInputBox({prompt:"Enter a name for the rule",placeHolder:"Rule Name",value:`Rule from ${c.basename(e.document.fileName)}`});if(!a)return;const o=await i.window.showInputBox({prompt:"Enter a description for the rule (optional)",placeHolder:"Rule Description"}),l=await i.window.showInputBox({prompt:"Enter tags for the rule (comma-separated)",placeHolder:"tag1, tag2, tag3"}),d=l?l.split(",").map((e=>e.trim())).filter(Boolean):[],h=await n.createRuleFromDialogue(r,a,o||"",d),p=await i.window.showQuickPick([{label:"Global Rule",description:"Rule will be available for all projects",value:!0},{label:"Project Rule",description:"Rule will be associated with a specific project",value:!1}],{placeHolder:"Select rule scope"});if(!p)return;if(p.value)h.isGlobal=!0,await n.saveState();else{const e=u.ProjectOrganizer.getInstance(),t=(await e.getAllProjects()).map((e=>({label:e.name,description:`${e.chats.length} chats`,project:e}))),s=await i.window.showQuickPick(t,{placeHolder:"Select a project to apply the rule to"});s&&await n.applyRuleToProject(h.id,s.project.id)}t.refresh(),i.window.showInformationMessage(`Rule "${h.name}" created`)}catch(e){i.window.showErrorMessage(`Error: ${e instanceof Error?e.message:String(e)}`)}}));e.subscriptions.push(s,r,a,o,d,h)};const i=o(n(1398)),c=o(n(6928)),l=n(9240),u=n(8191)},4355:(e,t)=>{class n extends Error{constructor(e,t,n,s){super(),this.name=e,this.code=n,this.message=s,this.pos=t}}t.YAMLError=n,t.YAMLParseError=class extends n{constructor(e,t,n){super("YAMLParseError",e,t,n)}},t.YAMLWarning=class extends n{constructor(e,t,n){super("YAMLWarning",e,t,n)}},t.prettifyError=(e,t)=>n=>{if(-1===n.pos[0])return;n.linePos=n.pos.map((e=>t.linePos(e)));const{line:s,col:r}=n.linePos[0];n.message+=` at line ${s}, column ${r}`;let a=r-1,o=e.substring(t.lineStarts[s-1],t.lineStarts[s]).replace(/[\n\r]+$/,"");if(a>=60&&o.length>80){const e=Math.min(a-39,o.length-79);o="…"+o.substring(e),a-=e-1}if(o.length>80&&(o=o.substring(0,79)+"…"),s>1&&/^ *$/.test(o.substring(0,a))){let n=e.substring(t.lineStarts[s-2],t.lineStarts[s-1]);n.length>80&&(n=n.substring(0,79)+"…\n"),o=n+o}if(/[^ ]/.test(o)){let e=1;const t=n.linePos[1];t&&t.line===s&&t.col>r&&(e=Math.max(1,Math.min(t.col-r,80-a)));const i=" ".repeat(a)+"^".repeat(e);n.message+=`:\n\n${o}\n${i}\n`}}},4927:(e,t,n)=>{var s=n(932),r=n(8673),a=n(9046),o=n(4355),i=n(484),c=n(2206),l=n(6845);function u(e){if("number"==typeof e)return[e,e+1];if(Array.isArray(e))return 2===e.length?e:[e[0],e[1]];const{offset:t,source:n}=e;return[t,t+("string"==typeof n?n.length:1)]}function d(e){let t="",n=!1,s=!1;for(let r=0;r<e.length;++r){const a=e[r];switch(a[0]){case"#":t+=(""===t?"":s?"\n\n":"\n")+(a.substring(1)||" "),n=!0,s=!1;break;case"%":"#"!==e[r+1]?.[0]&&(r+=1),n=!1;break;default:n||(s=!0),n=!1}}return{comment:t,afterEmptyLine:s}}t.Composer=class{constructor(e={}){this.doc=null,this.atDirectives=!1,this.prelude=[],this.errors=[],this.warnings=[],this.onError=(e,t,n,s)=>{const r=u(e);s?this.warnings.push(new o.YAMLWarning(r,t,n)):this.errors.push(new o.YAMLParseError(r,t,n))},this.directives=new r.Directives({version:e.version||"1.2"}),this.options=e}decorate(e,t){const{comment:n,afterEmptyLine:s}=d(this.prelude);if(n){const r=e.contents;if(t)e.comment=e.comment?`${e.comment}\n${n}`:n;else if(s||e.directives.docStart||!r)e.commentBefore=n;else if(i.isCollection(r)&&!r.flow&&r.items.length>0){let e=r.items[0];i.isPair(e)&&(e=e.key);const t=e.commentBefore;e.commentBefore=t?`${n}\n${t}`:n}else{const e=r.commentBefore;r.commentBefore=e?`${n}\n${e}`:n}}t?(Array.prototype.push.apply(e.errors,this.errors),Array.prototype.push.apply(e.warnings,this.warnings)):(e.errors=this.errors,e.warnings=this.warnings),this.prelude=[],this.errors=[],this.warnings=[]}streamInfo(){return{comment:d(this.prelude).comment,directives:this.directives,errors:this.errors,warnings:this.warnings}}*compose(e,t=!1,n=-1){for(const t of e)yield*this.next(t);yield*this.end(t,n)}*next(e){switch(s.env.LOG_STREAM&&console.dir(e,{depth:null}),e.type){case"directive":this.directives.add(e.source,((t,n,s)=>{const r=u(e);r[0]+=t,this.onError(r,"BAD_DIRECTIVE",n,s)})),this.prelude.push(e.source),this.atDirectives=!0;break;case"document":{const t=c.composeDoc(this.options,this.directives,e,this.onError);this.atDirectives&&!t.directives.docStart&&this.onError(e,"MISSING_CHAR","Missing directives-end/doc-start indicator line"),this.decorate(t,!1),this.doc&&(yield this.doc),this.doc=t,this.atDirectives=!1;break}case"byte-order-mark":case"space":break;case"comment":case"newline":this.prelude.push(e.source);break;case"error":{const t=e.source?`${e.message}: ${JSON.stringify(e.source)}`:e.message,n=new o.YAMLParseError(u(e),"UNEXPECTED_TOKEN",t);this.atDirectives||!this.doc?this.errors.push(n):this.doc.errors.push(n);break}case"doc-end":{if(!this.doc){const t="Unexpected doc-end without preceding document";this.errors.push(new o.YAMLParseError(u(e),"UNEXPECTED_TOKEN",t));break}this.doc.directives.docEnd=!0;const t=l.resolveEnd(e.end,e.offset+e.source.length,this.doc.options.strict,this.onError);if(this.decorate(this.doc,!0),t.comment){const e=this.doc.comment;this.doc.comment=e?`${e}\n${t.comment}`:t.comment}this.doc.range[2]=t.offset;break}default:this.errors.push(new o.YAMLParseError(u(e),"UNEXPECTED_TOKEN",`Unsupported token ${e.type}`))}}*end(e=!1,t=-1){if(this.doc)this.decorate(this.doc,!0),yield this.doc,this.doc=null;else if(e){const e=Object.assign({_directives:this.directives},this.options),n=new a.Document(void 0,e);this.atDirectives&&this.onError(t,"MISSING_CHAR","Missing directives-end indicator line"),n.range=[0,t,t],this.decorate(n,!1),yield n}}}},4988:(e,t,n)=>{var s=n(9714),r=n(3334),a=n(1919);function o(e){return"bigint"==typeof e||Number.isInteger(e)}const i=({value:e})=>JSON.stringify(e),c=[{identify:e=>"string"==typeof e,default:!0,tag:"tag:yaml.org,2002:str",resolve:e=>e,stringify:i},{identify:e=>null==e,createNode:()=>new s.Scalar(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^null$/,resolve:()=>null,stringify:i},{identify:e=>"boolean"==typeof e,default:!0,tag:"tag:yaml.org,2002:bool",test:/^true$|^false$/,resolve:e=>"true"===e,stringify:i},{identify:o,default:!0,tag:"tag:yaml.org,2002:int",test:/^-?(?:0|[1-9][0-9]*)$/,resolve:(e,t,{intAsBigInt:n})=>n?BigInt(e):parseInt(e,10),stringify:({value:e})=>o(e)?e.toString():JSON.stringify(e)},{identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",test:/^-?(?:0|[1-9][0-9]*)(?:\.[0-9]*)?(?:[eE][-+]?[0-9]+)?$/,resolve:e=>parseFloat(e),stringify:i}],l={default:!0,tag:"",test:/^/,resolve:(e,t)=>(t(`Unresolved plain scalar ${JSON.stringify(e)}`),e)},u=[r.map,a.seq].concat(c,l);t.schema=u},5132:(e,t,n)=>{var s=n(9714);const r={identify:e=>"boolean"==typeof e,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:[Tt]rue|TRUE|[Ff]alse|FALSE)$/,resolve:e=>new s.Scalar("t"===e[0]||"T"===e[0]),stringify:({source:e,value:t},n)=>e&&r.test.test(e)&&t===("t"===e[0]||"T"===e[0])?e:t?n.options.trueStr:n.options.falseStr};t.boolTag=r},5139:(e,t,n)=>{var s=n(7444),r=n(9637),a=n(3793),o=n(484),i=n(3732);t.addPairToJSMap=function(e,t,{key:n,value:c}){if(o.isNode(n)&&n.addToJSMap)n.addToJSMap(e,t,c);else if(r.isMergeKey(e,n))r.addMergeToJSMap(e,t,c);else{const r=i.toJS(n,"",e);if(t instanceof Map)t.set(r,i.toJS(c,r,e));else if(t instanceof Set)t.add(r);else{const l=function(e,t,n){if(null===t)return"";if("object"!=typeof t)return String(t);if(o.isNode(e)&&n?.doc){const t=a.createStringifyContext(n.doc,{});t.anchors=new Set;for(const e of n.anchors.keys())t.anchors.add(e.anchor);t.inFlow=!0,t.inStringifyKey=!0;const r=e.toString(t);if(!n.mapKeyWarned){let e=JSON.stringify(r);e.length>40&&(e=e.substring(0,36)+'..."'),s.warn(n.doc.options.logLevel,`Keys with collection values will be stringified due to JS Object restrictions: ${e}. Set mapAsMap: true to use object keys.`),n.mapKeyWarned=!0}return r}return JSON.stringify(t)}(n,r,e),u=i.toJS(c,l,e);l in t?Object.defineProperty(t,l,{value:u,writable:!0,enumerable:!0,configurable:!0}):t[l]=u}}return t}},5141:(e,t,n)=>{var s=n(4070),r=n(7571),a=n(4355),o=n(7180);function i(e,t){if(t)for(const n of t)switch(n.type){case"space":case"comment":e.push(n);break;case"newline":return e.push(n),!0}return!1}function c(e,t,n){switch(e.type){case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":e.type=n,e.source=t;break;case"block-scalar":{const s=e.props.slice(1);let r=t.length;"block-scalar-header"===e.props[0].type&&(r-=e.props[0].source.length);for(const e of s)e.offset+=r;delete e.props,Object.assign(e,{type:n,source:t,end:s});break}case"block-map":case"block-seq":{const s={type:"newline",offset:e.offset+t.length,indent:e.indent,source:"\n"};delete e.items,Object.assign(e,{type:n,source:t,end:[s]});break}default:{const s="indent"in e?e.indent:-1,r="end"in e&&Array.isArray(e.end)?e.end.filter((e=>"space"===e.type||"comment"===e.type||"newline"===e.type)):[];for(const t of Object.keys(e))"type"!==t&&"offset"!==t&&delete e[t];Object.assign(e,{type:n,indent:s,source:t,end:r})}}}t.createScalarToken=function(e,t){const{implicitKey:n=!1,indent:s,inFlow:r=!1,offset:a=-1,type:c="PLAIN"}=t,l=o.stringifyString({type:c,value:e},{implicitKey:n,indent:s>0?" ".repeat(s):"",inFlow:r,options:{blockQuote:!0,lineWidth:-1}}),u=t.end??[{type:"newline",offset:-1,indent:s,source:"\n"}];switch(l[0]){case"|":case">":{const e=l.indexOf("\n"),t=l.substring(0,e),n=l.substring(e+1)+"\n",r=[{type:"block-scalar-header",offset:a,indent:s,source:t}];return i(r,u)||r.push({type:"newline",offset:-1,indent:s,source:"\n"}),{type:"block-scalar",offset:a,indent:s,props:r,source:n}}case'"':return{type:"double-quoted-scalar",offset:a,indent:s,source:l,end:u};case"'":return{type:"single-quoted-scalar",offset:a,indent:s,source:l,end:u};default:return{type:"scalar",offset:a,indent:s,source:l,end:u}}},t.resolveAsScalar=function(e,t=!0,n){if(e){const o=(e,t,s)=>{const r="number"==typeof e?e:Array.isArray(e)?e[0]:e.offset;if(!n)throw new a.YAMLParseError([r,r+1],t,s);n(r,t,s)};switch(e.type){case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return r.resolveFlowScalar(e,t,o);case"block-scalar":return s.resolveBlockScalar({options:{strict:t}},e,o)}}return null},t.setScalarValue=function(e,t,n={}){let{afterKey:s=!1,implicitKey:r=!1,inFlow:a=!1,type:l}=n,u="indent"in e?e.indent:null;if(s&&"number"==typeof u&&(u+=2),!l)switch(e.type){case"single-quoted-scalar":l="QUOTE_SINGLE";break;case"double-quoted-scalar":l="QUOTE_DOUBLE";break;case"block-scalar":{const t=e.props[0];if("block-scalar-header"!==t.type)throw new Error("Invalid block scalar header");l=">"===t.source[0]?"BLOCK_FOLDED":"BLOCK_LITERAL";break}default:l="PLAIN"}const d=o.stringifyString({type:l,value:t},{implicitKey:r||null===u,indent:null!==u&&u>0?" ".repeat(u):"",inFlow:a,options:{blockQuote:!0,lineWidth:-1}});switch(d[0]){case"|":case">":!function(e,t){const n=t.indexOf("\n"),s=t.substring(0,n),r=t.substring(n+1)+"\n";if("block-scalar"===e.type){const t=e.props[0];if("block-scalar-header"!==t.type)throw new Error("Invalid block scalar header");t.source=s,e.source=r}else{const{offset:t}=e,n="indent"in e?e.indent:-1,a=[{type:"block-scalar-header",offset:t,indent:n,source:s}];i(a,"end"in e?e.end:void 0)||a.push({type:"newline",offset:-1,indent:n,source:"\n"});for(const t of Object.keys(e))"type"!==t&&"offset"!==t&&delete e[t];Object.assign(e,{type:"block-scalar",indent:n,props:a,source:r})}}(e,d);break;case'"':c(e,d,"double-quoted-scalar");break;case"'":c(e,d,"single-quoted-scalar");break;default:c(e,d,"scalar")}}},5219:(e,t,n)=>{var s=n(1736),r=n(484),a=n(9714);t.createNode=function(e,t,n){if(r.isDocument(e)&&(e=e.contents),r.isNode(e))return e;if(r.isPair(e)){const t=n.schema[r.MAP].createNode?.(n.schema,null,n);return t.items.push(e),t}(e instanceof String||e instanceof Number||e instanceof Boolean||"undefined"!=typeof BigInt&&e instanceof BigInt)&&(e=e.valueOf());const{aliasDuplicateObjects:o,onAnchor:i,onTagObj:c,schema:l,sourceObjects:u}=n;let d;if(o&&e&&"object"==typeof e){if(d=u.get(e),d)return d.anchor??(d.anchor=i(e)),new s.Alias(d.anchor);d={anchor:null,node:null},u.set(e,d)}t?.startsWith("!!")&&(t="tag:yaml.org,2002:"+t.slice(2));let h=function(e,t,n){if(t){const e=n.filter((e=>e.tag===t)),s=e.find((e=>!e.format))??e[0];if(!s)throw new Error(`Tag ${t} not found`);return s}return n.find((t=>t.identify?.(e)&&!t.format))}(e,t,l.tags);if(!h){if(e&&"function"==typeof e.toJSON&&(e=e.toJSON()),!e||"object"!=typeof e){const t=new a.Scalar(e);return d&&(d.node=t),t}h=e instanceof Map?l[r.MAP]:Symbol.iterator in Object(e)?l[r.SEQ]:l[r.MAP]}c&&(c(h),delete n.onTagObj);const p=h?.createNode?h.createNode(n.schema,e,n):"function"==typeof h?.nodeClass?.from?h.nodeClass.from(n.schema,e,n):new a.Scalar(e);return t?p.tag=t:h.default||(p.tag=h.tag),d&&(d.node=p),p}},5437:(e,t,n)=>{var s=n(3144);function r(e,t){const n=e[0],s="-"===n||"+"===n?e.substring(1):e,r=e=>t?BigInt(e):Number(e),a=s.replace(/_/g,"").split(":").reduce(((e,t)=>e*r(60)+r(t)),r(0));return"-"===n?r(-1)*a:a}function a(e){let{value:t}=e,n=e=>e;if("bigint"==typeof t)n=e=>BigInt(e);else if(isNaN(t)||!isFinite(t))return s.stringifyNumber(e);let r="";t<0&&(r="-",t*=n(-1));const a=n(60),o=[t%a];return t<60?o.unshift(0):(t=(t-o[0])/a,o.unshift(t%a),t>=60&&(t=(t-o[0])/a,o.unshift(t))),r+o.map((e=>String(e).padStart(2,"0"))).join(":").replace(/000000\d*$/,"")}const o={identify:e=>"bigint"==typeof e||Number.isInteger(e),default:!0,tag:"tag:yaml.org,2002:int",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+$/,resolve:(e,t,{intAsBigInt:n})=>r(e,n),stringify:a},i={identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\.[0-9_]*$/,resolve:e=>r(e,!1),stringify:a},c={identify:e=>e instanceof Date,default:!0,tag:"tag:yaml.org,2002:timestamp",test:RegExp("^([0-9]{4})-([0-9]{1,2})-([0-9]{1,2})(?:(?:t|T|[ \\t]+)([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2}(\\.[0-9]+)?)(?:[ \\t]*(Z|[-+][012]?[0-9](?::[0-9]{2})?))?)?$"),resolve(e){const t=e.match(c.test);if(!t)throw new Error("!!timestamp expects a date, starting with yyyy-mm-dd");const[,n,s,a,o,i,l]=t.map(Number),u=t[7]?Number((t[7]+"00").substr(1,3)):0;let d=Date.UTC(n,s-1,a,o||0,i||0,l||0,u);const h=t[8];if(h&&"Z"!==h){let e=r(h,!1);Math.abs(e)<30&&(e*=60),d-=6e4*e}return new Date(d)},stringify:({value:e})=>e?.toISOString().replace(/(T00:00:00)?\.000Z$/,"")??""};t.floatTime=i,t.intTime=o,t.timestamp=c},5444:function(e,t,n){var s,r=this&&this.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},s(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=s(e),o=0;o<n.length;o++)"default"!==n[o]&&r(t,e,n[o]);return a(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.TagView=t.TagTreeItem=void 0;const i=o(n(1398)),c=n(4074);class l extends i.TreeItem{constructor(e,t,n,s,r,a,o){super(e,t),this.label=e,this.collapsibleState=t,this.contextValue=n,this.id=s,this.count=r,this.iconPath=a,this.command=o,this.id=s,this.contextValue=n,this.iconPath=a,this.command=o,this.tooltip=e,void 0!==r&&(this.description=`(${r})`)}}t.TagTreeItem=l,t.TagView=class{constructor(e){this.context=e,this._onDidChangeTreeData=new i.EventEmitter,this.onDidChangeTreeData=this._onDidChangeTreeData.event,this.tagManager=c.TagManager.getInstance()}refresh(){this._onDidChangeTreeData.fire()}getTreeItem(e){return e}async getChildren(e){if(!e)return[new l("Chat Tags",i.TreeItemCollapsibleState.Expanded,"category","chat-tags",void 0,new i.ThemeIcon("symbol-property")),new l("Dialogue Tags",i.TreeItemCollapsibleState.Expanded,"category","dialogue-tags",void 0,new i.ThemeIcon("symbol-field"))];if("category"===e.contextValue){if("chat-tags"===e.id)return[];if("dialogue-tags"===e.id)return[]}return[]}}},5752:(e,t,n)=>{var s=n(9112);function r(e){switch(e){case void 0:case" ":case"\n":case"\r":case"\t":return!0;default:return!1}}const a=new Set("0123456789ABCDEFabcdef"),o=new Set("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-#;/?:@&=+$_.!~*'()"),i=new Set(",[]{}"),c=new Set(" ,[]{}\n\r\t"),l=e=>!e||c.has(e);t.Lexer=class{constructor(){this.atEnd=!1,this.blockScalarIndent=-1,this.blockScalarKeep=!1,this.buffer="",this.flowKey=!1,this.flowLevel=0,this.indentNext=0,this.indentValue=0,this.lineEndPos=null,this.next=null,this.pos=0}*lex(e,t=!1){if(e){if("string"!=typeof e)throw TypeError("source is not a string");this.buffer=this.buffer?this.buffer+e:e,this.lineEndPos=null}this.atEnd=!t;let n=this.next??"stream";for(;n&&(t||this.hasChars(1));)n=yield*this.parseNext(n)}atLineEnd(){let e=this.pos,t=this.buffer[e];for(;" "===t||"\t"===t;)t=this.buffer[++e];return!t||"#"===t||"\n"===t||"\r"===t&&"\n"===this.buffer[e+1]}charAt(e){return this.buffer[this.pos+e]}continueScalar(e){let t=this.buffer[e];if(this.indentNext>0){let n=0;for(;" "===t;)t=this.buffer[++n+e];if("\r"===t){const t=this.buffer[n+e+1];if("\n"===t||!t&&!this.atEnd)return e+n+1}return"\n"===t||n>=this.indentNext||!t&&!this.atEnd?e+n:-1}if("-"===t||"."===t){const t=this.buffer.substr(e,3);if(("---"===t||"..."===t)&&r(this.buffer[e+3]))return-1}return e}getLine(){let e=this.lineEndPos;return("number"!=typeof e||-1!==e&&e<this.pos)&&(e=this.buffer.indexOf("\n",this.pos),this.lineEndPos=e),-1===e?this.atEnd?this.buffer.substring(this.pos):null:("\r"===this.buffer[e-1]&&(e-=1),this.buffer.substring(this.pos,e))}hasChars(e){return this.pos+e<=this.buffer.length}setNext(e){return this.buffer=this.buffer.substring(this.pos),this.pos=0,this.lineEndPos=null,this.next=e,null}peek(e){return this.buffer.substr(this.pos,e)}*parseNext(e){switch(e){case"stream":return yield*this.parseStream();case"line-start":return yield*this.parseLineStart();case"block-start":return yield*this.parseBlockStart();case"doc":return yield*this.parseDocument();case"flow":return yield*this.parseFlowCollection();case"quoted-scalar":return yield*this.parseQuotedScalar();case"block-scalar":return yield*this.parseBlockScalar();case"plain-scalar":return yield*this.parsePlainScalar()}}*parseStream(){let e=this.getLine();if(null===e)return this.setNext("stream");if(e[0]===s.BOM&&(yield*this.pushCount(1),e=e.substring(1)),"%"===e[0]){let t=e.length,n=e.indexOf("#");for(;-1!==n;){const s=e[n-1];if(" "===s||"\t"===s){t=n-1;break}n=e.indexOf("#",n+1)}for(;;){const n=e[t-1];if(" "!==n&&"\t"!==n)break;t-=1}const s=(yield*this.pushCount(t))+(yield*this.pushSpaces(!0));return yield*this.pushCount(e.length-s),this.pushNewline(),"stream"}if(this.atLineEnd()){const t=yield*this.pushSpaces(!0);return yield*this.pushCount(e.length-t),yield*this.pushNewline(),"stream"}return yield s.DOCUMENT,yield*this.parseLineStart()}*parseLineStart(){const e=this.charAt(0);if(!e&&!this.atEnd)return this.setNext("line-start");if("-"===e||"."===e){if(!this.atEnd&&!this.hasChars(4))return this.setNext("line-start");const e=this.peek(3);if(("---"===e||"..."===e)&&r(this.charAt(3)))return yield*this.pushCount(3),this.indentValue=0,this.indentNext=0,"---"===e?"doc":"stream"}return this.indentValue=yield*this.pushSpaces(!1),this.indentNext>this.indentValue&&!r(this.charAt(1))&&(this.indentNext=this.indentValue),yield*this.parseBlockStart()}*parseBlockStart(){const[e,t]=this.peek(2);if(!t&&!this.atEnd)return this.setNext("block-start");if(("-"===e||"?"===e||":"===e)&&r(t)){const e=(yield*this.pushCount(1))+(yield*this.pushSpaces(!0));return this.indentNext=this.indentValue+1,this.indentValue+=e,yield*this.parseBlockStart()}return"doc"}*parseDocument(){yield*this.pushSpaces(!0);const e=this.getLine();if(null===e)return this.setNext("doc");let t=yield*this.pushIndicators();switch(e[t]){case"#":yield*this.pushCount(e.length-t);case void 0:return yield*this.pushNewline(),yield*this.parseLineStart();case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel=1,"flow";case"}":case"]":return yield*this.pushCount(1),"doc";case"*":return yield*this.pushUntil(l),"doc";case'"':case"'":return yield*this.parseQuotedScalar();case"|":case">":return t+=(yield*this.parseBlockScalarHeader()),t+=(yield*this.pushSpaces(!0)),yield*this.pushCount(e.length-t),yield*this.pushNewline(),yield*this.parseBlockScalar();default:return yield*this.parsePlainScalar()}}*parseFlowCollection(){let e,t,n=-1;do{e=yield*this.pushNewline(),e>0?(t=yield*this.pushSpaces(!1),this.indentValue=n=t):t=0,t+=(yield*this.pushSpaces(!0))}while(e+t>0);const a=this.getLine();if(null===a)return this.setNext("flow");if((-1!==n&&n<this.indentNext&&"#"!==a[0]||0===n&&(a.startsWith("---")||a.startsWith("..."))&&r(a[3]))&&(n!==this.indentNext-1||1!==this.flowLevel||"]"!==a[0]&&"}"!==a[0]))return this.flowLevel=0,yield s.FLOW_END,yield*this.parseLineStart();let o=0;for(;","===a[o];)o+=(yield*this.pushCount(1)),o+=(yield*this.pushSpaces(!0)),this.flowKey=!1;switch(o+=(yield*this.pushIndicators()),a[o]){case void 0:return"flow";case"#":return yield*this.pushCount(a.length-o),"flow";case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel+=1,"flow";case"}":case"]":return yield*this.pushCount(1),this.flowKey=!0,this.flowLevel-=1,this.flowLevel?"flow":"doc";case"*":return yield*this.pushUntil(l),"flow";case'"':case"'":return this.flowKey=!0,yield*this.parseQuotedScalar();case":":{const e=this.charAt(1);if(this.flowKey||r(e)||","===e)return this.flowKey=!1,yield*this.pushCount(1),yield*this.pushSpaces(!0),"flow"}default:return this.flowKey=!1,yield*this.parsePlainScalar()}}*parseQuotedScalar(){const e=this.charAt(0);let t=this.buffer.indexOf(e,this.pos+1);if("'"===e)for(;-1!==t&&"'"===this.buffer[t+1];)t=this.buffer.indexOf("'",t+2);else for(;-1!==t;){let e=0;for(;"\\"===this.buffer[t-1-e];)e+=1;if(e%2==0)break;t=this.buffer.indexOf('"',t+1)}const n=this.buffer.substring(0,t);let s=n.indexOf("\n",this.pos);if(-1!==s){for(;-1!==s;){const e=this.continueScalar(s+1);if(-1===e)break;s=n.indexOf("\n",e)}-1!==s&&(t=s-("\r"===n[s-1]?2:1))}if(-1===t){if(!this.atEnd)return this.setNext("quoted-scalar");t=this.buffer.length}return yield*this.pushToIndex(t+1,!1),this.flowLevel?"flow":"doc"}*parseBlockScalarHeader(){this.blockScalarIndent=-1,this.blockScalarKeep=!1;let e=this.pos;for(;;){const t=this.buffer[++e];if("+"===t)this.blockScalarKeep=!0;else if(t>"0"&&t<="9")this.blockScalarIndent=Number(t)-1;else if("-"!==t)break}return yield*this.pushUntil((e=>r(e)||"#"===e))}*parseBlockScalar(){let e,t=this.pos-1,n=0;e:for(let s=this.pos;e=this.buffer[s];++s)switch(e){case" ":n+=1;break;case"\n":t=s,n=0;break;case"\r":{const e=this.buffer[s+1];if(!e&&!this.atEnd)return this.setNext("block-scalar");if("\n"===e)break}default:break e}if(!e&&!this.atEnd)return this.setNext("block-scalar");if(n>=this.indentNext){-1===this.blockScalarIndent?this.indentNext=n:this.indentNext=this.blockScalarIndent+(0===this.indentNext?1:this.indentNext);do{const e=this.continueScalar(t+1);if(-1===e)break;t=this.buffer.indexOf("\n",e)}while(-1!==t);if(-1===t){if(!this.atEnd)return this.setNext("block-scalar");t=this.buffer.length}}let r=t+1;for(e=this.buffer[r];" "===e;)e=this.buffer[++r];if("\t"===e){for(;"\t"===e||" "===e||"\r"===e||"\n"===e;)e=this.buffer[++r];t=r-1}else if(!this.blockScalarKeep)for(;;){let e=t-1,s=this.buffer[e];"\r"===s&&(s=this.buffer[--e]);const r=e;for(;" "===s;)s=this.buffer[--e];if(!("\n"===s&&e>=this.pos&&e+1+n>r))break;t=e}return yield s.SCALAR,yield*this.pushToIndex(t+1,!0),yield*this.parseLineStart()}*parsePlainScalar(){const e=this.flowLevel>0;let t,n=this.pos-1,a=this.pos-1;for(;t=this.buffer[++a];)if(":"===t){const t=this.buffer[a+1];if(r(t)||e&&i.has(t))break;n=a}else if(r(t)){let s=this.buffer[a+1];if("\r"===t&&("\n"===s?(a+=1,t="\n",s=this.buffer[a+1]):n=a),"#"===s||e&&i.has(s))break;if("\n"===t){const e=this.continueScalar(a+1);if(-1===e)break;a=Math.max(a,e-2)}}else{if(e&&i.has(t))break;n=a}return t||this.atEnd?(yield s.SCALAR,yield*this.pushToIndex(n+1,!0),e?"flow":"doc"):this.setNext("plain-scalar")}*pushCount(e){return e>0?(yield this.buffer.substr(this.pos,e),this.pos+=e,e):0}*pushToIndex(e,t){const n=this.buffer.slice(this.pos,e);return n?(yield n,this.pos+=n.length,n.length):(t&&(yield""),0)}*pushIndicators(){switch(this.charAt(0)){case"!":return(yield*this.pushTag())+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"&":return(yield*this.pushUntil(l))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"-":case"?":case":":{const e=this.flowLevel>0,t=this.charAt(1);if(r(t)||e&&i.has(t))return e?this.flowKey&&(this.flowKey=!1):this.indentNext=this.indentValue+1,(yield*this.pushCount(1))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators())}}return 0}*pushTag(){if("<"===this.charAt(1)){let e=this.pos+2,t=this.buffer[e];for(;!r(t)&&">"!==t;)t=this.buffer[++e];return yield*this.pushToIndex(">"===t?e+1:e,!1)}{let e=this.pos+1,t=this.buffer[e];for(;t;)if(o.has(t))t=this.buffer[++e];else{if("%"!==t||!a.has(this.buffer[e+1])||!a.has(this.buffer[e+2]))break;t=this.buffer[e+=3]}return yield*this.pushToIndex(e,!1)}}*pushNewline(){const e=this.buffer[this.pos];return"\n"===e?yield*this.pushCount(1):"\r"===e&&"\n"===this.charAt(1)?yield*this.pushCount(2):0}*pushSpaces(e){let t,n=this.pos-1;do{t=this.buffer[++n]}while(" "===t||e&&"\t"===t);const s=n-this.pos;return s>0&&(yield this.buffer.substr(this.pos,s),this.pos=n),s}*pushUntil(e){let t=this.pos,n=this.buffer[t];for(;!e(n);)n=this.buffer[++t];return yield*this.pushToIndex(t,!1)}}},5822:(e,t,n)=>{var s=n(3334),r=n(6055),a=n(1919),o=n(8531),i=n(8080),c=n(7969),l=n(7191),u=n(6936),d=n(9637),h=n(692),p=n(8416),f=n(2557),m=n(5437);const g=[s.map,a.seq,o.string,r.nullTag,c.trueTag,c.falseTag,u.intBin,u.intOct,u.int,u.intHex,l.floatNaN,l.floatExp,l.float,i.binary,d.merge,h.omap,p.pairs,f.set,m.intTime,m.floatTime,m.timestamp];t.schema=g},5953:function(e,t,n){var s,r=this&&this.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},s(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=s(e),o=0;o<n.length;o++)"default"!==n[o]&&r(t,e,n[o]);return a(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.RuleImpl=void 0;const i=o(n(1943)),c=o(n(6928)),l=o(n(1198));class u{constructor(e,t,n,s,r=!1,a=[],o={},i=[]){this.id=e,this.name=t,this.description=n,this.content=s,this.isGlobal=r,this.tags=a,this.frontmatter=o,this.appliedProjects=i}applyToProject(e){return!this.appliedProjects.includes(e)&&(this.appliedProjects.push(e),!0)}makeGlobal(){this.isGlobal=!0}async exportToFile(e){try{const t={...this.frontmatter,name:this.name,description:this.description,tags:this.tags},n=`---\n${l.stringify(t)}---\n\n${this.content}`,s=c.dirname(e);return await i.mkdir(s,{recursive:!0}),await i.writeFile(e,n,"utf8"),!0}catch(e){return console.error(`Error exporting rule to file: ${e}`),!1}}serialize(){return{id:this.id,name:this.name,description:this.description,content:this.content,isGlobal:this.isGlobal,tags:this.tags,frontmatter:this.frontmatter,appliedProjects:this.appliedProjects}}static deserialize(e){return new u(e.id,e.name,e.description,e.content,e.isGlobal,Array.isArray(e.tags)?e.tags:[],e.frontmatter||{},Array.isArray(e.appliedProjects)?e.appliedProjects:[])}static async fromMDCFile(e){try{const t=await i.readFile(e,"utf8"),n=t.match(/^---\n([\s\S]*?)\n---\n([\s\S]*)$/);if(n){const[,t,s]=n,r=l.parse(t)||{};return new u(`rule-${Date.now()}`,r.name||c.basename(e,".mdc"),r.description||"",s.trim(),!1,Array.isArray(r.tags)?r.tags:[],r,[])}{const n=c.basename(e,".mdc");return new u(`rule-${Date.now()}`,n,"",t.trim(),!1,[],{},[])}}catch(e){throw console.error(`Error reading MDC file: ${e}`),new Error(`Failed to parse MDC file: ${e}`)}}}t.RuleImpl=u},5970:(e,t)=>{const n=Symbol("break visit"),s=Symbol("skip children"),r=Symbol("remove item");function a(e,t){"type"in e&&"document"===e.type&&(e={start:e.start,value:e.value}),o(Object.freeze([]),e,t)}function o(e,t,s){let a=s(t,e);if("symbol"==typeof a)return a;for(const i of["key","value"]){const c=t[i];if(c&&"items"in c){for(let t=0;t<c.items.length;++t){const a=o(Object.freeze(e.concat([[i,t]])),c.items[t],s);if("number"==typeof a)t=a-1;else{if(a===n)return n;a===r&&(c.items.splice(t,1),t-=1)}}"function"==typeof a&&"key"===i&&(a=a(t,e))}}return"function"==typeof a?a(t,e):a}a.BREAK=n,a.SKIP=s,a.REMOVE=r,a.itemAtPath=(e,t)=>{let n=e;for(const[e,s]of t){const t=n?.[e];if(!t||!("items"in t))return;n=t.items[s]}return n},a.parentCollection=(e,t)=>{const n=a.itemAtPath(e,t.slice(0,-1)),s=t[t.length-1][0],r=n?.[s];if(r&&"items"in r)return r;throw new Error("Parent collection not found")},t.visit=a},6010:(e,t,n)=>{var s=n(5219),r=n(81),a=n(1614),o=n(484),i=n(9714),c=n(3732);class l extends a.Collection{static get tagName(){return"tag:yaml.org,2002:seq"}constructor(e){super(o.SEQ,e),this.items=[]}add(e){this.items.push(e)}delete(e){const t=u(e);return"number"==typeof t&&this.items.splice(t,1).length>0}get(e,t){const n=u(e);if("number"!=typeof n)return;const s=this.items[n];return!t&&o.isScalar(s)?s.value:s}has(e){const t=u(e);return"number"==typeof t&&t<this.items.length}set(e,t){const n=u(e);if("number"!=typeof n)throw new Error(`Expected a valid index, not ${e}.`);const s=this.items[n];o.isScalar(s)&&i.isScalarValue(t)?s.value=t:this.items[n]=t}toJSON(e,t){const n=[];t?.onCreate&&t.onCreate(n);let s=0;for(const e of this.items)n.push(c.toJS(e,String(s++),t));return n}toString(e,t,n){return e?r.stringifyCollection(this,e,{blockItemPrefix:"- ",flowChars:{start:"[",end:"]"},itemIndent:(e.indent||"")+"  ",onChompKeep:n,onComment:t}):JSON.stringify(this)}static from(e,t,n){const{replacer:r}=n,a=new this(e);if(t&&Symbol.iterator in Object(t)){let e=0;for(let o of t){if("function"==typeof r){const n=t instanceof Set?o:String(e++);o=r.call(t,n,o)}a.items.push(s.createNode(o,void 0,n))}}return a}}function u(e){let t=o.isScalar(e)?e.value:e;return t&&"string"==typeof t&&(t=Number(t)),"number"==typeof t&&Number.isInteger(t)&&t>=0?t:null}t.YAMLSeq=l},6055:(e,t,n)=>{var s=n(9714);const r={identify:e=>null==e,createNode:()=>new s.Scalar(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^(?:~|[Nn]ull|NULL)?$/,resolve:()=>new s.Scalar(null),stringify:({source:e},t)=>"string"==typeof e&&r.test.test(e)?e:t.options.nullStr};t.nullTag=r},6170:(e,t)=>{const n="block",s="quoted";function r(e,t,n){let s=t,r=t+1,a=e[r];for(;" "===a||"\t"===a;)if(t<r+n)a=e[++t];else{do{a=e[++t]}while(a&&"\n"!==a);s=t,r=t+1,a=e[r]}return s}t.FOLD_BLOCK=n,t.FOLD_FLOW="flow",t.FOLD_QUOTED=s,t.foldFlowLines=function(e,t,a="flow",{indentAtStart:o,lineWidth:i=80,minContentWidth:c=20,onFold:l,onOverflow:u}={}){if(!i||i<0)return e;i<c&&(c=0);const d=Math.max(1+c,1+i-t.length);if(e.length<=d)return e;const h=[],p={};let f,m,g=i-t.length;"number"==typeof o&&(o>i-Math.max(2,c)?h.push(0):g=i-o);let y=!1,w=-1,v=-1,b=-1;a===n&&(w=r(e,w,t.length),-1!==w&&(g=w+d));for(let o;o=e[w+=1];){if(a===s&&"\\"===o){switch(v=w,e[w+1]){case"x":w+=3;break;case"u":w+=5;break;case"U":w+=9;break;default:w+=1}b=w}if("\n"===o)a===n&&(w=r(e,w,t.length)),g=w+t.length+d,f=void 0;else{if(" "===o&&m&&" "!==m&&"\n"!==m&&"\t"!==m){const t=e[w+1];t&&" "!==t&&"\n"!==t&&"\t"!==t&&(f=w)}if(w>=g)if(f)h.push(f),g=f+d,f=void 0;else if(a===s){for(;" "===m||"\t"===m;)m=o,o=e[w+=1],y=!0;const t=w>b+1?w-2:v-1;if(p[t])return e;h.push(t),p[t]=!0,g=t+d,f=void 0}else y=!0}m=o}if(y&&u&&u(),0===h.length)return e;l&&l();let S=e.slice(0,h[0]);for(let n=0;n<h.length;++n){const r=h[n],o=h[n+1]||e.length;0===r?S=`\n${t}${e.slice(0,o)}`:(a===s&&p[r]&&(S+=`${e[r]}\\`),S+=`\n${t}${e.slice(r+1,o)}`)}return S}},6247:(e,t,n)=>{var s=n(932),r=n(9112),a=n(5752);function o(e,t){for(let n=0;n<e.length;++n)if(e[n].type===t)return!0;return!1}function i(e){for(let t=0;t<e.length;++t)switch(e[t].type){case"space":case"comment":case"newline":break;default:return t}return-1}function c(e){switch(e?.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"flow-collection":return!0;default:return!1}}function l(e){switch(e.type){case"document":return e.start;case"block-map":{const t=e.items[e.items.length-1];return t.sep??t.start}case"block-seq":return e.items[e.items.length-1].start;default:return[]}}function u(e){if(0===e.length)return[];let t=e.length;e:for(;--t>=0;)switch(e[t].type){case"doc-start":case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":case"newline":break e}for(;"space"===e[++t]?.type;);return e.splice(t,e.length)}function d(e){if("flow-seq-start"===e.start.type)for(const t of e.items)!t.sep||t.value||o(t.start,"explicit-key-ind")||o(t.sep,"map-value-ind")||(t.key&&(t.value=t.key),delete t.key,c(t.value)?t.value.end?Array.prototype.push.apply(t.value.end,t.sep):t.value.end=t.sep:Array.prototype.push.apply(t.start,t.sep),delete t.sep)}t.Parser=class{constructor(e){this.atNewLine=!0,this.atScalar=!1,this.indent=0,this.offset=0,this.onKeyLine=!1,this.stack=[],this.source="",this.type="",this.lexer=new a.Lexer,this.onNewLine=e}*parse(e,t=!1){this.onNewLine&&0===this.offset&&this.onNewLine(0);for(const n of this.lexer.lex(e,t))yield*this.next(n);t||(yield*this.end())}*next(e){if(this.source=e,s.env.LOG_TOKENS&&console.log("|",r.prettyToken(e)),this.atScalar)return this.atScalar=!1,yield*this.step(),void(this.offset+=e.length);const t=r.tokenType(e);if(t)if("scalar"===t)this.atNewLine=!1,this.atScalar=!0,this.type="scalar";else{switch(this.type=t,yield*this.step(),t){case"newline":this.atNewLine=!0,this.indent=0,this.onNewLine&&this.onNewLine(this.offset+e.length);break;case"space":this.atNewLine&&" "===e[0]&&(this.indent+=e.length);break;case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":this.atNewLine&&(this.indent+=e.length);break;case"doc-mode":case"flow-error-end":return;default:this.atNewLine=!1}this.offset+=e.length}else{const t=`Not a YAML token: ${e}`;yield*this.pop({type:"error",offset:this.offset,message:t,source:e}),this.offset+=e.length}}*end(){for(;this.stack.length>0;)yield*this.pop()}get sourceToken(){return{type:this.type,offset:this.offset,indent:this.indent,source:this.source}}*step(){const e=this.peek(1);if("doc-end"!==this.type||e&&"doc-end"===e.type){if(!e)return yield*this.stream();switch(e.type){case"document":return yield*this.document(e);case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return yield*this.scalar(e);case"block-scalar":return yield*this.blockScalar(e);case"block-map":return yield*this.blockMap(e);case"block-seq":return yield*this.blockSequence(e);case"flow-collection":return yield*this.flowCollection(e);case"doc-end":return yield*this.documentEnd(e)}yield*this.pop()}else{for(;this.stack.length>0;)yield*this.pop();this.stack.push({type:"doc-end",offset:this.offset,source:this.source})}}peek(e){return this.stack[this.stack.length-e]}*pop(e){const t=e??this.stack.pop();if(t)if(0===this.stack.length)yield t;else{const e=this.peek(1);switch("block-scalar"===t.type?t.indent="indent"in e?e.indent:0:"flow-collection"===t.type&&"document"===e.type&&(t.indent=0),"flow-collection"===t.type&&d(t),e.type){case"document":e.value=t;break;case"block-scalar":e.props.push(t);break;case"block-map":{const n=e.items[e.items.length-1];if(n.value)return e.items.push({start:[],key:t,sep:[]}),void(this.onKeyLine=!0);if(!n.sep)return Object.assign(n,{key:t,sep:[]}),void(this.onKeyLine=!n.explicitKey);n.value=t;break}case"block-seq":{const n=e.items[e.items.length-1];n.value?e.items.push({start:[],value:t}):n.value=t;break}case"flow-collection":{const n=e.items[e.items.length-1];return void(!n||n.value?e.items.push({start:[],key:t,sep:[]}):n.sep?n.value=t:Object.assign(n,{key:t,sep:[]}))}default:yield*this.pop(),yield*this.pop(t)}if(!("document"!==e.type&&"block-map"!==e.type&&"block-seq"!==e.type||"block-map"!==t.type&&"block-seq"!==t.type)){const n=t.items[t.items.length-1];n&&!n.sep&&!n.value&&n.start.length>0&&-1===i(n.start)&&(0===t.indent||n.start.every((e=>"comment"!==e.type||e.indent<t.indent)))&&("document"===e.type?e.end=n.start:e.items.push({start:n.start}),t.items.splice(-1,1))}}else{const e="Tried to pop an empty stack";yield{type:"error",offset:this.offset,source:"",message:e}}}*stream(){switch(this.type){case"directive-line":return void(yield{type:"directive",offset:this.offset,source:this.source});case"byte-order-mark":case"space":case"comment":case"newline":return void(yield this.sourceToken);case"doc-mode":case"doc-start":{const e={type:"document",offset:this.offset,start:[]};return"doc-start"===this.type&&e.start.push(this.sourceToken),void this.stack.push(e)}}yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML stream`,source:this.source}}*document(e){if(e.value)return yield*this.lineEnd(e);switch(this.type){case"doc-start":return void(-1!==i(e.start)?(yield*this.pop(),yield*this.step()):e.start.push(this.sourceToken));case"anchor":case"tag":case"space":case"comment":case"newline":return void e.start.push(this.sourceToken)}const t=this.startBlockValue(e);t?this.stack.push(t):yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML document`,source:this.source}}*scalar(e){if("map-value-ind"===this.type){const t=u(l(this.peek(2)));let n;e.end?(n=e.end,n.push(this.sourceToken),delete e.end):n=[this.sourceToken];const s={type:"block-map",offset:e.offset,indent:e.indent,items:[{start:t,key:e,sep:n}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=s}else yield*this.lineEnd(e)}*blockScalar(e){switch(this.type){case"space":case"comment":case"newline":return void e.props.push(this.sourceToken);case"scalar":if(e.source=this.source,this.atNewLine=!0,this.indent=0,this.onNewLine){let e=this.source.indexOf("\n")+1;for(;0!==e;)this.onNewLine(this.offset+e),e=this.source.indexOf("\n",e)+1}yield*this.pop();break;default:yield*this.pop(),yield*this.step()}}*blockMap(e){const t=e.items[e.items.length-1];switch(this.type){case"newline":if(this.onKeyLine=!1,t.value){const n="end"in t.value?t.value.end:void 0,s=Array.isArray(n)?n[n.length-1]:void 0;"comment"===s?.type?n?.push(this.sourceToken):e.items.push({start:[this.sourceToken]})}else t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken);return;case"space":case"comment":if(t.value)e.items.push({start:[this.sourceToken]});else if(t.sep)t.sep.push(this.sourceToken);else{if(this.atIndentedComment(t.start,e.indent)){const n=e.items[e.items.length-2],s=n?.value?.end;if(Array.isArray(s))return Array.prototype.push.apply(s,t.start),s.push(this.sourceToken),void e.items.pop()}t.start.push(this.sourceToken)}return}if(this.indent>=e.indent){const n=!this.onKeyLine&&this.indent===e.indent,s=n&&(t.sep||t.explicitKey)&&"seq-item-ind"!==this.type;let r=[];if(s&&t.sep&&!t.value){const n=[];for(let s=0;s<t.sep.length;++s){const r=t.sep[s];switch(r.type){case"newline":n.push(s);break;case"space":break;case"comment":r.indent>e.indent&&(n.length=0);break;default:n.length=0}}n.length>=2&&(r=t.sep.splice(n[1]))}switch(this.type){case"anchor":case"tag":return void(s||t.value?(r.push(this.sourceToken),e.items.push({start:r}),this.onKeyLine=!0):t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken));case"explicit-key-ind":return t.sep||t.explicitKey?s||t.value?(r.push(this.sourceToken),e.items.push({start:r,explicitKey:!0})):this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken],explicitKey:!0}]}):(t.start.push(this.sourceToken),t.explicitKey=!0),void(this.onKeyLine=!0);case"map-value-ind":if(t.explicitKey)if(t.sep)if(t.value)e.items.push({start:[],key:null,sep:[this.sourceToken]});else if(o(t.sep,"map-value-ind"))this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:r,key:null,sep:[this.sourceToken]}]});else if(c(t.key)&&!o(t.sep,"newline")){const e=u(t.start),n=t.key,s=t.sep;s.push(this.sourceToken),delete t.key,delete t.sep,this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:e,key:n,sep:s}]})}else r.length>0?t.sep=t.sep.concat(r,this.sourceToken):t.sep.push(this.sourceToken);else if(o(t.start,"newline"))Object.assign(t,{key:null,sep:[this.sourceToken]});else{const e=u(t.start);this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:e,key:null,sep:[this.sourceToken]}]})}else t.sep?t.value||s?e.items.push({start:r,key:null,sep:[this.sourceToken]}):o(t.sep,"map-value-ind")?this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[],key:null,sep:[this.sourceToken]}]}):t.sep.push(this.sourceToken):Object.assign(t,{key:null,sep:[this.sourceToken]});return void(this.onKeyLine=!0);case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{const n=this.flowScalar(this.type);return void(s||t.value?(e.items.push({start:r,key:n,sep:[]}),this.onKeyLine=!0):t.sep?this.stack.push(n):(Object.assign(t,{key:n,sep:[]}),this.onKeyLine=!0))}default:{const s=this.startBlockValue(e);if(s){if("block-seq"===s.type){if(!t.explicitKey&&t.sep&&!o(t.sep,"newline"))return void(yield*this.pop({type:"error",offset:this.offset,message:"Unexpected block-seq-ind on same line with key",source:this.source}))}else n&&e.items.push({start:r});return void this.stack.push(s)}}}}yield*this.pop(),yield*this.step()}*blockSequence(e){const t=e.items[e.items.length-1];switch(this.type){case"newline":if(t.value){const n="end"in t.value?t.value.end:void 0,s=Array.isArray(n)?n[n.length-1]:void 0;"comment"===s?.type?n?.push(this.sourceToken):e.items.push({start:[this.sourceToken]})}else t.start.push(this.sourceToken);return;case"space":case"comment":if(t.value)e.items.push({start:[this.sourceToken]});else{if(this.atIndentedComment(t.start,e.indent)){const n=e.items[e.items.length-2],s=n?.value?.end;if(Array.isArray(s))return Array.prototype.push.apply(s,t.start),s.push(this.sourceToken),void e.items.pop()}t.start.push(this.sourceToken)}return;case"anchor":case"tag":if(t.value||this.indent<=e.indent)break;return void t.start.push(this.sourceToken);case"seq-item-ind":if(this.indent!==e.indent)break;return void(t.value||o(t.start,"seq-item-ind")?e.items.push({start:[this.sourceToken]}):t.start.push(this.sourceToken))}if(this.indent>e.indent){const t=this.startBlockValue(e);if(t)return void this.stack.push(t)}yield*this.pop(),yield*this.step()}*flowCollection(e){const t=e.items[e.items.length-1];if("flow-error-end"===this.type){let e;do{yield*this.pop(),e=this.peek(1)}while(e&&"flow-collection"===e.type)}else if(0===e.end.length){switch(this.type){case"comma":case"explicit-key-ind":return void(!t||t.sep?e.items.push({start:[this.sourceToken]}):t.start.push(this.sourceToken));case"map-value-ind":return void(!t||t.value?e.items.push({start:[],key:null,sep:[this.sourceToken]}):t.sep?t.sep.push(this.sourceToken):Object.assign(t,{key:null,sep:[this.sourceToken]}));case"space":case"comment":case"newline":case"anchor":case"tag":return void(!t||t.value?e.items.push({start:[this.sourceToken]}):t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken));case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{const n=this.flowScalar(this.type);return void(!t||t.value?e.items.push({start:[],key:n,sep:[]}):t.sep?this.stack.push(n):Object.assign(t,{key:n,sep:[]}))}case"flow-map-end":case"flow-seq-end":return void e.end.push(this.sourceToken)}const n=this.startBlockValue(e);n?this.stack.push(n):(yield*this.pop(),yield*this.step())}else{const t=this.peek(2);if("block-map"===t.type&&("map-value-ind"===this.type&&t.indent===e.indent||"newline"===this.type&&!t.items[t.items.length-1].sep))yield*this.pop(),yield*this.step();else if("map-value-ind"===this.type&&"flow-collection"!==t.type){const n=u(l(t));d(e);const s=e.end.splice(1,e.end.length);s.push(this.sourceToken);const r={type:"block-map",offset:e.offset,indent:e.indent,items:[{start:n,key:e,sep:s}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=r}else yield*this.lineEnd(e)}}flowScalar(e){if(this.onNewLine){let e=this.source.indexOf("\n")+1;for(;0!==e;)this.onNewLine(this.offset+e),e=this.source.indexOf("\n",e)+1}return{type:e,offset:this.offset,indent:this.indent,source:this.source}}startBlockValue(e){switch(this.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return this.flowScalar(this.type);case"block-scalar-header":return{type:"block-scalar",offset:this.offset,indent:this.indent,props:[this.sourceToken],source:""};case"flow-map-start":case"flow-seq-start":return{type:"flow-collection",offset:this.offset,indent:this.indent,start:this.sourceToken,items:[],end:[]};case"seq-item-ind":return{type:"block-seq",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken]}]};case"explicit-key-ind":{this.onKeyLine=!0;const t=u(l(e));return t.push(this.sourceToken),{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:t,explicitKey:!0}]}}case"map-value-ind":{this.onKeyLine=!0;const t=u(l(e));return{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:t,key:null,sep:[this.sourceToken]}]}}}return null}atIndentedComment(e,t){return"comment"===this.type&&!(this.indent<=t)&&e.every((e=>"newline"===e.type||"space"===e.type))}*documentEnd(e){"doc-mode"!==this.type&&(e.end?e.end.push(this.sourceToken):e.end=[this.sourceToken],"newline"===this.type&&(yield*this.pop()))}*lineEnd(e){switch(this.type){case"comma":case"doc-start":case"doc-end":case"flow-seq-end":case"flow-map-end":case"map-value-ind":yield*this.pop(),yield*this.step();break;case"newline":this.onKeyLine=!1;default:e.end?e.end.push(this.sourceToken):e.end=[this.sourceToken],"newline"===this.type&&(yield*this.pop())}}}},6261:(e,t,n)=>{var s=n(484),r=n(9125);function a(e){const t=new Set;return r.visit(e,{Value(e,n){n.anchor&&t.add(n.anchor)}}),t}function o(e,t){for(let n=1;;++n){const s=`${e}${n}`;if(!t.has(s))return s}}t.anchorIsValid=function(e){if(/[\x00-\x19\s,[\]{}]/.test(e)){const t=JSON.stringify(e);throw new Error(`Anchor must not contain whitespace or control characters: ${t}`)}return!0},t.anchorNames=a,t.createNodeAnchors=function(e,t){const n=[],r=new Map;let i=null;return{onAnchor:s=>{n.push(s),i??(i=a(e));const r=o(t,i);return i.add(r),r},setAnchors:()=>{for(const e of n){const t=r.get(e);if("object"!=typeof t||!t.anchor||!s.isScalar(t.node)&&!s.isCollection(t.node)){const t=new Error("Failed to resolve repeated object (this should not happen)");throw t.source=e,t}t.node.anchor=t.anchor}},sourceObjects:r}},t.findNewAnchor=o},6845:(e,t)=>{t.resolveEnd=function(e,t,n,s){let r="";if(e){let a=!1,o="";for(const i of e){const{source:e,type:c}=i;switch(c){case"space":a=!0;break;case"comment":{n&&!a&&s(i,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");const t=e.substring(1)||" ";r?r+=o+t:r=t,o="";break}case"newline":r&&(o+=e),a=!0;break;default:s(i,"UNEXPECTED_TOKEN",`Unexpected ${c} at node end`)}t+=e.length}}return{comment:r,offset:t}}},6899:(e,t,n)=>{n.r(t),n.d(t,{NIL:()=>P,parse:()=>w,stringify:()=>h,v1:()=>y,v3:()=>b,v4:()=>E,v5:()=>k,validate:()=>l,version:()=>I});const s=require("crypto");var r=n.n(s);const a=new Uint8Array(256);let o=a.length;function i(){return o>a.length-16&&(r().randomFillSync(a),o=0),a.slice(o,o+=16)}const c=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,l=function(e){return"string"==typeof e&&c.test(e)},u=[];for(let e=0;e<256;++e)u.push((e+256).toString(16).slice(1));function d(e,t=0){return u[e[t+0]]+u[e[t+1]]+u[e[t+2]]+u[e[t+3]]+"-"+u[e[t+4]]+u[e[t+5]]+"-"+u[e[t+6]]+u[e[t+7]]+"-"+u[e[t+8]]+u[e[t+9]]+"-"+u[e[t+10]]+u[e[t+11]]+u[e[t+12]]+u[e[t+13]]+u[e[t+14]]+u[e[t+15]]}const h=function(e,t=0){const n=d(e,t);if(!l(n))throw TypeError("Stringified UUID is invalid");return n};let p,f,m=0,g=0;const y=function(e,t,n){let s=t&&n||0;const r=t||new Array(16);let a=(e=e||{}).node||p,o=void 0!==e.clockseq?e.clockseq:f;if(null==a||null==o){const t=e.random||(e.rng||i)();null==a&&(a=p=[1|t[0],t[1],t[2],t[3],t[4],t[5]]),null==o&&(o=f=16383&(t[6]<<8|t[7]))}let c=void 0!==e.msecs?e.msecs:Date.now(),l=void 0!==e.nsecs?e.nsecs:g+1;const u=c-m+(l-g)/1e4;if(u<0&&void 0===e.clockseq&&(o=o+1&16383),(u<0||c>m)&&void 0===e.nsecs&&(l=0),l>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");m=c,g=l,f=o,c+=122192928e5;const h=(1e4*(268435455&c)+l)%4294967296;r[s++]=h>>>24&255,r[s++]=h>>>16&255,r[s++]=h>>>8&255,r[s++]=255&h;const y=c/4294967296*1e4&268435455;r[s++]=y>>>8&255,r[s++]=255&y,r[s++]=y>>>24&15|16,r[s++]=y>>>16&255,r[s++]=o>>>8|128,r[s++]=255&o;for(let e=0;e<6;++e)r[s+e]=a[e];return t||d(r)},w=function(e){if(!l(e))throw TypeError("Invalid UUID");let t;const n=new Uint8Array(16);return n[0]=(t=parseInt(e.slice(0,8),16))>>>24,n[1]=t>>>16&255,n[2]=t>>>8&255,n[3]=255&t,n[4]=(t=parseInt(e.slice(9,13),16))>>>8,n[5]=255&t,n[6]=(t=parseInt(e.slice(14,18),16))>>>8,n[7]=255&t,n[8]=(t=parseInt(e.slice(19,23),16))>>>8,n[9]=255&t,n[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,n[11]=t/4294967296&255,n[12]=t>>>24&255,n[13]=t>>>16&255,n[14]=t>>>8&255,n[15]=255&t,n};function v(e,t,n){function s(e,s,r,a){var o;if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));const t=[];for(let n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t}(e)),"string"==typeof s&&(s=w(s)),16!==(null===(o=s)||void 0===o?void 0:o.length))throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let i=new Uint8Array(16+e.length);if(i.set(s),i.set(e,s.length),i=n(i),i[6]=15&i[6]|t,i[8]=63&i[8]|128,r){a=a||0;for(let e=0;e<16;++e)r[a+e]=i[e];return r}return d(i)}try{s.name=e}catch(e){}return s.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",s.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",s}const b=v("v3",48,(function(e){return Array.isArray(e)?e=Buffer.from(e):"string"==typeof e&&(e=Buffer.from(e,"utf8")),r().createHash("md5").update(e).digest()})),S={randomUUID:r().randomUUID},E=function(e,t,n){if(S.randomUUID&&!t&&!e)return S.randomUUID();const s=(e=e||{}).random||(e.rng||i)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=s[e];return t}return d(s)},k=v("v5",80,(function(e){return Array.isArray(e)?e=Buffer.from(e):"string"==typeof e&&(e=Buffer.from(e,"utf8")),r().createHash("sha1").update(e).digest()})),P="00000000-0000-0000-0000-000000000000",I=function(e){if(!l(e))throw TypeError("Invalid UUID");return parseInt(e.slice(14,15),16)}},6906:(e,t)=>{t.applyReviver=function e(t,n,s,r){if(r&&"object"==typeof r)if(Array.isArray(r))for(let n=0,s=r.length;n<s;++n){const s=r[n],a=e(t,r,String(n),s);void 0===a?delete r[n]:a!==s&&(r[n]=a)}else if(r instanceof Map)for(const n of Array.from(r.keys())){const s=r.get(n),a=e(t,r,n,s);void 0===a?r.delete(n):a!==s&&r.set(n,a)}else if(r instanceof Set)for(const n of Array.from(r)){const s=e(t,r,n,n);void 0===s?r.delete(n):s!==n&&(r.delete(n),r.add(s))}else for(const[n,s]of Object.entries(r)){const a=e(t,r,n,s);void 0===a?delete r[n]:a!==s&&(r[n]=a)}return t.call(n,s,r)}},6928:e=>{e.exports=require("path")},6936:(e,t,n)=>{var s=n(3144);const r=e=>"bigint"==typeof e||Number.isInteger(e);function a(e,t,n,{intAsBigInt:s}){const r=e[0];if("-"!==r&&"+"!==r||(t+=1),e=e.substring(t).replace(/_/g,""),s){switch(n){case 2:e=`0b${e}`;break;case 8:e=`0o${e}`;break;case 16:e=`0x${e}`}const t=BigInt(e);return"-"===r?BigInt(-1)*t:t}const a=parseInt(e,n);return"-"===r?-1*a:a}function o(e,t,n){const{value:a}=e;if(r(a)){const e=a.toString(t);return a<0?"-"+n+e.substr(1):n+e}return s.stringifyNumber(e)}const i={identify:r,default:!0,tag:"tag:yaml.org,2002:int",format:"BIN",test:/^[-+]?0b[0-1_]+$/,resolve:(e,t,n)=>a(e,2,2,n),stringify:e=>o(e,2,"0b")},c={identify:r,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^[-+]?0[0-7_]+$/,resolve:(e,t,n)=>a(e,1,8,n),stringify:e=>o(e,8,"0")},l={identify:r,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9][0-9_]*$/,resolve:(e,t,n)=>a(e,0,10,n),stringify:s.stringifyNumber},u={identify:r,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^[-+]?0x[0-9a-fA-F_]+$/,resolve:(e,t,n)=>a(e,2,16,n),stringify:e=>o(e,16,"0x")};t.int=l,t.intBin=i,t.intHex=u,t.intOct=c},7050:function(e,t,n){var s,r=this&&this.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},s(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=s(e),o=0;o<n.length;o++)"default"!==n[o]&&r(t,e,n[o]);return a(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.ExportView=void 0;const i=o(n(1398)),c=o(n(6928)),l=n(3952),u=n(8191);class d{constructor(e,t){this.disposables=[],this.panel=e,this.context=t,this.updateWebview(),this.panel.onDidDispose((()=>this.dispose()),null,this.disposables),this.panel.webview.onDidReceiveMessage((async e=>{"export"!==e.command||await this.handleExport(e.data)}),null,this.disposables)}static createOrShow(e){const t=i.window.activeTextEditor?i.window.activeTextEditor.viewColumn:void 0;if(d.currentPanel)return void d.currentPanel.panel.reveal(t);const n=i.window.createWebviewPanel("cursorChatManagerExport","Export Cursor Chats",t||i.ViewColumn.One,{enableScripts:!0,localResourceRoots:[i.Uri.file(c.join(e.extensionPath,"resources"))]});d.currentPanel=new d(n,e)}async handleExport(e){try{const t=l.ExportService.getInstance(),n={format:e.format,includeMetadata:e.includeMetadata,includeTimestamps:e.includeTimestamps,includeTags:e.includeTags,targetPath:e.targetPath};await i.window.withProgress({location:i.ProgressLocation.Notification,title:"Exporting Chats",cancellable:!1},(async s=>{if("all"===e.exportType){const e=u.ProjectOrganizer.getInstance(),r=await e.getAllProjects();let a=r.length,o=0;for(const e of r)s.report({message:`Exporting project ${e.name} (${o+1}/${a})`,increment:1/a*100}),await t.exportProject(e,n),o++}else if("project"===e.exportType){const r=u.ProjectOrganizer.getInstance(),a=await r.getProject(e.projectId);if(!a)throw new Error(`Project with ID ${e.projectId} not found`);s.report({message:`Exporting project ${a.name}`,increment:50}),await t.exportProject(a,n),s.report({increment:50})}else if("chat"===e.exportType){const r=u.ProjectOrganizer.getInstance(),a=await r.getAllProjects();let o=!1;for(const r of a){const a=r.chats.find((t=>t.id===e.chatId));if(a){s.report({message:`Exporting chat ${a.title}`,increment:50}),await t.exportChat(a,n),s.report({increment:50}),o=!0;break}}if(!o)throw new Error(`Chat with ID ${e.chatId} not found`)}return Promise.resolve()})),this.panel.webview.postMessage({command:"exportComplete",success:!0,targetPath:n.targetPath}),i.window.showInformationMessage(`Export completed successfully to ${n.targetPath}`)}catch(e){this.panel.webview.postMessage({command:"exportComplete",success:!1,error:e instanceof Error?e.message:String(e)}),i.window.showErrorMessage(`Export failed: ${e instanceof Error?e.message:String(e)}`)}}async updateWebview(){const e=this.panel.webview;try{const t=u.ProjectOrganizer.getInstance(),n=await t.getAllProjects();e.html=this.getWebviewContent(n)}catch(t){e.html=this.getErrorHtml(t)}}getWebviewContent(e){const t=this.panel.webview,n=this.getNonce(),s=e.map((e=>`<option value="${e.id}">${this.escapeHtml(e.name)} (${e.chats.length} chats)</option>`)).join("\n"),r=e.map((e=>{const t=e.chats.map((e=>`<option value="${e.id}">${this.escapeHtml(e.title)}</option>`)).join("\n");return`<optgroup label="${this.escapeHtml(e.name)}">${t}</optgroup>`})).join("\n");return`<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <meta http-equiv="Content-Security-Policy" content="default-src 'none'; style-src ${t.cspSource} 'unsafe-inline'; script-src 'nonce-${n}';">\n    <title>Export Cursor Chats</title>\n    <style>\n        body {\n            font-family: var(--vscode-font-family);\n            color: var(--vscode-foreground);\n            padding: 20px;\n            line-height: 1.5;\n        }\n        h1 {\n            color: var(--vscode-editor-foreground);\n            font-weight: 600;\n            margin-bottom: 20px;\n        }\n        .form-group {\n            margin-bottom: 20px;\n        }\n        label {\n            display: block;\n            margin-bottom: 5px;\n            font-weight: 500;\n        }\n        select, input[type="text"] {\n            width: 100%;\n            padding: 8px;\n            border: 1px solid var(--vscode-input-border);\n            background-color: var(--vscode-input-background);\n            color: var(--vscode-input-foreground);\n            border-radius: 2px;\n        }\n        .checkbox-group {\n            margin-top: 10px;\n        }\n        .checkbox-label {\n            display: flex;\n            align-items: center;\n            margin-bottom: 8px;\n            font-weight: normal;\n        }\n        input[type="checkbox"] {\n            margin-right: 8px;\n        }\n        button {\n            background-color: var(--vscode-button-background);\n            color: var(--vscode-button-foreground);\n            border: none;\n            padding: 8px 16px;\n            cursor: pointer;\n            border-radius: 2px;\n            font-weight: 500;\n        }\n        button:hover {\n            background-color: var(--vscode-button-hoverBackground);\n        }\n        .export-type-fields {\n            margin-top: 10px;\n            padding-left: 20px;\n        }\n        .hidden {\n            display: none;\n        }\n        .success {\n            color: var(--vscode-notificationsSuccessIcon-foreground);\n            margin-top: 20px;\n        }\n        .error {\n            color: var(--vscode-notificationsErrorIcon-foreground);\n            margin-top: 20px;\n        }\n    </style>\n</head>\n<body>\n    <h1>Export Cursor Chats</h1>\n    \n    <form id="exportForm">\n        <div class="form-group">\n            <label for="exportType">What to Export:</label>\n            <select id="exportType" name="exportType">\n                <option value="all">All Projects</option>\n                <option value="project">Single Project</option>\n                <option value="chat">Single Chat</option>\n            </select>\n        </div>\n        \n        <div id="projectField" class="form-group export-type-fields hidden">\n            <label for="projectId">Select Project:</label>\n            <select id="projectId" name="projectId">\n                ${s}\n            </select>\n        </div>\n        \n        <div id="chatField" class="form-group export-type-fields hidden">\n            <label for="chatId">Select Chat:</label>\n            <select id="chatId" name="chatId">\n                ${r}\n            </select>\n        </div>\n        \n        <div class="form-group">\n            <label for="format">Export Format:</label>\n            <select id="format" name="format">\n                <option value="html">HTML</option>\n                <option value="json">JSON</option>\n                <option value="text">Plain Text</option>\n            </select>\n        </div>\n        \n        <div class="form-group">\n            <label for="targetPath">Export Path:</label>\n            <input type="text" id="targetPath" name="targetPath" placeholder="C:\\Path\\To\\Export\\Directory" />\n            <small>Full path to directory where files will be saved</small>\n        </div>\n        \n        <div class="form-group">\n            <label>Export Options:</label>\n            <div class="checkbox-group">\n                <label class="checkbox-label">\n                    <input type="checkbox" id="includeMetadata" name="includeMetadata" checked />\n                    Include Metadata\n                </label>\n                <label class="checkbox-label">\n                    <input type="checkbox" id="includeTimestamps" name="includeTimestamps" checked />\n                    Include Timestamps\n                </label>\n                <label class="checkbox-label">\n                    <input type="checkbox" id="includeTags" name="includeTags" checked />\n                    Include Tags\n                </label>\n            </div>\n        </div>\n        \n        <button type="submit">Export</button>\n    </form>\n    \n    <div id="result" class="hidden"></div>\n    \n    <script nonce="${n}">\n        const vscode = acquireVsCodeApi();\n        \n        document.addEventListener('DOMContentLoaded', () => {\n            const exportForm = document.getElementById('exportForm');\n            const exportTypeSelect = document.getElementById('exportType');\n            const projectField = document.getElementById('projectField');\n            const chatField = document.getElementById('chatField');\n            const resultDiv = document.getElementById('result');\n            \n            // Show/hide fields based on export type\n            exportTypeSelect.addEventListener('change', () => {\n                const exportType = exportTypeSelect.value;\n                \n                if (exportType === 'project') {\n                    projectField.classList.remove('hidden');\n                    chatField.classList.add('hidden');\n                } else if (exportType === 'chat') {\n                    projectField.classList.add('hidden');\n                    chatField.classList.remove('hidden');\n                } else {\n                    projectField.classList.add('hidden');\n                    chatField.classList.add('hidden');\n                }\n            });\n            \n            // Handle form submission\n            exportForm.addEventListener('submit', (e) => {\n                e.preventDefault();\n                \n                const exportType = exportTypeSelect.value;\n                const format = document.getElementById('format').value;\n                const targetPath = document.getElementById('targetPath').value;\n                const includeMetadata = document.getElementById('includeMetadata').checked;\n                const includeTimestamps = document.getElementById('includeTimestamps').checked;\n                const includeTags = document.getElementById('includeTags').checked;\n                \n                if (!targetPath) {\n                    showError('Please enter an export path');\n                    return;\n                }\n                \n                // Get project or chat ID if needed\n                let projectId = null;\n                let chatId = null;\n                \n                if (exportType === 'project') {\n                    projectId = document.getElementById('projectId').value;\n                } else if (exportType === 'chat') {\n                    chatId = document.getElementById('chatId').value;\n                }\n                \n                // Send message to extension\n                vscode.postMessage({\n                    command: 'export',\n                    data: {\n                        exportType,\n                        projectId,\n                        chatId,\n                        format,\n                        targetPath,\n                        includeMetadata,\n                        includeTimestamps,\n                        includeTags\n                    }\n                });\n            });\n            \n            // Handle messages from extension\n            window.addEventListener('message', event => {\n                const message = event.data;\n                \n                if (message.command === 'exportComplete') {\n                    if (message.success) {\n                        showSuccess(\`Export completed successfully to \${message.targetPath}\`);\n                    } else {\n                        showError(\`Export failed: \${message.error}\`);\n                    }\n                }\n            });\n            \n            function showSuccess(message) {\n                resultDiv.innerHTML = \`<div class="success">\${message}</div>\`;\n                resultDiv.classList.remove('hidden');\n            }\n            \n            function showError(message) {\n                resultDiv.innerHTML = \`<div class="error">\${message}</div>\`;\n                resultDiv.classList.remove('hidden');\n            }\n        });\n    <\/script>\n</body>\n</html>`}getErrorHtml(e){const t=e instanceof Error?e.message:String(e);return`<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>Export Error</title>\n    <style>\n        body {\n            font-family: var(--vscode-font-family);\n            color: var(--vscode-foreground);\n            padding: 20px;\n        }\n        .error {\n            color: var(--vscode-notificationsErrorIcon-foreground);\n            margin-top: 20px;\n        }\n    </style>\n</head>\n<body>\n    <h1>Error Loading Export View</h1>\n    <div class="error">${this.escapeHtml(t)}</div>\n</body>\n</html>`}getNonce(){let e="";for(let t=0;t<32;t++)e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return e}escapeHtml(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}dispose(){for(d.currentPanel=void 0;this.disposables.length;){const e=this.disposables.pop();e&&e.dispose()}this.panel.dispose()}}t.ExportView=d},7109:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DatabaseService=void 0,t.DatabaseService=class{constructor(){this.isConnected=!1,this.dbPath="",this.mockData={"aiService.prompts":[],"workbench.panel.aichat.view.aichat.chatdata":[]}}async openConnection(e){return this.dbPath=e,this.isConnected=!0,console.log(`Opened connection to database: ${e}`),Promise.resolve()}async executeQuery(e,t){if(!this.isConnected)throw new Error("Database not connected");return e.includes("aiService.prompts")?this.mockData["aiService.prompts"]:e.includes("workbench.panel.aichat.view.aichat.chatdata")?this.mockData["workbench.panel.aichat.view.aichat.chatdata"]:[]}async closeConnection(){return this.isConnected=!1,console.log(`Closed connection to database: ${this.dbPath}`),Promise.resolve()}setMockData(e,t){this.mockData[e]=t}}},7180:(e,t,n)=>{var s=n(9714),r=n(6170);const a=(e,t)=>({indentAtStart:t?e.indent.length:e.indentAtStart,lineWidth:e.options.lineWidth,minContentWidth:e.options.minContentWidth}),o=e=>/^(%|---|\.\.\.)/m.test(e);function i(e,t){const n=JSON.stringify(e);if(t.options.doubleQuotedAsJSON)return n;const{implicitKey:s}=t,i=t.options.doubleQuotedMinMultiLineLength,c=t.indent||(o(e)?"  ":"");let l="",u=0;for(let e=0,t=n[e];t;t=n[++e])if(" "===t&&"\\"===n[e+1]&&"n"===n[e+2]&&(l+=n.slice(u,e)+"\\ ",e+=1,u=e,t="\\"),"\\"===t)switch(n[e+1]){case"u":{l+=n.slice(u,e);const t=n.substr(e+2,4);switch(t){case"0000":l+="\\0";break;case"0007":l+="\\a";break;case"000b":l+="\\v";break;case"001b":l+="\\e";break;case"0085":l+="\\N";break;case"00a0":l+="\\_";break;case"2028":l+="\\L";break;case"2029":l+="\\P";break;default:"00"===t.substr(0,2)?l+="\\x"+t.substr(2):l+=n.substr(e,6)}e+=5,u=e+1}break;case"n":if(s||'"'===n[e+2]||n.length<i)e+=1;else{for(l+=n.slice(u,e)+"\n\n";"\\"===n[e+2]&&"n"===n[e+3]&&'"'!==n[e+4];)l+="\n",e+=2;l+=c," "===n[e+2]&&(l+="\\"),e+=1,u=e+1}break;default:e+=1}return l=u?l+n.slice(u):n,s?l:r.foldFlowLines(l,c,r.FOLD_QUOTED,a(t,!1))}function c(e,t){if(!1===t.options.singleQuote||t.implicitKey&&e.includes("\n")||/[ \t]\n|\n[ \t]/.test(e))return i(e,t);const n=t.indent||(o(e)?"  ":""),s="'"+e.replace(/'/g,"''").replace(/\n+/g,`$&\n${n}`)+"'";return t.implicitKey?s:r.foldFlowLines(s,n,r.FOLD_FLOW,a(t,!1))}function l(e,t){const{singleQuote:n}=t.options;let s;if(!1===n)s=i;else{const t=e.includes('"'),r=e.includes("'");s=t&&!r?c:r&&!t?i:n?c:i}return s(e,t)}let u;try{u=new RegExp("(^|(?<!\n))\n+(?!\n|$)","g")}catch{u=/\n+(?!\n|$)/g}function d({comment:e,type:t,value:n},i,c,d){const{blockQuote:h,commentString:p,lineWidth:f}=i.options;if(!h||/\n[\t ]+$/.test(n)||/^\s*$/.test(n))return l(n,i);const m=i.indent||(i.forceBlockIndent||o(n)?"  ":""),g="literal"===h||"folded"!==h&&t!==s.Scalar.BLOCK_FOLDED&&(t===s.Scalar.BLOCK_LITERAL||!function(e,t,n){if(!t||t<0)return!1;const s=t-n,r=e.length;if(r<=s)return!1;for(let t=0,n=0;t<r;++t)if("\n"===e[t]){if(t-n>s)return!0;if(n=t+1,r-n<=s)return!1}return!0}(n,f,m.length));if(!n)return g?"|\n":">\n";let y,w;for(w=n.length;w>0;--w){const e=n[w-1];if("\n"!==e&&"\t"!==e&&" "!==e)break}let v=n.substring(w);const b=v.indexOf("\n");-1===b?y="-":n===v||b!==v.length-1?(y="+",d&&d()):y="",v&&(n=n.slice(0,-v.length),"\n"===v[v.length-1]&&(v=v.slice(0,-1)),v=v.replace(u,`$&${m}`));let S,E=!1,k=-1;for(S=0;S<n.length;++S){const e=n[S];if(" "===e)E=!0;else{if("\n"!==e)break;k=S}}let P=n.substring(0,k<S?k+1:S);P&&(n=n.substring(P.length),P=P.replace(/\n+/g,`$&${m}`));let I=(E?m?"2":"1":"")+y;if(e&&(I+=" "+p(e.replace(/ ?[\r\n]+/g," ")),c&&c()),!g){const e=n.replace(/\n+/g,"\n$&").replace(/(?:^|\n)([\t ].*)(?:([\n\t ]*)\n(?![\n\t ]))?/g,"$1$2").replace(/\n+/g,`$&${m}`);let o=!1;const c=a(i,!0);"folded"!==h&&t!==s.Scalar.BLOCK_FOLDED&&(c.onOverflow=()=>{o=!0});const l=r.foldFlowLines(`${P}${e}${v}`,m,r.FOLD_BLOCK,c);if(!o)return`>${I}\n${m}${l}`}return`|${I}\n${m}${P}${n=n.replace(/\n+/g,`$&${m}`)}${v}`}t.stringifyString=function(e,t,n,u){const{implicitKey:h,inFlow:p}=t,f="string"==typeof e.value?e:Object.assign({},e,{value:String(e.value)});let{type:m}=e;m!==s.Scalar.QUOTE_DOUBLE&&/[\x00-\x08\x0b-\x1f\x7f-\x9f\u{D800}-\u{DFFF}]/u.test(f.value)&&(m=s.Scalar.QUOTE_DOUBLE);const g=e=>{switch(e){case s.Scalar.BLOCK_FOLDED:case s.Scalar.BLOCK_LITERAL:return h||p?l(f.value,t):d(f,t,n,u);case s.Scalar.QUOTE_DOUBLE:return i(f.value,t);case s.Scalar.QUOTE_SINGLE:return c(f.value,t);case s.Scalar.PLAIN:return function(e,t,n,i){const{type:c,value:u}=e,{actualString:h,implicitKey:p,indent:f,indentStep:m,inFlow:g}=t;if(p&&u.includes("\n")||g&&/[[\]{},]/.test(u))return l(u,t);if(/^[\n\t ,[\]{}#&*!|>'"%@`]|^[?-]$|^[?-][ \t]|[\n:][ \t]|[ \t]\n|[\n\t ]#|[\n\t :]$/.test(u))return p||g||!u.includes("\n")?l(u,t):d(e,t,n,i);if(!p&&!g&&c!==s.Scalar.PLAIN&&u.includes("\n"))return d(e,t,n,i);if(o(u)){if(""===f)return t.forceBlockIndent=!0,d(e,t,n,i);if(p&&f===m)return l(u,t)}const y=u.replace(/\n+/g,`$&\n${f}`);if(h){const e=e=>e.default&&"tag:yaml.org,2002:str"!==e.tag&&e.test?.test(y),{compat:n,tags:s}=t.doc.schema;if(s.some(e)||n?.some(e))return l(u,t)}return p?y:r.foldFlowLines(y,f,r.FOLD_FLOW,a(t,!1))}(f,t,n,u);default:return null}};let y=g(m);if(null===y){const{defaultKeyType:e,defaultStringType:n}=t.options,s=h&&e||n;if(y=g(s),null===y)throw new Error(`Unsupported default string type ${s}`)}return y}},7191:(e,t,n)=>{var s=n(9714),r=n(3144);const a={identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF)|\.nan|\.NaN|\.NAN)$/,resolve:e=>"nan"===e.slice(-3).toLowerCase()?NaN:"-"===e[0]?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:r.stringifyNumber},o={identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:[0-9][0-9_]*)?(?:\.[0-9_]*)?[eE][-+]?[0-9]+$/,resolve:e=>parseFloat(e.replace(/_/g,"")),stringify(e){const t=Number(e.value);return isFinite(t)?t.toExponential():r.stringifyNumber(e)}},i={identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:[0-9][0-9_]*)?\.[0-9_]*$/,resolve(e){const t=new s.Scalar(parseFloat(e.replace(/_/g,""))),n=e.indexOf(".");if(-1!==n){const s=e.substring(n+1).replace(/_/g,"");"0"===s[s.length-1]&&(t.minFractionDigits=s.length)}return t},stringify:r.stringifyNumber};t.float=i,t.floatExp=o,t.floatNaN=a},7434:(e,t,n)=>{var s=n(7902),r=n(1755),a=n(1386),o=n(9378),i=n(8644),c=n(8334);const l="All mapping items must start at the same column";t.resolveBlockMap=function({composeNode:e,composeEmptyNode:t},n,u,d,h){const p=new(h?.nodeClass??r.YAMLMap)(n.schema);n.atRoot&&(n.atRoot=!1);let f=u.offset,m=null;for(const r of u.items){const{start:h,key:g,sep:y,value:w}=r,v=a.resolveProps(h,{indicator:"explicit-key-ind",next:g??y?.[0],offset:f,onError:d,parentIndent:u.indent,startOnNewline:!0}),b=!v.found;if(b){if(g&&("block-seq"===g.type?d(f,"BLOCK_AS_IMPLICIT_KEY","A block sequence may not be used as an implicit map key"):"indent"in g&&g.indent!==u.indent&&d(f,"BAD_INDENT",l)),!v.anchor&&!v.tag&&!y){m=v.end,v.comment&&(p.comment?p.comment+="\n"+v.comment:p.comment=v.comment);continue}(v.newlineAfterProp||o.containsNewline(g))&&d(g??h[h.length-1],"MULTILINE_IMPLICIT_KEY","Implicit keys need to be on a single line")}else v.found?.indent!==u.indent&&d(f,"BAD_INDENT",l);n.atKey=!0;const S=v.end,E=g?e(n,g,v,d):t(n,S,h,null,v,d);n.schema.compat&&i.flowIndentCheck(u.indent,g,d),n.atKey=!1,c.mapIncludes(n,p.items,E)&&d(S,"DUPLICATE_KEY","Map keys must be unique");const k=a.resolveProps(y??[],{indicator:"map-value-ind",next:w,offset:E.range[2],onError:d,parentIndent:u.indent,startOnNewline:!g||"block-scalar"===g.type});if(f=k.end,k.found){b&&("block-map"!==w?.type||k.hasNewline||d(f,"BLOCK_AS_IMPLICIT_KEY","Nested mappings are not allowed in compact mappings"),n.options.strict&&v.start<k.found.offset-1024&&d(E.range,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit block mapping key"));const a=w?e(n,w,k,d):t(n,f,y,null,k,d);n.schema.compat&&i.flowIndentCheck(u.indent,w,d),f=a.range[2];const o=new s.Pair(E,a);n.options.keepSourceTokens&&(o.srcToken=r),p.items.push(o)}else{b&&d(E.range,"MISSING_CHAR","Implicit map keys need to be followed by map values"),k.comment&&(E.comment?E.comment+="\n"+k.comment:E.comment=k.comment);const e=new s.Pair(E);n.options.keepSourceTokens&&(e.srcToken=r),p.items.push(e)}}return m&&m<f&&d(m,"IMPOSSIBLE","Map comment with trailing content"),p.range=[u.offset,f,m??f],p}},7444:(e,t,n)=>{var s=n(932);t.debug=function(e,...t){"debug"===e&&console.log(...t)},t.warn=function(e,t){"debug"!==e&&"warn"!==e||("function"==typeof s.emitWarning?s.emitWarning(t):console.warn(t))}},7571:(e,t,n)=>{var s=n(9714),r=n(6845);function a(e){let t,n;try{t=new RegExp("(.*?)(?<![ \t])[ \t]*\r?\n","sy"),n=new RegExp("[ \t]*(.*?)(?:(?<![ \t])[ \t]*)?\r?\n","sy")}catch{t=/(.*?)[ \t]*\r?\n/sy,n=/[ \t]*(.*?)[ \t]*\r?\n/sy}let s=t.exec(e);if(!s)return e;let r=s[1],a=" ",o=t.lastIndex;for(n.lastIndex=o;s=n.exec(e);)""===s[1]?"\n"===a?r+=a:a="\n":(r+=a+s[1],a=" "),o=n.lastIndex;const i=/[ \t]*(.*)/sy;return i.lastIndex=o,s=i.exec(e),r+a+(s?.[1]??"")}function o(e,t){let n="",s=e[t+1];for(;!(" "!==s&&"\t"!==s&&"\n"!==s&&"\r"!==s||"\r"===s&&"\n"!==e[t+2]);)"\n"===s&&(n+="\n"),s=e[(t+=1)+1];return n||(n=" "),{fold:n,offset:t}}const i={0:"\0",a:"",b:"\b",e:"",f:"\f",n:"\n",r:"\r",t:"\t",v:"\v",N:"",_:" ",L:"\u2028",P:"\u2029"," ":" ",'"':'"',"/":"/","\\":"\\","\t":"\t"};function c(e,t,n,s){const r=e.substr(t,n),a=r.length===n&&/^[0-9a-fA-F]+$/.test(r)?parseInt(r,16):NaN;if(isNaN(a)){const r=e.substr(t-2,n+2);return s(t-2,"BAD_DQ_ESCAPE",`Invalid escape sequence ${r}`),r}return String.fromCodePoint(a)}t.resolveFlowScalar=function(e,t,n){const{offset:l,type:u,source:d,end:h}=e;let p,f;const m=(e,t,s)=>n(l+e,t,s);switch(u){case"scalar":p=s.Scalar.PLAIN,f=function(e,t){let n="";switch(e[0]){case"\t":n="a tab character";break;case",":n="flow indicator character ,";break;case"%":n="directive indicator character %";break;case"|":case">":n=`block scalar indicator ${e[0]}`;break;case"@":case"`":n=`reserved character ${e[0]}`}return n&&t(0,"BAD_SCALAR_START",`Plain value cannot start with ${n}`),a(e)}(d,m);break;case"single-quoted-scalar":p=s.Scalar.QUOTE_SINGLE,f=function(e,t){return"'"===e[e.length-1]&&1!==e.length||t(e.length,"MISSING_CHAR","Missing closing 'quote"),a(e.slice(1,-1)).replace(/''/g,"'")}(d,m);break;case"double-quoted-scalar":p=s.Scalar.QUOTE_DOUBLE,f=function(e,t){let n="";for(let s=1;s<e.length-1;++s){const r=e[s];if("\r"!==r||"\n"!==e[s+1])if("\n"===r){const{fold:t,offset:r}=o(e,s);n+=t,s=r}else if("\\"===r){let r=e[++s];const a=i[r];if(a)n+=a;else if("\n"===r)for(r=e[s+1];" "===r||"\t"===r;)r=e[1+ ++s];else if("\r"===r&&"\n"===e[s+1])for(r=e[1+ ++s];" "===r||"\t"===r;)r=e[1+ ++s];else if("x"===r||"u"===r||"U"===r){const a={x:2,u:4,U:8}[r];n+=c(e,s+1,a,t),s+=a}else{const r=e.substr(s-1,2);t(s-1,"BAD_DQ_ESCAPE",`Invalid escape sequence ${r}`),n+=r}}else if(" "===r||"\t"===r){const t=s;let a=e[s+1];for(;" "===a||"\t"===a;)a=e[1+ ++s];"\n"===a||"\r"===a&&"\n"===e[s+2]||(n+=s>t?e.slice(t,s+1):r)}else n+=r}return'"'===e[e.length-1]&&1!==e.length||t(e.length,"MISSING_CHAR",'Missing closing "quote'),n}(d,m);break;default:return n(e,"UNEXPECTED_TOKEN",`Expected a flow scalar value, but found: ${u}`),{value:"",type:null,comment:"",range:[l,l+d.length,l+d.length]}}const g=l+d.length,y=r.resolveEnd(h,g,t,n);return{value:f,type:p,comment:y.comment,range:[l,g,y.offset]}}},7808:(e,t)=>{function n(e){switch(e.type){case"block-scalar":{let t="";for(const s of e.props)t+=n(s);return t+e.source}case"block-map":case"block-seq":{let t="";for(const n of e.items)t+=s(n);return t}case"flow-collection":{let t=e.start.source;for(const n of e.items)t+=s(n);for(const n of e.end)t+=n.source;return t}case"document":{let t=s(e);if(e.end)for(const n of e.end)t+=n.source;return t}default:{let t=e.source;if("end"in e&&e.end)for(const n of e.end)t+=n.source;return t}}}function s({start:e,key:t,sep:s,value:r}){let a="";for(const t of e)a+=t.source;if(t&&(a+=n(t)),s)for(const e of s)a+=e.source;return r&&(a+=n(r)),a}t.stringify=e=>"type"in e?n(e):s(e)},7902:(e,t,n)=>{var s=n(5219),r=n(8017),a=n(5139),o=n(484);class i{constructor(e,t=null){Object.defineProperty(this,o.NODE_TYPE,{value:o.PAIR}),this.key=e,this.value=t}clone(e){let{key:t,value:n}=this;return o.isNode(t)&&(t=t.clone(e)),o.isNode(n)&&(n=n.clone(e)),new i(t,n)}toJSON(e,t){const n=t?.mapAsMap?new Map:{};return a.addPairToJSMap(t,n,this)}toString(e,t,n){return e?.doc?r.stringifyPair(this,e,t,n):JSON.stringify(this)}}t.Pair=i,t.createPair=function(e,t,n){const r=s.createNode(e,void 0,n),a=s.createNode(t,void 0,n);return new i(r,a)}},7917:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PromptImpl=t.VariableImpl=void 0;class n{constructor(e,t,n,s=""){this.id=e,this.name=t,this.description=n,this.defaultValue=s}serialize(){return{id:this.id,name:this.name,description:this.description,defaultValue:this.defaultValue}}static deserialize(e){return new n(e.id,e.name,e.description,e.defaultValue)}}t.VariableImpl=n;class s{constructor(e,t,n,s=[],r=new Date,a=0,o="",i=[]){this.id=e,this.title=t,this.template=n,this.variables=s,this.created=r,this.usageCount=a,this.category=o,this.tags=i}fillTemplate(e){let t=this.template;return this.variables.forEach((n=>{const s=e[n.name]||n.defaultValue,r=new RegExp(`{{\\s*${n.name}\\s*}}`,"g");t=t.replace(r,s)})),t}addVariable(e){this.variables.some((t=>t.name===e.name))||this.variables.push(e)}removeVariable(e){const t=this.variables.length;return this.variables=this.variables.filter((t=>t.id!==e)),this.variables.length!==t}incrementUsage(){this.usageCount+=1}serialize(){return{id:this.id,title:this.title,template:this.template,variables:this.variables.map((e=>e instanceof n?e.serialize():e)),created:this.created.toISOString(),usageCount:this.usageCount,category:this.category,tags:this.tags}}static deserialize(e){return new s(e.id,e.title,e.template,Array.isArray(e.variables)?e.variables.map((e=>n.deserialize(e))):[],new Date(e.created),e.usageCount||0,e.category||"",Array.isArray(e.tags)?e.tags:[])}static extractVariablesFromTemplate(e){const t=e.match(/{{(\s*[\w\d]+\s*)}}/g);return t?[...new Set(t.map((e=>e.replace(/{{|}}/g,"").trim())))]:[]}}t.PromptImpl=s},7946:function(e,t,n){var s,r=this&&this.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},s(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=s(e),o=0;o<n.length;o++)"default"!==n[o]&&r(t,e,n[o]);return a(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.PromptView=t.PromptTreeItem=void 0;const i=o(n(1398)),c=n(8272);class l extends i.TreeItem{constructor(e,t,n,s,r,a,o){super(e,t),this.label=e,this.collapsibleState=t,this.contextValue=n,this.id=s,this.iconPath=r,this.command=a,this.prompt=o,this.id=s,this.contextValue=n,this.iconPath=r,this.command=a,this.tooltip=e,o&&(this.description=o.category||"Uncategorized")}}t.PromptTreeItem=l,t.PromptView=class{constructor(e){this.context=e,this._onDidChangeTreeData=new i.EventEmitter,this.onDidChangeTreeData=this._onDidChangeTreeData.event,this.promptManager=c.PromptManager.getInstance()}refresh(){this._onDidChangeTreeData.fire()}getTreeItem(e){return e}async getChildren(e){if(!e){const e=await this.promptManager.getCategories(),t=[];if(t.push(new l("Popular Prompts",i.TreeItemCollapsibleState.Expanded,"popular","popular-prompts",new i.ThemeIcon("star-full"))),e.length>0){e.sort();for(const n of e)t.push(new l(n,i.TreeItemCollapsibleState.Collapsed,"category",`category-${n}`,new i.ThemeIcon("folder")))}return t.push(new l("Uncategorized",i.TreeItemCollapsibleState.Collapsed,"category","category-uncategorized",new i.ThemeIcon("list-unordered"))),t}if("popular"===e.contextValue){const e=await this.promptManager.getPopularPrompts(5);return 0===e.length?[new l("No prompts used yet",i.TreeItemCollapsibleState.None,"empty","no-popular-prompts",new i.ThemeIcon("info"))]:e.map((e=>new l(`${e.title} (${e.usageCount} uses)`,i.TreeItemCollapsibleState.None,"prompt",e.id,new i.ThemeIcon("file-text"),{command:"cursor-chat-manager.usePrompt",title:"Use Prompt",arguments:[e.id]},e)))}if("category"===e.contextValue){const t=e.id.replace("category-","");let n;return n="uncategorized"===t?(await this.promptManager.getPrompts()).filter((e=>!e.category||""===e.category.trim())):await this.promptManager.getPromptsByCategory(t),0===n.length?[new l("No prompts in this category",i.TreeItemCollapsibleState.None,"empty",`no-prompts-${t}`,new i.ThemeIcon("info"))]:(n.sort(((e,t)=>e.title.localeCompare(t.title))),n.map((e=>(e.variables.length,new l(e.title,i.TreeItemCollapsibleState.None,"prompt",e.id,new i.ThemeIcon("file-text"),{command:"cursor-chat-manager.usePrompt",title:"Use Prompt",arguments:[e.id]},e)))))}return[]}async previewPrompt(e){const t=await this.promptManager.getPromptById(e);t?i.window.createWebviewPanel("cursor-chat-manager.promptPreview",`Prompt: ${t.title}`,i.ViewColumn.One,{enableScripts:!0}).webview.html=this.getPromptHtml(t):i.window.showErrorMessage("Prompt not found")}getPromptHtml(e){const t=e.tags&&e.tags.length>0?e.tags.map((e=>`<span class="tag">${this.escapeHtml(e)}</span>`)).join(" "):'<span class="tag-empty">No tags</span>',n=e.variables.length>0?e.variables.map((e=>`\n          <div class="variable">\n            <div class="variable-name">{{${this.escapeHtml(e.name)}}}</div>\n            <div class="variable-description">${this.escapeHtml(e.description)}</div>\n            ${e.defaultValue?`<div class="variable-default">Default: ${this.escapeHtml(e.defaultValue)}</div>`:""}\n          </div>\n        `)).join(""):'<div class="variables-empty">No variables</div>';return`<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>Prompt: ${this.escapeHtml(e.title)}</title>\n    <style>\n        body {\n            font-family: var(--vscode-font-family);\n            color: var(--vscode-foreground);\n            background-color: var(--vscode-editor-background);\n            padding: 20px;\n            line-height: 1.5;\n        }\n        h1, h2 {\n            color: var(--vscode-editor-foreground);\n            border-bottom: 1px solid var(--vscode-panel-border);\n            padding-bottom: 10px;\n        }\n        .info {\n            background-color: var(--vscode-input-background);\n            border-left: 4px solid var(--vscode-focusBorder);\n            padding: 15px;\n            margin-bottom: 20px;\n        }\n        .tag {\n            background-color: var(--vscode-badge-background);\n            color: var(--vscode-badge-foreground);\n            padding: 3px 8px;\n            border-radius: 3px;\n            margin-right: 5px;\n            font-size: 12px;\n        }\n        .tag-empty, .variables-empty {\n            color: var(--vscode-disabledForeground);\n            font-style: italic;\n        }\n        .template {\n            background-color: var(--vscode-textBlockQuote-background);\n            padding: 15px;\n            border-radius: 4px;\n            overflow-x: auto;\n            white-space: pre-wrap;\n            font-family: var(--vscode-editor-font-family);\n            font-size: 14px;\n            margin-bottom: 20px;\n        }\n        .variable {\n            background-color: var(--vscode-input-background);\n            padding: 10px;\n            margin-bottom: 10px;\n            border-radius: 4px;\n        }\n        .variable-name {\n            font-weight: bold;\n            color: var(--vscode-editor-foreground);\n        }\n        .variable-description {\n            margin: 5px 0;\n        }\n        .variable-default {\n            font-style: italic;\n            color: var(--vscode-descriptionForeground);\n        }\n        .usage {\n            margin-top: 10px;\n            color: var(--vscode-descriptionForeground);\n            font-style: italic;\n        }\n    </style>\n</head>\n<body>\n    <h1>${this.escapeHtml(e.title)}</h1>\n    \n    <div class="info">\n        <p><strong>Category: </strong> ${this.escapeHtml(e.category||"Uncategorized")}</p>\n        <p><strong>Tags: </strong> ${t}</p>\n        <p><strong>Created: </strong> ${new Date(e.created).toLocaleString()}</p>\n        <p><strong>Usage Count: </strong> ${e.usageCount}</p>\n    </div>\n    \n    <h2>Template</h2>\n    <div class="template">${this.escapeHtml(e.template)}</div>\n    \n    <h2>Variables</h2>\n    <div class="variables">\n        ${n}\n    </div>\n    \n    <div class="usage">\n        <p>Use this prompt with the "Use Prompt" command in the context menu.</p>\n    </div>\n</body>\n</html>`}escapeHtml(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}}},7969:(e,t,n)=>{var s=n(9714);function r({value:e,source:t},n){return t&&(e?a:o).test.test(t)?t:e?n.options.trueStr:n.options.falseStr}const a={identify:e=>!0===e,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:Y|y|[Yy]es|YES|[Tt]rue|TRUE|[Oo]n|ON)$/,resolve:()=>new s.Scalar(!0),stringify:r},o={identify:e=>!1===e,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:N|n|[Nn]o|NO|[Ff]alse|FALSE|[Oo]ff|OFF)$/,resolve:()=>new s.Scalar(!1),stringify:r};t.falseTag=o,t.trueTag=a},8017:(e,t,n)=>{var s=n(484),r=n(9714),a=n(3793),o=n(248);t.stringifyPair=function({key:e,value:t},n,i,c){const{allNullValues:l,doc:u,indent:d,indentStep:h,options:{commentString:p,indentSeq:f,simpleKeys:m}}=n;let g=s.isNode(e)&&e.comment||null;if(m){if(g)throw new Error("With simple keys, key nodes cannot have comments");if(s.isCollection(e)||!s.isNode(e)&&"object"==typeof e)throw new Error("With simple keys, collection cannot be used as a key value")}let y=!m&&(!e||g&&null==t&&!n.inFlow||s.isCollection(e)||(s.isScalar(e)?e.type===r.Scalar.BLOCK_FOLDED||e.type===r.Scalar.BLOCK_LITERAL:"object"==typeof e));n=Object.assign({},n,{allNullValues:!1,implicitKey:!y&&(m||!l),indent:d+h});let w,v,b,S=!1,E=!1,k=a.stringify(e,n,(()=>S=!0),(()=>E=!0));if(!y&&!n.inFlow&&k.length>1024){if(m)throw new Error("With simple keys, single line scalar must not span more than 1024 characters");y=!0}if(n.inFlow){if(l||null==t)return S&&i&&i(),""===k?"?":y?`? ${k}`:k}else if(l&&!m||null==t&&y)return k=`? ${k}`,g&&!S?k+=o.lineComment(k,n.indent,p(g)):E&&c&&c(),k;S&&(g=null),y?(g&&(k+=o.lineComment(k,n.indent,p(g))),k=`? ${k}\n${d}:`):(k=`${k}:`,g&&(k+=o.lineComment(k,n.indent,p(g)))),s.isNode(t)?(w=!!t.spaceBefore,v=t.commentBefore,b=t.comment):(w=!1,v=null,b=null,t&&"object"==typeof t&&(t=u.createNode(t))),n.implicitKey=!1,y||g||!s.isScalar(t)||(n.indentAtStart=k.length+1),E=!1,f||!(h.length>=2)||n.inFlow||y||!s.isSeq(t)||t.flow||t.tag||t.anchor||(n.indent=n.indent.substring(2));let P=!1;const I=a.stringify(t,n,(()=>P=!0),(()=>E=!0));let T=" ";if(g||w||v){if(T=w?"\n":"",v){const e=p(v);T+=`\n${o.indentComment(e,n.indent)}`}""!==I||n.inFlow?T+=`\n${n.indent}`:"\n"===T&&(T="\n\n")}else if(!y&&s.isCollection(t)){const e=I[0],s=I.indexOf("\n"),r=-1!==s,a=n.inFlow??t.flow??0===t.items.length;if(r||!a){let t=!1;if(r&&("&"===e||"!"===e)){let n=I.indexOf(" ");"&"===e&&-1!==n&&n<s&&"!"===I[n+1]&&(n=I.indexOf(" ",n+1)),(-1===n||s<n)&&(t=!0)}t||(T=`\n${n.indent}`)}}else""!==I&&"\n"!==I[0]||(T="");return k+=T+I,n.inFlow?P&&i&&i():b&&!P?k+=o.lineComment(k,n.indent,p(b)):E&&c&&c(),k}},8080:(e,t,n)=>{var s=n(181),r=n(9714),a=n(7180);const o={identify:e=>e instanceof Uint8Array,default:!1,tag:"tag:yaml.org,2002:binary",resolve(e,t){if("function"==typeof s.Buffer)return s.Buffer.from(e,"base64");if("function"==typeof atob){const t=atob(e.replace(/[\n\r]/g,"")),n=new Uint8Array(t.length);for(let e=0;e<t.length;++e)n[e]=t.charCodeAt(e);return n}return t("This environment does not support reading binary tags; either Buffer or atob is required"),e},stringify({comment:e,type:t,value:n},o,i,c){if(!n)return"";const l=n;let u;if("function"==typeof s.Buffer)u=l instanceof s.Buffer?l.toString("base64"):s.Buffer.from(l.buffer).toString("base64");else{if("function"!=typeof btoa)throw new Error("This environment does not support writing binary tags; either Buffer or btoa is required");{let e="";for(let t=0;t<l.length;++t)e+=String.fromCharCode(l[t]);u=btoa(e)}}if(t??(t=r.Scalar.BLOCK_LITERAL),t!==r.Scalar.QUOTE_DOUBLE){const e=Math.max(o.options.lineWidth-o.indent.length,o.options.minContentWidth),n=Math.ceil(u.length/e),s=new Array(n);for(let t=0,r=0;t<n;++t,r+=e)s[t]=u.substr(r,e);u=s.join(t===r.Scalar.BLOCK_LITERAL?"\n":" ")}return a.stringifyString({comment:e,type:t,value:u},o,i,c)}};t.binary=o},8191:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ProjectOrganizer=t.OrganizationMode=void 0;const s=n(6899),r=n(3870),a=n(9561),o=n(1509),i=n(4009);var c;!function(e){e.COPY="copy",e.MOVE="move"}(c||(t.OrganizationMode=c={}));class l{constructor(){this.projects=new Map,this.originalProjects=new Map,this.customProjects=new Map,this.storageManager=i.StorageManager.getInstance()}static getInstance(){return l.instance||(l.instance=new l),l.instance}async initialize(e){this.projects=new Map,this.originalProjects=new Map,this.customProjects=new Map;const t=(await this.storageManager.getData("customProjects",[])||[]).map((e=>r.ProjectImpl.deserialize(e)));for(const n of[...e,...t]){const e=n instanceof r.ProjectImpl?n:new r.ProjectImpl(n.id,n.name,n.description,n.created,n.isCustom,n.chats,n.tags,n.metadata);this.projects.set(e.id,e),e.isCustom?this.customProjects.set(e.id,e):this.originalProjects.set(e.id,e)}}async saveState(){try{const e=Array.from(this.customProjects.values());await this.storageManager.saveData("customProjects",e.map((e=>e.serialize())))}catch(e){console.error(`Error saving project organizer state: ${e}`)}}async createCustomProject(e,t,n=[]){const s=`custom-${e.toLowerCase().replace(/\s+/g,"-")}-${Date.now()}`,a=new r.ProjectImpl(s,e,t,new Date,!0,[],n);return this.projects.set(s,a),this.customProjects.set(s,a),await this.saveState(),a}async updateProject(e,t){const n=this.projects.get(e);return!!n&&!!n.isCustom&&(t.name&&(n.name=t.name),t.description&&(n.description=t.description),t.tags&&(n.tags=[...t.tags]),await this.saveState(),!0)}async deleteCustomProject(e){return!!this.customProjects.has(e)&&(this.projects.delete(e),this.customProjects.delete(e),await this.saveState(),!0)}async organizeChatToProject(e,t,n,s){const r=this.projects.get(t),o=this.projects.get(n);if(!r||!o)return!1;const i=r.chats.find((t=>t.id===e));if(!i)return!1;if(s===c.COPY){const e=new a.ChatImpl(`${i.id}-copy-${Date.now()}`,i.title,i.timestamp,n,[...i.dialogues],[...i.tags],{...i.metadata,copiedFrom:i.id});o.addChat(e)}else r.removeChat(e),i.projectId=n,o.addChat(i);return await this.saveState(),!0}async extractDialogueToNewChat(e,t,n,r,o=[]){const i=this.projects.get(n);if(!i)return null;const c=i.chats.find((e=>e.id===t));if(!c)return null;const l=c.dialogues.find((t=>t.id===e));if(!l)return null;const u=new a.ChatImpl((0,s.v4)(),r||`Extracted from ${c.title}`,new Date,n,[l],o,{extractedFrom:t,extractedDialogue:e});return i.addChat(u),await this.saveState(),u.id}async extractDialogueToExistingChat(e,t,n){let s,r;for(const e of this.projects.values())if(s||(s=e.chats.find((e=>e.id===t))),r||(r=e.chats.find((e=>e.id===n))),s&&r)break;if(!s||!r)return!1;const i=s.dialogues.findIndex((t=>t.id===e));if(-1===i)return!1;const c=s.dialogues[i],l=new o.DialogueImpl(`${c.id}-copy-${Date.now()}`,r.id,c.content,c.isUser,c.timestamp,[...c.tags],c.metadata);return r instanceof a.ChatImpl?r.addDialogue(l):r.dialogues.push(l),await this.saveState(),!0}getProject(e){return this.projects.get(e)}getAllProjects(){return Array.from(this.projects.values())}getOriginalProjects(){return Array.from(this.originalProjects.values())}getCustomProjects(){return Array.from(this.customProjects.values())}async findProjectByChat(e){for(const t of this.projects.values())if(t.chats.some((t=>t.id===e)))return t}async findChatById(e){for(const t of this.projects.values()){const n=t.chats.find((t=>t.id===e));if(n)return n}}async findDialogueById(e){for(const t of this.projects.values())for(const n of t.chats){const s=n.dialogues.find((t=>t.id===e));if(s)return{dialogue:s,chat:n,project:t}}}}t.ProjectOrganizer=l},8272:function(e,t,n){var s,r=this&&this.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},s(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=s(e),o=0;o<n.length;o++)"default"!==n[o]&&r(t,e,n[o]);return a(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.PromptManager=void 0;const i=o(n(1398)),c=n(7917),l=n(4009);class u{constructor(){this.prompts=new Map,this.categories=new Set,this.initialized=!1,this.storageManager=l.StorageManager.getInstance()}static getInstance(){return u.instance||(u.instance=new u),u.instance}async initialize(){if(!this.initialized)try{const e=await this.storageManager.getData("prompts",[]),t=await this.storageManager.getData("promptCategories",[]);this.prompts=new Map,(e||[]).forEach((e=>{const t=c.PromptImpl.deserialize(e);this.prompts.set(t.id,t)})),this.categories=new Set(t||[]),this.prompts.forEach((e=>{e.category&&this.categories.add(e.category)})),this.initialized=!0}catch(e){throw console.error("Failed to initialize prompt manager:",e),new Error(`Prompt manager initialization failed: ${e}`)}}async getPrompts(){return await this.ensureInitialized(),Array.from(this.prompts.values())}async getPromptsByCategory(e){return await this.ensureInitialized(),Array.from(this.prompts.values()).filter((t=>t.category===e))}async getPromptsByTag(e){return await this.ensureInitialized(),Array.from(this.prompts.values()).filter((t=>t.tags.includes(e)))}async getPromptById(e){return await this.ensureInitialized(),this.prompts.get(e)}async getCategories(){return await this.ensureInitialized(),Array.from(this.categories)}async addCategory(e){await this.ensureInitialized(),e&&!this.categories.has(e)&&this.categories.add(e)}async getAllTags(){await this.ensureInitialized();const e=new Set;return this.prompts.forEach((t=>{t.tags.forEach((t=>e.add(t)))})),[...e]}async createPrompt(e,t,n="",s=[]){await this.ensureInitialized();const r=`prompt-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,a=c.PromptImpl.extractVariablesFromTemplate(t).map((e=>new c.VariableImpl(`var-${Date.now()}-${e}`,e,`Variable: ${e}`,""))),o=new c.PromptImpl(r,e,t,a,new Date,0,n,s);return this.prompts.set(r,o),n&&this.categories.add(n),await this.saveState(),o}async updatePrompt(e,t){await this.ensureInitialized();const n=this.prompts.get(e);if(!n)return!1;if(t.title&&(n.title=t.title),t.template){n.template=t.template;const e=c.PromptImpl.extractVariablesFromTemplate(t.template).map((e=>{const t=n.variables.find((t=>t.name===e));return t?t instanceof c.VariableImpl?t:new c.VariableImpl(t.id,t.name,t.description,t.defaultValue):new c.VariableImpl(`var-${Date.now()}-${e}`,e,`Variable: ${e}`,"")}));n.variables=e}return t.category&&(n.category=t.category,this.categories.add(t.category)),t.tags&&(n.tags=[...t.tags]),await this.saveState(),!0}async deletePrompt(e){return await this.ensureInitialized(),!!this.prompts.has(e)&&(this.prompts.delete(e),await this.saveState(),!0)}async fillPromptTemplate(e,t){await this.ensureInitialized();const n=this.prompts.get(e);return n&&"function"==typeof n.fillTemplate?("function"==typeof n.incrementUsage&&(n.incrementUsage(),await this.saveState()),n.fillTemplate(t)):null}async addVariableToPrompt(e,t){await this.ensureInitialized();const n=this.prompts.get(e);if(!n)return!1;const s=t instanceof c.VariableImpl?t:new c.VariableImpl(t.id,t.name,t.description,t.defaultValue);return"function"==typeof n.addVariable&&(n.addVariable(s),await this.saveState(),!0)}async removeVariableFromPrompt(e,t){await this.ensureInitialized();const n=this.prompts.get(e);if(!n||"function"!=typeof n.removeVariable)return!1;const s=n.removeVariable(t);return s&&await this.saveState(),s}async saveState(){try{const e=Array.from(this.prompts.values());await this.storageManager.saveData("prompts",e.map((e=>e.serialize()))),await this.storageManager.saveData("promptCategories",Array.from(this.categories))}catch(e){console.error(`Error saving prompt manager state: ${e}`)}}async exportPrompts(e,t){await this.ensureInitialized();try{const n=e.map((e=>this.prompts.get(e))).filter((e=>!!e)).map((e=>"function"==typeof e.serialize?e.serialize():e));if(0===n.length)return!1;const s={version:1,prompts:n};return await i.workspace.fs.writeFile(i.Uri.file(t),Buffer.from(JSON.stringify(s,null,2),"utf8")),!0}catch(e){return console.error("Failed to export prompts:",e),!1}}async importPrompts(e){await this.ensureInitialized();try{const t=await i.workspace.fs.readFile(i.Uri.file(e)),n=JSON.parse(t.toString());if(!n||!Array.isArray(n.prompts))throw new Error("Invalid prompt file format");let s=0;for(const e of n.prompts)try{const t=c.PromptImpl.deserialize(e);t.id=`prompt-${Date.now()}-${s}`,this.prompts.set(t.id,t),t.category&&this.categories.add(t.category),s++}catch(e){console.error("Error importing prompt:",e)}return s>0&&await this.saveState(),s}catch(e){throw console.error("Failed to import prompts:",e),new Error(`Prompt import failed: ${e}`)}}async getPopularPrompts(e=5){return await this.ensureInitialized(),Array.from(this.prompts.values()).sort(((e,t)=>t.usageCount-e.usageCount)).slice(0,e)}async ensureInitialized(){this.initialized||await this.initialize()}}t.PromptManager=u},8334:(e,t,n)=>{var s=n(484);t.mapIncludes=function(e,t,n){const{uniqueKeys:r}=e.options;if(!1===r)return!1;const a="function"==typeof r?r:(e,t)=>e===t||s.isScalar(e)&&s.isScalar(t)&&e.value===t.value;return t.some((e=>a(e.key,n)))}},8416:(e,t,n)=>{var s=n(484),r=n(7902),a=n(9714),o=n(6010);function i(e,t){if(s.isSeq(e))for(let n=0;n<e.items.length;++n){let o=e.items[n];if(!s.isPair(o)){if(s.isMap(o)){o.items.length>1&&t("Each pair must have its own sequence indicator");const e=o.items[0]||new r.Pair(new a.Scalar(null));if(o.commentBefore&&(e.key.commentBefore=e.key.commentBefore?`${o.commentBefore}\n${e.key.commentBefore}`:o.commentBefore),o.comment){const t=e.value??e.key;t.comment=t.comment?`${o.comment}\n${t.comment}`:o.comment}o=e}e.items[n]=s.isPair(o)?o:new r.Pair(o)}}else t("Expected a sequence for this tag");return e}function c(e,t,n){const{replacer:s}=n,a=new o.YAMLSeq(e);a.tag="tag:yaml.org,2002:pairs";let i=0;if(t&&Symbol.iterator in Object(t))for(let e of t){let o,c;if("function"==typeof s&&(e=s.call(t,String(i++),e)),Array.isArray(e)){if(2!==e.length)throw new TypeError(`Expected [key, value] tuple: ${e}`);o=e[0],c=e[1]}else if(e&&e instanceof Object){const t=Object.keys(e);if(1!==t.length)throw new TypeError(`Expected tuple with one key, not ${t.length} keys`);o=t[0],c=e[o]}else o=e;a.items.push(r.createPair(o,c,n))}return a}const l={collection:"seq",default:!1,tag:"tag:yaml.org,2002:pairs",resolve:i,createNode:c};t.createPairs=c,t.pairs=l,t.resolvePairs=i},8523:(e,t,n)=>{var s=n(3334),r=n(6055),a=n(1919),o=n(8531),i=n(5132),c=n(988),l=n(2891);const u=[s.map,a.seq,o.string,r.nullTag,i.boolTag,l.intOct,l.int,l.intHex,c.floatNaN,c.floatExp,c.float];t.schema=u},8531:(e,t,n)=>{var s=n(7180);const r={identify:e=>"string"==typeof e,default:!0,tag:"tag:yaml.org,2002:str",resolve:e=>e,stringify:(e,t,n,r)=>(t=Object.assign({actualString:!0},t),s.stringifyString(e,t,n,r))};t.string=r},8644:(e,t,n)=>{var s=n(9378);t.flowIndentCheck=function(e,t,n){if("flow-collection"===t?.type){const r=t.end[0];r.indent!==e||"]"!==r.source&&"}"!==r.source||!s.containsNewline(t)||n(r,"BAD_INDENT","Flow end indicator should be more indented than parent",!0)}}},8673:(e,t,n)=>{var s=n(484),r=n(9125);const a={"!":"%21",",":"%2C","[":"%5B","]":"%5D","{":"%7B","}":"%7D"};class o{constructor(e,t){this.docStart=null,this.docEnd=!1,this.yaml=Object.assign({},o.defaultYaml,e),this.tags=Object.assign({},o.defaultTags,t)}clone(){const e=new o(this.yaml,this.tags);return e.docStart=this.docStart,e}atDocument(){const e=new o(this.yaml,this.tags);switch(this.yaml.version){case"1.1":this.atNextDocument=!0;break;case"1.2":this.atNextDocument=!1,this.yaml={explicit:o.defaultYaml.explicit,version:"1.2"},this.tags=Object.assign({},o.defaultTags)}return e}add(e,t){this.atNextDocument&&(this.yaml={explicit:o.defaultYaml.explicit,version:"1.1"},this.tags=Object.assign({},o.defaultTags),this.atNextDocument=!1);const n=e.trim().split(/[ \t]+/),s=n.shift();switch(s){case"%TAG":{if(2!==n.length&&(t(0,"%TAG directive should contain exactly two parts"),n.length<2))return!1;const[e,s]=n;return this.tags[e]=s,!0}case"%YAML":{if(this.yaml.explicit=!0,1!==n.length)return t(0,"%YAML directive should contain exactly one part"),!1;const[e]=n;return"1.1"===e||"1.2"===e?(this.yaml.version=e,!0):(t(6,`Unsupported YAML version ${e}`,/^\d+\.\d+$/.test(e)),!1)}default:return t(0,`Unknown directive ${s}`,!0),!1}}tagName(e,t){if("!"===e)return"!";if("!"!==e[0])return t(`Not a valid tag: ${e}`),null;if("<"===e[1]){const n=e.slice(2,-1);return"!"===n||"!!"===n?(t(`Verbatim tags aren't resolved, so ${e} is invalid.`),null):(">"!==e[e.length-1]&&t("Verbatim tags must end with a >"),n)}const[,n,s]=e.match(/^(.*!)([^!]*)$/s);s||t(`The ${e} tag has no suffix`);const r=this.tags[n];if(r)try{return r+decodeURIComponent(s)}catch(e){return t(String(e)),null}return"!"===n?e:(t(`Could not resolve tag: ${e}`),null)}tagString(e){for(const[t,n]of Object.entries(this.tags))if(e.startsWith(n))return t+e.substring(n.length).replace(/[!,[\]{}]/g,(e=>a[e]));return"!"===e[0]?e:`!<${e}>`}toString(e){const t=this.yaml.explicit?[`%YAML ${this.yaml.version||"1.2"}`]:[],n=Object.entries(this.tags);let a;if(e&&n.length>0&&s.isNode(e.contents)){const t={};r.visit(e.contents,((e,n)=>{s.isNode(n)&&n.tag&&(t[n.tag]=!0)})),a=Object.keys(t)}else a=[];for(const[s,r]of n)"!!"===s&&"tag:yaml.org,2002:"===r||e&&!a.some((e=>e.startsWith(r)))||t.push(`%TAG ${s} ${r}`);return t.join("\n")}}o.defaultYaml={explicit:!1,version:"1.2"},o.defaultTags={"!!":"tag:yaml.org,2002:"},t.Directives=o},8763:function(e,t,n){var s,r=this&&this.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},s(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=s(e),o=0;o<n.length;o++)"default"!==n[o]&&r(t,e,n[o]);return a(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.registerExportCommands=function(e){const t=i.commands.registerCommand("cursor-chat-manager.exportChats",(async()=>{c.ExportView.createOrShow(e)}));e.subscriptions.push(t)};const i=o(n(1398)),c=n(7050)},8898:(e,t,n)=>{var s=n(6906),r=n(484),a=n(3732);t.NodeBase=class{constructor(e){Object.defineProperty(this,r.NODE_TYPE,{value:e})}clone(){const e=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return this.range&&(e.range=this.range.slice()),e}toJS(e,{mapAsMap:t,maxAliasCount:n,onAnchor:o,reviver:i}={}){if(!r.isDocument(e))throw new TypeError("A document argument is required");const c={anchors:new Map,doc:e,keep:!0,mapAsMap:!0===t,mapKeyWarned:!1,maxAliasCount:"number"==typeof n?n:100},l=a.toJS(this,"",c);if("function"==typeof o)for(const{count:e,res:t}of c.anchors.values())o(t,e);return"function"==typeof i?s.applyReviver(i,{"":l},"",l):l}}},9046:(e,t,n)=>{var s=n(1736),r=n(1614),a=n(484),o=n(7902),i=n(3732),c=n(625),l=n(1768),u=n(6261),d=n(6906),h=n(5219),p=n(8673);class f{constructor(e,t,n){this.commentBefore=null,this.comment=null,this.errors=[],this.warnings=[],Object.defineProperty(this,a.NODE_TYPE,{value:a.DOC});let s=null;"function"==typeof t||Array.isArray(t)?s=t:void 0===n&&t&&(n=t,t=void 0);const r=Object.assign({intAsBigInt:!1,keepSourceTokens:!1,logLevel:"warn",prettyErrors:!0,strict:!0,stringKeys:!1,uniqueKeys:!0,version:"1.2"},n);this.options=r;let{version:o}=r;n?._directives?(this.directives=n._directives.atDocument(),this.directives.yaml.explicit&&(o=this.directives.yaml.version)):this.directives=new p.Directives({version:o}),this.setSchema(o,n),this.contents=void 0===e?null:this.createNode(e,s,n)}clone(){const e=Object.create(f.prototype,{[a.NODE_TYPE]:{value:a.DOC}});return e.commentBefore=this.commentBefore,e.comment=this.comment,e.errors=this.errors.slice(),e.warnings=this.warnings.slice(),e.options=Object.assign({},this.options),this.directives&&(e.directives=this.directives.clone()),e.schema=this.schema.clone(),e.contents=a.isNode(this.contents)?this.contents.clone(e.schema):this.contents,this.range&&(e.range=this.range.slice()),e}add(e){m(this.contents)&&this.contents.add(e)}addIn(e,t){m(this.contents)&&this.contents.addIn(e,t)}createAlias(e,t){if(!e.anchor){const n=u.anchorNames(this);e.anchor=!t||n.has(t)?u.findNewAnchor(t||"a",n):t}return new s.Alias(e.anchor)}createNode(e,t,n){let s;if("function"==typeof t)e=t.call({"":e},"",e),s=t;else if(Array.isArray(t)){const e=e=>"number"==typeof e||e instanceof String||e instanceof Number,n=t.filter(e).map(String);n.length>0&&(t=t.concat(n)),s=t}else void 0===n&&t&&(n=t,t=void 0);const{aliasDuplicateObjects:r,anchorPrefix:o,flow:i,keepUndefined:c,onTagObj:l,tag:d}=n??{},{onAnchor:p,setAnchors:f,sourceObjects:m}=u.createNodeAnchors(this,o||"a"),g={aliasDuplicateObjects:r??!0,keepUndefined:c??!1,onAnchor:p,onTagObj:l,replacer:s,schema:this.schema,sourceObjects:m},y=h.createNode(e,d,g);return i&&a.isCollection(y)&&(y.flow=!0),f(),y}createPair(e,t,n={}){const s=this.createNode(e,null,n),r=this.createNode(t,null,n);return new o.Pair(s,r)}delete(e){return!!m(this.contents)&&this.contents.delete(e)}deleteIn(e){return r.isEmptyPath(e)?null!=this.contents&&(this.contents=null,!0):!!m(this.contents)&&this.contents.deleteIn(e)}get(e,t){return a.isCollection(this.contents)?this.contents.get(e,t):void 0}getIn(e,t){return r.isEmptyPath(e)?!t&&a.isScalar(this.contents)?this.contents.value:this.contents:a.isCollection(this.contents)?this.contents.getIn(e,t):void 0}has(e){return!!a.isCollection(this.contents)&&this.contents.has(e)}hasIn(e){return r.isEmptyPath(e)?void 0!==this.contents:!!a.isCollection(this.contents)&&this.contents.hasIn(e)}set(e,t){null==this.contents?this.contents=r.collectionFromPath(this.schema,[e],t):m(this.contents)&&this.contents.set(e,t)}setIn(e,t){r.isEmptyPath(e)?this.contents=t:null==this.contents?this.contents=r.collectionFromPath(this.schema,Array.from(e),t):m(this.contents)&&this.contents.setIn(e,t)}setSchema(e,t={}){let n;switch("number"==typeof e&&(e=String(e)),e){case"1.1":this.directives?this.directives.yaml.version="1.1":this.directives=new p.Directives({version:"1.1"}),n={resolveKnownTags:!1,schema:"yaml-1.1"};break;case"1.2":case"next":this.directives?this.directives.yaml.version=e:this.directives=new p.Directives({version:e}),n={resolveKnownTags:!0,schema:"core"};break;case null:this.directives&&delete this.directives,n=null;break;default:{const t=JSON.stringify(e);throw new Error(`Expected '1.1', '1.2' or null as first argument, but found: ${t}`)}}if(t.schema instanceof Object)this.schema=t.schema;else{if(!n)throw new Error("With a null YAML version, the { schema: Schema } option is required");this.schema=new c.Schema(Object.assign(n,t))}}toJS({json:e,jsonArg:t,mapAsMap:n,maxAliasCount:s,onAnchor:r,reviver:a}={}){const o={anchors:new Map,doc:this,keep:!e,mapAsMap:!0===n,mapKeyWarned:!1,maxAliasCount:"number"==typeof s?s:100},c=i.toJS(this.contents,t??"",o);if("function"==typeof r)for(const{count:e,res:t}of o.anchors.values())r(t,e);return"function"==typeof a?d.applyReviver(a,{"":c},"",c):c}toJSON(e,t){return this.toJS({json:!0,jsonArg:e,mapAsMap:!1,onAnchor:t})}toString(e={}){if(this.errors.length>0)throw new Error("Document with errors cannot be stringified");if("indent"in e&&(!Number.isInteger(e.indent)||Number(e.indent)<=0)){const t=JSON.stringify(e.indent);throw new Error(`"indent" option must be a positive integer, not ${t}`)}return l.stringifyDocument(this,e)}}function m(e){if(a.isCollection(e))return!0;throw new Error("Expected a YAML collection as document contents")}t.Document=f},9094:(e,t,n)=>{var s=n(484),r=n(9714),a=n(4070),o=n(7571);t.composeScalar=function(e,t,n,i){const{value:c,type:l,comment:u,range:d}="block-scalar"===t.type?a.resolveBlockScalar(e,t,i):o.resolveFlowScalar(t,e.options.strict,i),h=n?e.directives.tagName(n.source,(e=>i(n,"TAG_RESOLVE_FAILED",e))):null;let p,f;p=e.options.stringKeys&&e.atKey?e.schema[s.SCALAR]:h?function(e,t,n,r,a){if("!"===n)return e[s.SCALAR];const o=[];for(const t of e.tags)if(!t.collection&&t.tag===n){if(!t.default||!t.test)return t;o.push(t)}for(const e of o)if(e.test?.test(t))return e;const i=e.knownTags[n];return i&&!i.collection?(e.tags.push(Object.assign({},i,{default:!1,test:void 0})),i):(a(r,"TAG_RESOLVE_FAILED",`Unresolved tag: ${n}`,"tag:yaml.org,2002:str"!==n),e[s.SCALAR])}(e.schema,c,h,n,i):"scalar"===t.type?function({atKey:e,directives:t,schema:n},r,a,o){const i=n.tags.find((t=>(!0===t.default||e&&"key"===t.default)&&t.test?.test(r)))||n[s.SCALAR];if(n.compat){const e=n.compat.find((e=>e.default&&e.test?.test(r)))??n[s.SCALAR];i.tag!==e.tag&&o(a,"TAG_RESOLVE_FAILED",`Value may be parsed as either ${t.tagString(i.tag)} or ${t.tagString(e.tag)}`,!0)}return i}(e,c,t,i):e.schema[s.SCALAR];try{const a=p.resolve(c,(e=>i(n??t,"TAG_RESOLVE_FAILED",e)),e.options);f=s.isScalar(a)?a:new r.Scalar(a)}catch(e){const s=e instanceof Error?e.message:String(e);i(n??t,"TAG_RESOLVE_FAILED",s),f=new r.Scalar(c)}return f.range=d,f.source=c,l&&(f.type=l),h&&(f.tag=h),p.format&&(f.format=p.format),u&&(f.comment=u),f}},9112:(e,t,n)=>{var s=n(5141),r=n(7808),a=n(5970);t.createScalarToken=s.createScalarToken,t.resolveAsScalar=s.resolveAsScalar,t.setScalarValue=s.setScalarValue,t.stringify=r.stringify,t.visit=a.visit,t.BOM="\ufeff",t.DOCUMENT="",t.FLOW_END="",t.SCALAR="",t.isCollection=e=>!!e&&"items"in e,t.isScalar=e=>!!e&&("scalar"===e.type||"single-quoted-scalar"===e.type||"double-quoted-scalar"===e.type||"block-scalar"===e.type),t.prettyToken=function(e){switch(e){case"\ufeff":return"<BOM>";case"":return"<DOC>";case"":return"<FLOW_END>";case"":return"<SCALAR>";default:return JSON.stringify(e)}},t.tokenType=function(e){switch(e){case"\ufeff":return"byte-order-mark";case"":return"doc-mode";case"":return"flow-error-end";case"":return"scalar";case"---":return"doc-start";case"...":return"doc-end";case"":case"\n":case"\r\n":return"newline";case"-":return"seq-item-ind";case"?":return"explicit-key-ind";case":":return"map-value-ind";case"{":return"flow-map-start";case"}":return"flow-map-end";case"[":return"flow-seq-start";case"]":return"flow-seq-end";case",":return"comma"}switch(e[0]){case" ":case"\t":return"space";case"#":return"comment";case"%":return"directive-line";case"*":return"alias";case"&":return"anchor";case"!":return"tag";case"'":return"single-quoted-scalar";case'"':return"double-quoted-scalar";case"|":case">":return"block-scalar-header"}return null}},9125:(e,t,n)=>{var s=n(484);const r=Symbol("break visit"),a=Symbol("skip children"),o=Symbol("remove node");function i(e,t){const n=d(t);s.isDocument(e)?c(null,e.contents,n,Object.freeze([e]))===o&&(e.contents=null):c(null,e,n,Object.freeze([]))}function c(e,t,n,a){const i=h(e,t,n,a);if(s.isNode(i)||s.isPair(i))return p(e,a,i),c(e,i,n,a);if("symbol"!=typeof i)if(s.isCollection(t)){a=Object.freeze(a.concat(t));for(let e=0;e<t.items.length;++e){const s=c(e,t.items[e],n,a);if("number"==typeof s)e=s-1;else{if(s===r)return r;s===o&&(t.items.splice(e,1),e-=1)}}}else if(s.isPair(t)){a=Object.freeze(a.concat(t));const e=c("key",t.key,n,a);if(e===r)return r;e===o&&(t.key=null);const s=c("value",t.value,n,a);if(s===r)return r;s===o&&(t.value=null)}return i}async function l(e,t){const n=d(t);s.isDocument(e)?await u(null,e.contents,n,Object.freeze([e]))===o&&(e.contents=null):await u(null,e,n,Object.freeze([]))}async function u(e,t,n,a){const i=await h(e,t,n,a);if(s.isNode(i)||s.isPair(i))return p(e,a,i),u(e,i,n,a);if("symbol"!=typeof i)if(s.isCollection(t)){a=Object.freeze(a.concat(t));for(let e=0;e<t.items.length;++e){const s=await u(e,t.items[e],n,a);if("number"==typeof s)e=s-1;else{if(s===r)return r;s===o&&(t.items.splice(e,1),e-=1)}}}else if(s.isPair(t)){a=Object.freeze(a.concat(t));const e=await u("key",t.key,n,a);if(e===r)return r;e===o&&(t.key=null);const s=await u("value",t.value,n,a);if(s===r)return r;s===o&&(t.value=null)}return i}function d(e){return"object"==typeof e&&(e.Collection||e.Node||e.Value)?Object.assign({Alias:e.Node,Map:e.Node,Scalar:e.Node,Seq:e.Node},e.Value&&{Map:e.Value,Scalar:e.Value,Seq:e.Value},e.Collection&&{Map:e.Collection,Seq:e.Collection},e):e}function h(e,t,n,r){return"function"==typeof n?n(e,t,r):s.isMap(t)?n.Map?.(e,t,r):s.isSeq(t)?n.Seq?.(e,t,r):s.isPair(t)?n.Pair?.(e,t,r):s.isScalar(t)?n.Scalar?.(e,t,r):s.isAlias(t)?n.Alias?.(e,t,r):void 0}function p(e,t,n){const r=t[t.length-1];if(s.isCollection(r))r.items[e]=n;else if(s.isPair(r))"key"===e?r.key=n:r.value=n;else{if(!s.isDocument(r)){const e=s.isAlias(r)?"alias":"scalar";throw new Error(`Cannot replace node with ${e} parent`)}r.contents=n}}i.BREAK=r,i.SKIP=a,i.REMOVE=o,l.BREAK=r,l.SKIP=a,l.REMOVE=o,t.visit=i,t.visitAsync=l},9240:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RuleManager=void 0;const s=n(5953),r=n(4009);class a{constructor(){this.globalRules=[],this.projectRules=new Map,this.initialized=!1,this.storageManager=r.StorageManager.getInstance()}static getInstance(){return a.instance||(a.instance=new a),a.instance}async initialize(){if(!this.initialized)try{const e=await this.storageManager.getData("globalRules",[]);this.globalRules=(e||[]).map((e=>s.RuleImpl.deserialize(e)));const t=await this.storageManager.getData("projectRules",{});this.projectRules=new Map,Object.entries(t||{}).forEach((([e,t])=>{const n=t.map((e=>s.RuleImpl.deserialize(e)));this.projectRules.set(e,n)})),this.initialized=!0}catch(e){throw console.error("Failed to initialize rule manager:",e),new Error(`Rule manager initialization failed: ${e}`)}}async getGlobalRules(){return await this.ensureInitialized(),[...this.globalRules]}async getProjectRules(e){return await this.ensureInitialized(),this.projectRules.get(e)||[]}async getRuleById(e){await this.ensureInitialized();const t=this.globalRules.find((t=>t.id===e));if(t)return t;for(const t of this.projectRules.values()){const n=t.find((t=>t.id===e));if(n)return n}}async getAllRules(){await this.ensureInitialized();const e=[...this.globalRules];for(const t of this.projectRules.values())e.push(...t);return e}async importRuleFromFile(e){await this.ensureInitialized();try{const t=await s.RuleImpl.fromMDCFile(e);return this.globalRules.push(t),await this.saveState(),t}catch(e){throw console.error("Failed to import rule from file:",e),new Error(`Rule import failed: ${e}`)}}async applyRuleToProject(e,t){await this.ensureInitialized();const n=await this.getRuleById(e);if(!n)throw new Error(`Rule with ID ${e} not found`);const s=n.applyToProject(t);if(s){const s=this.projectRules.get(t)||[];s.some((t=>t.id===e))||(s.push(n),this.projectRules.set(t,s)),await this.saveState()}return s}async saveState(){await this.ensureInitialized();try{await this.storageManager.saveData("globalRules",this.globalRules.map((e=>e.serialize())));const e={};this.projectRules.forEach(((t,n)=>{e[n]=t.map((e=>e.serialize()))})),await this.storageManager.saveData("projectRules",e)}catch(e){console.error(`Error saving rule manager state: ${e}`)}}async deleteRule(e){await this.ensureInitialized();const t=this.globalRules.findIndex((t=>t.id===e));if(t>=0)return this.globalRules.splice(t,1),await this.saveState(),!0;let n=!1;for(const[t,s]of this.projectRules.entries()){const r=s.findIndex((t=>t.id===e));r>=0&&(s.splice(r,1),this.projectRules.set(t,s),n=!0)}return!!n&&(await this.saveState(),!0)}async makeRuleGlobal(e){if(await this.ensureInitialized(),this.globalRules.some((t=>t.id===e)))return!0;let t,n;for(const[s,r]of this.projectRules.entries()){const a=r.find((t=>t.id===e));if(a){t=a,n=s;break}}if(t&&n){const s=this.projectRules.get(n)||[];return this.projectRules.set(n,s.filter((t=>t.id!==e))),t.isGlobal=!0,this.globalRules.push(t),await this.saveState(),!0}return!1}async exportRuleToFile(e,t){await this.ensureInitialized();const n=await this.getRuleById(e);if(!n)throw new Error(`Rule with ID ${e} not found`);if(n instanceof s.RuleImpl&&n.exportToFile)return await n.exportToFile(t);if(n.exportToFile)return await n.exportToFile(t);throw new Error("Rule doesn't support export functionality")}async findRulesByTag(e){return await this.ensureInitialized(),(await this.getAllRules()).filter((t=>t.tags.includes(e)))}async getRuleCategories(){await this.ensureInitialized();const e=await this.getAllRules(),t=new Set;return e.forEach((e=>{e.tags.forEach((e=>t.add(e)))})),[...t]}async createRuleFromDialogue(e,t,n="",r=[]){await this.ensureInitialized();const a=new s.RuleImpl(`rule-${Date.now()}`,t,n,e,!1,r,{},[]);return await this.saveState(),a}async ensureInitialized(){this.initialized||await this.initialize()}}t.RuleManager=a},9378:(e,t)=>{t.containsNewline=function e(t){if(!t)return null;switch(t.type){case"alias":case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":if(t.source.includes("\n"))return!0;if(t.end)for(const e of t.end)if("newline"===e.type)return!0;return!1;case"flow-collection":for(const n of t.items){for(const e of n.start)if("newline"===e.type)return!0;if(n.sep)for(const e of n.sep)if("newline"===e.type)return!0;if(e(n.key)||e(n.value))return!0}return!1;default:return!0}}},9561:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChatImpl=void 0;const s=n(1509);class r{constructor(e,t,n,s,r=[],a=[],o){this.id=e,this.title=t,this.timestamp=n,this.projectId=s,this.dialogues=r,this.tags=a,this.metadata=o}addDialogue(e){e.chatId=this.id,this.dialogues.push(e)}removeDialogue(e){const t=this.dialogues.length;return this.dialogues=this.dialogues.filter((t=>t.id!==e)),this.dialogues.length!==t}addTag(e){this.tags.includes(e)||this.tags.push(e)}removeTag(e){const t=this.tags.length;return this.tags=this.tags.filter((t=>t!==e)),this.tags.length!==t}serialize(){return{id:this.id,title:this.title,timestamp:this.timestamp.toISOString(),projectId:this.projectId,dialogues:this.dialogues.map((e=>e instanceof s.DialogueImpl?e.serialize():e)),tags:this.tags,metadata:this.metadata}}static deserialize(e){return new r(e.id,e.title,new Date(e.timestamp),e.projectId,Array.isArray(e.dialogues)?e.dialogues:[],Array.isArray(e.tags)?e.tags:[],e.metadata)}}t.ChatImpl=r},9637:(e,t,n)=>{var s=n(484),r=n(9714);const a="<<",o={identify:e=>e===a||"symbol"==typeof e&&e.description===a,default:"key",tag:"tag:yaml.org,2002:merge",test:/^<<$/,resolve:()=>Object.assign(new r.Scalar(Symbol(a)),{addToJSMap:i}),stringify:()=>a};function i(e,t,n){if(n=e&&s.isAlias(n)?n.resolve(e.doc):n,s.isSeq(n))for(const s of n.items)c(e,t,s);else if(Array.isArray(n))for(const s of n)c(e,t,s);else c(e,t,n)}function c(e,t,n){const r=e&&s.isAlias(n)?n.resolve(e.doc):n;if(!s.isMap(r))throw new Error("Merge sources must be maps or map aliases");const a=r.toJSON(null,e,Map);for(const[e,n]of a)t instanceof Map?t.has(e)||t.set(e,n):t instanceof Set?t.add(e):Object.prototype.hasOwnProperty.call(t,e)||Object.defineProperty(t,e,{value:n,writable:!0,enumerable:!0,configurable:!0});return t}t.addMergeToJSMap=i,t.isMergeKey=(e,t)=>(o.identify(t)||s.isScalar(t)&&(!t.type||t.type===r.Scalar.PLAIN)&&o.identify(t.value))&&e?.doc.schema.tags.some((e=>e.tag===o.tag&&e.default)),t.merge=o},9714:(e,t,n)=>{var s=n(484),r=n(8898),a=n(3732);class o extends r.NodeBase{constructor(e){super(s.SCALAR),this.value=e}toJSON(e,t){return t?.keep?this.value:a.toJS(this.value,e,t)}toString(){return String(this.value)}}o.BLOCK_FOLDED="BLOCK_FOLDED",o.BLOCK_LITERAL="BLOCK_LITERAL",o.PLAIN="PLAIN",o.QUOTE_DOUBLE="QUOTE_DOUBLE",o.QUOTE_SINGLE="QUOTE_SINGLE",t.Scalar=o,t.isScalarValue=e=>!e||"function"!=typeof e&&"object"!=typeof e},9838:function(e,t,n){var s,r=this&&this.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},s(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=s(e),o=0;o<n.length;o++)"default"!==n[o]&&r(t,e,n[o]);return a(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.CursorDataProvider=void 0;const i=o(n(9896)),c=o(n(6928)),l=o(n(857)),u=n(7109);class d{constructor(){this.cursorStoragePath=null,this.databaseService=new u.DatabaseService,this.initializeStoragePath()}static getInstance(){return d.instance||(d.instance=new d),d.instance}initializeStoragePath(){const e=l.platform();switch(e){case"win32":this.cursorStoragePath=c.join(process.env.APPDATA||"","Cursor","User","workspaceStorage");break;case"darwin":this.cursorStoragePath=c.join(l.homedir(),"Library","Application Support","Cursor","User","workspaceStorage");break;case"linux":this.cursorStoragePath=c.join(l.homedir(),".config","Cursor","User","workspaceStorage");break;default:console.error(`Unsupported OS: ${e}`),this.cursorStoragePath=null}}async findWorkspaceStorageFolders(){if(!this.cursorStoragePath)return console.error("Cursor storage path not initialized"),[];try{if(!i.existsSync(this.cursorStoragePath))return console.error(`Cursor storage path not found: ${this.cursorStoragePath}`),[];return i.readdirSync(this.cursorStoragePath).map((e=>c.join(this.cursorStoragePath,e))).filter((e=>i.existsSync(c.join(e,"state.vscdb"))))}catch(e){return console.error(`Error finding workspace folders: ${e}`),[]}}async getChatData(){const e=await this.findWorkspaceStorageFolders(),t=[];for(const n of e)try{const e=c.join(n,"state.vscdb");await this.databaseService.openConnection(e);const s="\n          SELECT * FROM ItemTable \n          WHERE key LIKE '%aiService.prompts%'\n        ",r="\n          SELECT * FROM ItemTable \n          WHERE key LIKE '%workbench.panel.aichat.view.aichat.chatdata%'\n        ",a=await this.databaseService.executeQuery(s),o=await this.databaseService.executeQuery(r);for(const e of[...a,...o])try{if(e.value){const s=JSON.parse(e.value);s&&t.push({source:e.key,data:s,workspace:c.basename(n)})}}catch(e){console.error(`Error parsing JSON data: ${e}`)}await this.databaseService.closeConnection()}catch(e){console.error(`Error processing workspace folder ${n}: ${e}`)}return t}}t.CursorDataProvider=d},9896:e=>{e.exports=require("fs")},9948:function(e,t,n){var s,r=this&&this.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},s(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=s(e),o=0;o<n.length;o++)"default"!==n[o]&&r(t,e,n[o]);return a(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.registerProjectCommands=function(e,t){const n=i.commands.registerCommand("cursor-chat-manager.refreshChats",(async()=>{try{i.window.withProgress({location:i.ProgressLocation.Notification,title:"Loading Cursor Chat data...",cancellable:!1},(async e=>{e.report({increment:0}),await t.loadProjects(),e.report({increment:100}),i.window.showInformationMessage("Cursor Chat data loaded successfully!")}))}catch(e){console.error(`Error refreshing chats: ${e}`),i.window.showErrorMessage("Failed to refresh chats. Please try again.")}})),s=i.commands.registerCommand("cursor-chat-manager.createCustomProject",(async()=>{try{const e=c.ProjectOrganizer.getInstance(),n=await i.window.showInputBox({prompt:"Enter a name for the new custom project",placeHolder:"Project Name",validateInput:e=>e&&0!==e.trim().length?null:"Project name cannot be empty"});if(!n)return;const s=await i.window.showInputBox({prompt:"Enter a description for the project (optional)",placeHolder:"Project Description"})||"";await e.createCustomProject(n,s),t.refresh(),i.window.showInformationMessage(`Project "${n}" created successfully!`)}catch(e){console.error(`Error creating custom project: ${e}`),i.window.showErrorMessage("Failed to create custom project. Please try again.")}})),r=i.commands.registerCommand("cursor-chat-manager.deleteCustomProject",(async e=>{try{const n=c.ProjectOrganizer.getInstance(),s=n.getProject(e);if(!s)return void i.window.showErrorMessage("Project not found");if(!s.isCustom)return void i.window.showErrorMessage("Only custom projects can be deleted");if("Delete"!==await i.window.showWarningMessage(`Are you sure you want to delete the project "${s.name}"?`,{modal:!0},"Delete"))return;await n.deleteCustomProject(e),t.refresh(),i.window.showInformationMessage(`Project "${s.name}" deleted successfully!`)}catch(e){console.error(`Error deleting custom project: ${e}`),i.window.showErrorMessage("Failed to delete custom project. Please try again.")}})),a=i.commands.registerCommand("cursor-chat-manager.renameCustomProject",(async e=>{try{const n=c.ProjectOrganizer.getInstance(),s=n.getProject(e);if(!s)return void i.window.showErrorMessage("Project not found");if(!s.isCustom)return void i.window.showErrorMessage("Only custom projects can be renamed");const r=await i.window.showInputBox({prompt:"Enter a new name for the project",placeHolder:"Project Name",value:s.name,validateInput:e=>e&&0!==e.trim().length?null:"Project name cannot be empty"});if(!r)return;await n.updateProject(e,{name:r}),t.refresh(),i.window.showInformationMessage(`Project renamed to "${r}" successfully!`)}catch(e){console.error(`Error renaming custom project: ${e}`),i.window.showErrorMessage("Failed to rename custom project. Please try again.")}})),o=i.commands.registerCommand("cursor-chat-manager.openProject",(async e=>{})),l=i.commands.registerCommand("cursor-chat-manager.openChat",(async(e,t)=>{try{const n=c.ProjectOrganizer.getInstance().getProject(t);if(!n)return void i.window.showErrorMessage("Project not found");const s=n.chats.find((t=>t.id===e));if(!s)return void i.window.showErrorMessage("Chat not found");i.window.showInformationMessage(`Opening chat: ${s.title}`)}catch(e){console.error(`Error opening chat: ${e}`),i.window.showErrorMessage("Failed to open chat. Please try again.")}})),u=i.commands.registerCommand("cursor-chat-manager.moveOrCopyChat",(async(e,n)=>{try{const s=c.ProjectOrganizer.getInstance(),r=s.getProject(n);if(!r)return void i.window.showErrorMessage("Source project not found");if(!r.chats.find((t=>t.id===e)))return void i.window.showErrorMessage("Chat not found");const a=s.getAllProjects().filter((e=>e.id!==n));if(0===a.length)return void i.window.showErrorMessage("No target projects available");const o=a.map((e=>({label:e.name,description:e.isCustom?"Custom Project":"Original Project",id:e.id}))),l=await i.window.showQuickPick(o,{placeHolder:"Select target project"});if(!l)return;const u=await i.window.showQuickPick([{label:"Copy",description:"Keep in original project",value:c.OrganizationMode.COPY},{label:"Move",description:"Remove from original project",value:c.OrganizationMode.MOVE}],{placeHolder:"Choose operation"});if(!u)return;await s.organizeChatToProject(e,n,l.id,u.value),t.refresh(),i.window.showInformationMessage(`Chat ${u.value===c.OrganizationMode.COPY?"copied to":"moved to"} ${l.label} successfully!`)}catch(e){console.error(`Error organizing chat: ${e}`),i.window.showErrorMessage("Failed to organize chat. Please try again.")}}));e.subscriptions.push(n,s,r,a,o,l,u),i.commands.executeCommand("cursor-chat-manager.refreshChats")};const i=o(n(1398)),c=n(8191)}},t={};function n(s){var r=t[s];if(void 0!==r)return r.exports;var a=t[s]={exports:{}};return e[s].call(a.exports,a,a.exports,n),a.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var s=n(4265);module.exports=s})();